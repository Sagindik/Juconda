function CBXSession(){var t=this;this.dateInput=new Date,this.dateCheck=new Date,this.dateHit=new Date,this.notifier=null,this.checkInterval=60,this.Expand=function(e){this.key=e,BX.ready((function(){BX.bind(document,"keypress",t.OnUserInput),BX.bind(document.body,"mousemove",t.OnUserInput),BX.bind(document.body,"click",t.OnUserInput),setInterval(t.CheckSession,1e3*t.checkInterval)}))},this.OnUserInput=function(){var e=new Date;t.dateInput.setTime(e.valueOf())},this.CheckSession=function(){var e=new Date;if(!(e-t.dateCheck<t.checkInterval-1)&&(t.dateCheck.setTime(e.valueOf()),t.dateInput>t.dateHit)){var i={method:"GET",headers:[{name:"X-Bitrix-Csrf-Token",value:BX.bitrix_sessid()}],dataType:"html",url:"/bitrix/tools/public_session.php?k="+t.key,data:"",onsuccess:function(e){t.CheckResult(e)},lsId:"sess_expand",lsTimeout:t.checkInterval-5};BX.ajax(i)}},this.CheckResult=function(e){var i=new Date;if(t.dateHit.setTime(i.valueOf()),"SESSION_EXPIRED"==e&&BX.message("SessExpired")){if(!t.notifier){t.notifier=document.body.appendChild(BX.create("DIV",{props:{className:"bx-session-message"},style:{top:"0",backgroundColor:"#FFEB41",border:"1px solid #EDDA3C",width:"630px",fontFamily:"Arial,Helvetica,sans-serif",fontSize:"13px",fontWeight:"bold",textAlign:"center",color:"black",position:"absolute",zIndex:"10000",padding:"10px"},html:'<a class="bx-session-message-close" style="display:block; width:12px; height:12px; background:url(/bitrix/js/main/core/images/close.gif) center no-repeat; float:right;" href="javascript:bxSession.Close()"></a>'+BX.message("SessExpired")}));var s=BX.GetWindowScrollPos(),n=BX.GetWindowInnerSize();t.notifier.style.left=parseInt(s.scrollLeft+n.innerWidth/2-parseInt(t.notifier.clientWidth)/2)+"px",BX.browser.IsIE()?(t.notifier.style.top=s.scrollTop+"px",BX.bind(window,"scroll",(function(){var e=BX.GetWindowScrollPos();t.notifier.style.top=e.scrollTop+"px"}))):t.notifier.style.position="fixed"}t.notifier.style.display=""}},this.Close=function(){this.notifier.style.display="none"}}!function(t){var e=1,i=.05,s="linear",n=!1;BX.fx=function(t){if(this.options=t,null!=this.options.time&&(this.options.originalTime=this.options.time),null!=this.options.step&&(this.options.originalStep=this.options.step),!this.__checkOptions())return!1;this.__go=BX.delegate(this.go,this),this.PARAMS={}},BX.fx.prototype.__checkOptions=function(){if(typeof this.options.start!=typeof this.options.finish)return!1;var o;for(o in null==this.options.time&&(this.options.time=e),null==this.options.step&&(this.options.step=i),null==this.options.type&&(this.options.type=s),null==this.options.allowFloat&&(this.options.allowFloat=n),this.options.time*=1e3,this.options.step*=1e3,"object"!=typeof this.options.start&&(this.options.start={_param:this.options.start},this.options.finish={_param:this.options.finish}),this.options.start)null==this.options.finish[o]&&(this.options.start[o]=null,delete this.options.start[o]);return BX.type.isFunction(this.options.type)||(BX.type.isFunction(t[this.options.type])?this.options.type=t[this.options.type]:BX.type.isFunction(BX.fx.RULES[this.options.type])?this.options.type=BX.fx.RULES[this.options.type]:this.options.type=BX.fx.RULES[s]),!0},BX.fx.prototype.go=function(){var t=(new Date).valueOf();if(t<this.PARAMS.timeFinish){for(var e in this.PARAMS.current)this.PARAMS.current[e][0]=this.options.type.apply(this,[{start_value:this.PARAMS.start[e][0],finish_value:this.PARAMS.finish[e][0],current_value:this.PARAMS.current[e][0],current_time:t-this.PARAMS.timeStart,total_time:this.options.time}]);this._callback(this.options.callback),this.paused||(this.PARAMS.timer=setTimeout(this.__go,this.options.step))}else this.stop()},BX.fx.prototype._callback=function(t){var e={};for(var i in t=t||this.options.callback,this.PARAMS.current)e[i]=(this.options.allowFloat?this.PARAMS.current[i][0]:Math.round(this.PARAMS.current[i][0]))+this.PARAMS.current[i][1];return t.apply(this,[null!=e._param?e._param:e])},BX.fx.prototype.start=function(){var t,e,i;for(t in this.PARAMS.start={},this.PARAMS.current={},this.PARAMS.finish={},this.options.start)e=+this.options.start[t],i=(this.options.start[t]+"").substring((e+"").length),this.PARAMS.start[t]=[e,i],this.PARAMS.current[t]=[e,i],this.PARAMS.finish[t]=[+this.options.finish[t],i];return this._callback(this.options.callback_start),this._callback(this.options.callback),this.PARAMS.timeStart=(new Date).valueOf(),this.PARAMS.timeFinish=this.PARAMS.timeStart+this.options.time,this.PARAMS.timer=setTimeout(BX.delegate(this.go,this),this.options.step),this},BX.fx.prototype.pause=function(){this.paused?(this.PARAMS.timer=setTimeout(this.__go,this.options.step),this.paused=!1):(clearTimeout(this.PARAMS.timer),this.paused=!0)},BX.fx.prototype.stop=function(t){t=!!t,this.PARAMS.timer&&clearTimeout(this.PARAMS.timer),null!=this.options.originalTime&&(this.options.time=this.options.originalTime),null!=this.options.originalStep&&(this.options.step=this.options.originalStep),this.PARAMS.current=this.PARAMS.finish,t||(this._callback(this.options.callback),this._callback(this.options.callback_complete))},BX.fx.RULES={linear:function(t){return t.start_value+t.current_time/t.total_time*(t.finish_value-t.start_value)},decelerated:function(t){return t.start_value+Math.sqrt(t.current_time/t.total_time)*(t.finish_value-t.start_value)},accelerated:function(t){var e=t.current_time/t.total_time;return t.start_value+e*e*(t.finish_value-t.start_value)}},BX.fx.hide=function(t,e,i){if(t=BX(t),"object"==typeof e&&null==i&&(e=(i=e).type),i||(i={}),BX.type.isNotEmptyString(e)){var s=BX.fx.EFFECTS[e](t,i,0);return s.callback_complete=function(){!1!==i.hide&&(t.style.display="none"),i.callback_complete&&i.callback_complete.apply(this,arguments)},new BX.fx(s).start()}t.style.display="none"},BX.fx.show=function(t,e,i){if(t=BX(t),"object"==typeof e&&null==i&&(e=(i=e).type),i||(i={}),BX.type.isNotEmptyString(e)){var s=BX.fx.EFFECTS[e](t,i,1);return s.callback_complete=function(){!1!==i.show&&(t.style.display="block"),i.callback_complete&&i.callback_complete.apply(this,arguments)},new BX.fx(s).start()}t.style.display="block"},BX.fx.EFFECTS={scroll:function(t,i,s){i.direction||(i.direction="vertical");var n="horizontal"==i.direction?"width":"height",o=parseInt(BX.style(t,n));if(isNaN(o)&&(o=BX.pos(t)[n]),0==s)var a=o,r=i.min_height?parseInt(i.min_height):0;else r=o,a=i.min_height?parseInt(i.min_height):0;return{start:a,finish:r,time:i.time||e,type:"linear",callback_start:function(){"static"==BX.style(t,"position")&&(t.style.position="relative"),t.style.overflow="hidden",t.style[n]=a+"px",t.style.display="block"},callback:function(e){t.style[n]=e+"px"}}},fade:function(t,i,s){var n={time:i.time||e,type:0==s?"decelerated":"linear",start:0==s?1:0,finish:0==s?0:1,allowFloat:!0};return BX.browser.IsIE()&&!BX.browser.IsIE9()?(n.start*=100,n.finish*=100,n.allowFloat=!1,n.callback_start=function(){t.style.display="block",t.style.filter+="progid:DXImageTransform.Microsoft.Alpha(opacity="+n.start+")"},n.callback=function(e){(t.filters["DXImageTransform.Microsoft.alpha"]||t.filters.alpha).opacity=e}):(n.callback_start=function(){t.style.display="block"},n.callback=function(e){t.style.opacity=t.style.KhtmlOpacity=t.style.MozOpacity=e}),n},fold:function(t,i,s){if(0==s){var n=BX.pos(t),o=n.height/(n.width+n.height),a={time:i.time||e,callback_complete:i.callback_complete,hide:i.hide};return i.type="scroll",i.direction="vertical",i.min_height=i.min_height||10,i.hide=!1,i.time=o*a.time,i.callback_complete=function(){t.style.whiteSpace="nowrap",i.direction="horizontal",i.min_height=null,i.time=a.time-i.time,i.hide=a.hide,i.callback_complete=a.callback_complete,BX.fx.hide(t,i)},BX.fx.EFFECTS.scroll(t,i,s)}},scale:function(t,i,s){var n={width:parseInt(BX.style(t,"width")),height:parseInt(BX.style(t,"height"))};if(isNaN(n.width)||isNaN(n.height)){var o=BX.pos(t);n={width:o.width,height:o.height}}if(0==s)var a=n,r={width:0,height:0};else r=n,a={width:0,height:0};return{start:a,finish:r,time:i.time||e,type:"linear",callback_start:function(){t.style.position="relative",t.style.overflow="hidden",t.style.display="block",t.style.height=a.height+"px",t.style.width=a.width+"px"},callback:function(e){t.style.height=e.height+"px",t.style.width=e.width+"px"}}}};var o={arStack:{},arRules:{},globalAnimationId:0};BX.fx.colorAnimate=function(t,e,i){if(null!=t){animationId=t.getAttribute("data-animation-id"),null==animationId&&(animationId=o.globalAnimationId,t.setAttribute("data-animation-id",o.globalAnimationId++));for(var s=e.split(/\s*,\s*/),n=0;n<s.length;n++)if(e=s[n],o.arRules[e]){var a=0;o.arStack[animationId]?o.arStack[animationId][e]&&(a=o.arStack[animationId][e].i,clearInterval(o.arStack[animationId][e].tId)):o.arStack[animationId]={},0==a&&i||a==o.arRules[e][3]&&!i||(o.arStack[animationId][e]={i:a,element:t,tId:setInterval('BX.fx.colorAnimate.run("'+animationId+'","'+e+'")',o.arRules[e][4]),back:Boolean(i)})}}},BX.fx.colorAnimate.addRule=function(t,e,i,s,n,a,r){o.arRules[t]=[BX.util.hex2rgb(e),BX.util.hex2rgb(i),s.replace(/\-(.)/g,(function(){return arguments[1].toUpperCase()})),n,a||1,r||!1]},BX.fx.colorAnimate.run=function(t,e){element=o.arStack[t][e].element,o.arStack[t][e].i+=o.arStack[t][e].back?-1:1;var i=o.arStack[t][e].i/o.arRules[e][3],s=1-i,n=o.arRules[e][0],a=o.arRules[e][1];element.style[o.arRules[e][2]]="rgb("+Math.floor(n.r*s+a.r*i)+","+Math.floor(n.g*s+a.g*i)+","+Math.floor(n.b*s+a.b*i)+")",o.arStack[t][e].i!=o.arRules[e][3]&&0!=o.arStack[t][e].i||(clearInterval(o.arStack[t][e].tId),o.arRules[e][5]&&BX.fx.colorAnimate(o.arStack[t][e].element,e,!0))},BX.easing=function(t){this.options=t,this.timer=null},BX.easing.prototype.animate=function(){if(!this.options||!this.options.start||!this.options.finish||"object"!=typeof this.options.start||"object"!=typeof this.options.finish)return null;for(var t in this.options.start)void 0===this.options.finish[t]&&delete this.options.start[t];this.options.progress=function(t){var e={};for(var i in this.start)e[i]=Math.round(this.start[i]+(this.finish[i]-this.start[i])*t);this.step&&this.step(e)},this.animateProgress()},BX.easing.prototype.stop=function(t){this.timer&&(cancelAnimationFrame(this.timer),this.timer=null,t&&this.options.complete&&this.options.complete())},BX.easing.prototype.animateProgress=function(){if(!t.requestAnimationFrame)return this.options.progress(1),void(this.options.complete&&this.options.complete());var e=null,i=this.options.transition||BX.easing.transitions.linear,s=this.options.duration||1e3,n=BX.proxy((function(t){null===e&&(e=t);var o=(t-e)/s;o>1&&(o=1),this.options.progress(i(o)),1==o?this.stop(!0):this.timer=requestAnimationFrame(n)}),this);this.timer=requestAnimationFrame(n)},BX.easing.makeEaseInOut=function(t){return function(e){return e<.5?t(2*e)/2:(2-t(2*(1-e)))/2}},BX.easing.makeEaseOut=function(t){return function(e){return 1-t(1-e)}},BX.easing.transitions={linear:function(t){return t},quad:function(t){return Math.pow(t,2)},cubic:function(t){return Math.pow(t,3)},quart:function(t){return Math.pow(t,4)},quint:function(t){return Math.pow(t,5)},circ:function(t){return 1-Math.sin(Math.acos(t))},back:function(t){return Math.pow(t,2)*(2.5*t-1.5)},elastic:function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*1.5/3*t)},bounce:function(t){for(var e=0,i=1;;e+=i,i/=2)if(t>=(7-4*e)/11)return-Math.pow((11-6*e-11*t)/4,2)+Math.pow(i,2)}}}(window),window.BX=BX||{},BX.PageObject={getRootWindow:function(){return BX.PageObject.getTopWindowOfCurrentHost(window)},isCrossOriginObject:function(t){try{t.location.host}catch(t){return!0}return!1},getTopWindowOfCurrentHost:function(t){return BX.PageObject.isCrossOriginObject(t.parent)||t.parent===t||t.parent.location.host!==t.location.host?t:BX.PageObject.getTopWindowOfCurrentHost(t.parent)},getParentWindowOfCurrentHost:function(t){return BX.PageObject.isCrossOriginObject(t.parent)?t:t.parent}},function(window){BX.WindowManager||(BX.WindowManager={_stack:[],_runtime_resize:{},_delta:2,_delta_start:1e3,currently_loaded:null,settings_category:"BX.WindowManager.9.5",register:function(t){this.currently_loaded=null,t.Get().style.zIndex=t.zIndex=this.GetZIndex(),t.WM_REG_INDEX=this._stack.length,this._stack.push(t),this._stack.length<2&&BX.bind(document,"keyup",BX.proxy(this.__checkKeyPress,this))},unregister:function(t){if(null==t.WM_REG_INDEX)return null;var e;if(this._stack.length>0){for(;(e=this.__pop_stack())!=t;)if(!e){e=null;break}return this._stack.length<=0&&this.enableKeyCheck(),e}return null},__pop_stack:function(t){if(this._stack.length>0){var e=this._stack.pop();return e.WM_REG_INDEX=null,BX.onCustomEvent(e,"onWindowUnRegister",[!0===t]),e}return null},clean:function(){for(;this.__pop_stack(!0););this._stack=null,this.disableKeyCheck()},Get:function(){return this.currently_loaded?this.currently_loaded:this._stack.length>0?this._stack[this._stack.length-1]:null},setStartZIndex:function(t){this._delta_start=t},restoreStartZIndex:function(){this._delta_start=1e3},GetZIndex:function(){var t;return null!=(t=this._stack[this._stack.length-1])?parseInt(t.Get().style.zIndex)+this._delta:this._delta_start},__get_check_url:function(t){var e=t.indexOf("?");return-1==e?t:t.substring(0,e)},saveWindowSize:function(t,e){var i=this.__get_check_url(t);BX.userOptions&&(BX.userOptions.save(this.settings_category,"size_"+i,"width",e.width),BX.userOptions.save(this.settings_category,"size_"+i,"height",e.height)),this._runtime_resize[i]=e},saveWindowOptions:function(t,e){if(BX.userOptions)for(var i in e)e.hasOwnProperty(i)&&BX.userOptions.save(this.settings_category,"options_"+t,i,e[i])},getRuntimeWindowSize:function(t){return this._runtime_resize[this.__get_check_url(t)]},disableKeyCheck:function(){BX.unbind(document,"keyup",BX.proxy(this.__checkKeyPress,this))},enableKeyCheck:function(){BX.bind(document,"keyup",BX.proxy(this.__checkKeyPress,this))},__checkKeyPress:function(t){if(null==t&&(t=window.event),27==t.keyCode){var e=BX.WindowManager.Get();e&&!e.unclosable&&e.Close()}}},BX.garbage(BX.WindowManager.clean,BX.WindowManager),BX.CWindowButton=function(t){t.btn?(this.btn=t.btn,this.parentWindow=t.parentWindow,/save|apply/i.test(this.btn.name)&&BX.bind(this.btn,"click",BX.delegate(this.disableUntilError,this))):(this.title=t.title,this.hint=t.hint,this.id=t.id,this.name=t.name,this.className=t.className,this.action=t.action,this.onclick=t.onclick,t.Button&&BX.type.isFunction(t.Button)&&(this.Button=t.Button),this.btn=null)},BX.CWindowButton.prototype.disable=function(){this.btn&&this.parentWindow.showWait(this.btn)},BX.CWindowButton.prototype.enable=function(){this.btn&&this.parentWindow.closeWait(this.btn)},BX.CWindowButton.prototype.emulate=function(){if(!this.btn||!this.btn.disabled){var t=this.action?BX.delegate(this.action,this):this.onclick?this.onclick:this.btn?this.btn.getAttribute("onclick"):"";t&&(setTimeout(t,50),this.btn&&/save|apply/i.test(this.btn.name)&&!this.action&&this.disableUntilError())}},BX.CWindowButton.prototype.Button=function(parentWindow){this.parentWindow=parentWindow;var btn={props:{type:"button",name:this.id?this.id:this.name,value:this.title?this.title:this.name,id:this.id}};return this.hint&&(btn.props.title=this.hint),this.className&&(btn.props.className=this.className),this.action?btn.events={click:BX.delegate(this.action,this)}:this.onclick&&(BX.browser.IsIE()?btn.events={click:BX.delegate((function(){eval(this.onclick)}),this)}:btn.attrs={onclick:this.onclick}),this.btn=BX.create("INPUT",btn),this.btn},BX.CWindowButton.prototype.disableUntilError=function(){this.disable(),this.__window_error_handler_set||(BX.addCustomEvent(this.parentWindow,"onWindowError",BX.delegate(this.enable,this)),this.__window_error_handler_set=!0)},BX.CWindow=function(t,e){this.DIV=t||document.createElement("DIV"),this.SETTINGS={resizable:!1,min_height:0,min_width:0,top:0,left:0,draggable:!1,drag_restrict:!0,resize_restrict:!0},this.ELEMENTS={draggable:[],resizer:[],close:[]},this.type="float"==e?"float":"dialog",BX.adjust(this.DIV,{props:{className:"bx-core-window"},style:{zIndex:0,position:"absolute",display:"none",top:this.SETTINGS.top+"px",left:this.SETTINGS.left+"px",height:"100px",width:"100px"}}),this.isOpen=!1,BX.addCustomEvent(this,"onWindowRegister",BX.delegate(this.onRegister,this)),BX.addCustomEvent(this,"onWindowUnRegister",BX.delegate(this.onUnRegister,this)),this.MOUSEOVER=null,BX.bind(this.DIV,"mouseover",BX.delegate(this.__set_msover,this)),BX.bind(this.DIV,"mouseout",BX.delegate(this.__unset_msover,this)),BX.ready(BX.delegate((function(){document.body.appendChild(this.DIV)}),this))},BX.CWindow.prototype.Get=function(){return this.DIV},BX.CWindow.prototype.visible=function(){return this.isOpen},BX.CWindow.prototype.Show=function(t){this.DIV.style.display="block",t||(BX.WindowManager.register(this),BX.onCustomEvent(this,"onWindowRegister"))},BX.CWindow.prototype.Hide=function(){BX.WindowManager.unregister(this),this.DIV.style.display="none"},BX.CWindow.prototype.onRegister=function(){this.isOpen=!0},BX.CWindow.prototype.onUnRegister=function(t){this.isOpen=!1,t||this.PARAMS&&this.PARAMS.content_url?(t&&BX.onCustomEvent(this,"onWindowClose",[this,!0]),this.DIV.parentNode&&this.DIV.parentNode.removeChild(this.DIV)):this.DIV.style.display="none"},BX.CWindow.prototype.CloseDialog=BX.CWindow.prototype.Close=function(t){if(BX.onCustomEvent(this,"onBeforeWindowClose",[this]),!0!==t&&this.denyClose)return!1;if(BX.onCustomEvent(this,"onWindowClose",[this]),this.bExpanded){var e=BX.GetDocElement();BX.unbind(window,"resize",BX.proxy(this.__expand_onresize,this)),e.style.overflow=this.__expand_settings.overflow}return BX.WindowManager.unregister(this),!0},BX.CWindow.prototype.SetResize=function(t){t.style.cursor="se-resize",BX.bind(t,"mousedown",BX.proxy(this.__startResize,this)),this.ELEMENTS.resizer.push(t),this.SETTINGS.resizable=!0},BX.CWindow.prototype.SetExpand=function(t,e){e=e||"click",BX.bind(t,e,BX.proxy(this.__expand,this))},BX.CWindow.prototype.__expand_onresize=function(){var t=BX.GetWindowInnerSize();this.DIV.style.width=t.innerWidth+"px",this.DIV.style.height=t.innerHeight+"px",BX.onCustomEvent(this,"onWindowResize")},BX.CWindow.prototype.__expand=function(){var t=BX.GetDocElement();if(this.bExpanded)BX.unbind(window,"resize",BX.proxy(this.__expand_onresize,this)),this.SETTINGS.resizable=this.__expand_settings.resizable,this.SETTINGS.draggable=this.__expand_settings.draggable,t.style.overflow=this.__expand_settings.overflow,this.DIV.style.top=this.__expand_settings.top,this.DIV.style.left=this.__expand_settings.left,this.DIV.style.width=this.__expand_settings.width,this.DIV.style.height=this.__expand_settings.height,window.scrollTo(this.__expand_settings.scrollLeft,this.__expand_settings.scrollTop),this.bExpanded=!1,BX.onCustomEvent(this,"onWindowNarrow"),BX.onCustomEvent(this,"onWindowResize");else{var e=BX.GetWindowScrollPos(),i=BX.GetWindowInnerSize();this.__expand_settings={resizable:this.SETTINGS.resizable,draggable:this.SETTINGS.draggable,width:this.DIV.style.width,height:this.DIV.style.height,left:this.DIV.style.left,top:this.DIV.style.top,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,overflow:BX.style(t,"overflow")},this.SETTINGS.resizable=!1,this.SETTINGS.draggable=!1,window.scrollTo(0,0),t.style.overflow="hidden",this.DIV.style.top="0px",this.DIV.style.left="0px",this.DIV.style.width=i.innerWidth+"px",this.DIV.style.height=i.innerHeight+"px",this.bExpanded=!0,BX.onCustomEvent(this,"onWindowExpand"),BX.onCustomEvent(this,"onWindowResize"),BX.bind(window,"resize",BX.proxy(this.__expand_onresize,this))}},BX.CWindow.prototype.Resize=function(t,e){var i=Math.max(t-this.pos.left+this.dx,this.SETTINGS.min_width),s=Math.max(e-this.pos.top+this.dy,this.SETTINGS.min_height);if(this.SETTINGS.resize_restrict){var n=BX.GetWindowScrollSize();this.pos.left+i>n.scrollWidth-this.dw&&(i=n.scrollWidth-this.pos.left-this.dw)}this.DIV.style.width=i+"px",this.DIV.style.height=s+"px",BX.onCustomEvent(this,"onWindowResize")},BX.CWindow.prototype.__startResize=function(t){if(!this.SETTINGS.resizable)return!1;t||(t=window.event),this.wndSize=BX.GetWindowScrollPos(),this.wndSize.innerWidth=BX.GetWindowInnerSize().innerWidth,this.pos=BX.pos(this.DIV),this.x=t.clientX+this.wndSize.scrollLeft,this.y=t.clientY+this.wndSize.scrollTop,this.dx=this.pos.left+this.pos.width-this.x,this.dy=this.pos.top+this.pos.height-this.y,this.dw=this.pos.width-parseInt(this.DIV.style.width),BX.bind(document,"mousemove",BX.proxy(this.__moveResize,this)),BX.bind(document,"mouseup",BX.proxy(this.__stopResize,this)),document.body.setCapture&&document.body.setCapture(),document.onmousedown=BX.False;var e=document.body;return e.ondrag=e.onselectstart=BX.False,e.style.MozUserSelect=this.DIV.style.MozUserSelect="none",e.style.cursor="se-resize",BX.onCustomEvent(this,"onWindowResizeStart"),!0},BX.CWindow.prototype.__moveResize=function(t){t||(t=window.event);var e=BX.GetWindowScrollPos(),i=t.clientX+e.scrollLeft,s=t.clientY+e.scrollTop;this.x==i&&this.y==s||(this.Resize(i,s),this.x=i,this.y=s)},BX.CWindow.prototype.__stopResize=function(){document.body.releaseCapture&&document.body.releaseCapture(),BX.unbind(document,"mousemove",BX.proxy(this.__moveResize,this)),BX.unbind(document,"mouseup",BX.proxy(this.__stopResize,this)),document.onmousedown=null;var t=document.body;t.ondrag=t.onselectstart=null,t.style.MozUserSelect=this.DIV.style.MozUserSelect="",t.style.cursor="",BX.onCustomEvent(this,"onWindowResizeFinished")},BX.CWindow.prototype.SetClose=function(t){BX.bind(t,"click",BX.proxy(this.Close,this)),this.ELEMENTS.close.push(t)},BX.CWindow.prototype.SetDraggable=function(t){BX.bind(t,"mousedown",BX.proxy(this.__startDrag,this)),t.style.cursor="move",this.ELEMENTS.draggable.push(t),this.SETTINGS.draggable=!0},BX.CWindow.prototype.Move=function(t,e){var i=parseInt(this.DIV.style.left)+t,s=parseInt(this.DIV.style.top)+e;if(this.SETTINGS.drag_restrict){i<0&&(i=0);var n=BX.GetWindowScrollSize(),o=this.DIV.offsetWidth,a=this.DIV.offsetHeight;i>n.scrollWidth-o-1&&(i=n.scrollWidth-o-1);var r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight,n.scrollHeight);s>r-a-1&&(s=r-a-1),s<0&&(s=0)}this.DIV.style.left=i+"px",this.DIV.style.top=s+"px"},BX.CWindow.prototype.__startDrag=function(t){if(!this.SETTINGS.draggable)return!1;t||(t=window.event),this.x=t.clientX+document.body.scrollLeft,this.y=t.clientY+document.body.scrollTop,this.__bWasDragged=!1,BX.bind(document,"mousemove",BX.proxy(this.__moveDrag,this)),BX.bind(document,"mouseup",BX.proxy(this.__stopDrag,this)),document.body.setCapture&&document.body.setCapture(),document.onmousedown=BX.False;var e=document.body;return e.ondrag=e.onselectstart=BX.False,e.style.MozUserSelect=this.DIV.style.MozUserSelect="none",e.style.cursor="move",BX.PreventDefault(t)},BX.CWindow.prototype.__moveDrag=function(t){t||(t=window.event);var e=t.clientX+document.body.scrollLeft,i=t.clientY+document.body.scrollTop;this.x==e&&this.y==i||(this.Move(e-this.x,i-this.y),this.x=e,this.y=i,this.__bWasDragged||(BX.onCustomEvent(this,"onWindowDragStart"),this.__bWasDragged=!0,BX.bind(BX.proxy_context,"click",BX.PreventDefault)),BX.onCustomEvent(this,"onWindowDrag"))},BX.CWindow.prototype.__stopDrag=function(t){document.body.releaseCapture&&document.body.releaseCapture(),BX.unbind(document,"mousemove",BX.proxy(this.__moveDrag,this)),BX.unbind(document,"mouseup",BX.proxy(this.__stopDrag,this)),document.onmousedown=null;var e=document.body;if(e.ondrag=e.onselectstart=null,e.style.MozUserSelect=this.DIV.style.MozUserSelect="",e.style.cursor="",this.__bWasDragged){BX.onCustomEvent(this,"onWindowDragFinished");var i=BX.proxy_context;setTimeout((function(){BX.unbind(i,"click",BX.PreventDefault)}),100),this.__bWasDragged=!1}return BX.PreventDefault(t)},BX.CWindow.prototype.DenyClose=function(){this.denyClose=!0},BX.CWindow.prototype.AllowClose=function(){this.denyClose=!1},BX.CWindow.prototype.ShowError=function(t){BX.onCustomEvent(this,"onWindowError",[t]),this._wait&&BX.closeWait(this._wait),window.alert(t)},BX.CWindow.prototype.__set_msover=function(){this.MOUSEOVER=!0},BX.CWindow.prototype.__unset_msover=function(){this.MOUSEOVER=!1},BX.CWindowDialog=function(){var t=arguments;t[1]="dialog",BX.CWindowDialog.superclass.constructor.apply(this,t),this.DIV.style.top="10px",this.OVERLAY=null},BX.extend(BX.CWindowDialog,BX.CWindow),BX.CWindowDialog.prototype.__resizeOverlay=function(){var t=BX.GetWindowScrollSize();this.OVERLAY.style.width=t.scrollWidth+"px"},BX.CWindowDialog.prototype.CreateOverlay=function(t){if(null==this.OVERLAY){var e=BX.GetWindowScrollSize(),i=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight,e.scrollHeight);this.OVERLAY=document.body.appendChild(BX.create("DIV",{style:{position:"absolute",top:"0px",left:"0px",zIndex:t||parseInt(this.DIV.style.zIndex)-2,width:e.scrollWidth+"px",height:i+"px"}}))}return this.OVERLAY},BX.CWindowDialog.prototype.Show=function(){BX.CWindowDialog.superclass.Show.apply(this,arguments),this.CreateOverlay(),this.OVERLAY.style.display="block",this.OVERLAY.style.zIndex=parseInt(this.DIV.style.zIndex)-2,BX.unbind(window,"resize",BX.proxy(this.__resizeOverlay,this)),BX.bind(window,"resize",BX.proxy(this.__resizeOverlay,this))},BX.CWindowDialog.prototype.onUnRegister=function(t){BX.CWindowDialog.superclass.onUnRegister.apply(this,arguments),this.clean?this.OVERLAY.parentNode&&this.OVERLAY.parentNode.removeChild(this.OVERLAY):this.OVERLAY.style.display="none",BX.unbind(window,"resize",BX.proxy(this.__resizeOverlay,this))},BX.CDialog=function(t){for(var e in BX.CDialog.superclass.constructor.apply(this),this._sender="core_window_cdialog",this.PARAMS=t||{},this.defaultParams)void 0===this.PARAMS[e]&&(this.PARAMS[e]=this.defaultParams[e]);if(this.PARAMS.width=isNaN(parseInt(this.PARAMS.width))?this.defaultParams.width:this.PARAMS.width,this.PARAMS.height=isNaN(parseInt(this.PARAMS.height))?this.defaultParams.height:this.PARAMS.height,this.PARAMS.resize_id||this.PARAMS.content_url){var i=BX.WindowManager.getRuntimeWindowSize(this.PARAMS.resize_id||this.PARAMS.content_url);i&&(this.PARAMS.width=i.width,this.PARAMS.height=i.height)}BX.addClass(this.DIV,"bx-core-adm-dialog"),this.DIV.id="bx-admin-prefix",this.PARTS={},this.DIV.style.height=null,this.DIV.style.width=null,this.PARTS.TITLEBAR=this.DIV.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-head"}})),this.PARTS.TITLE_CONTAINER=this.PARTS.TITLEBAR.appendChild(BX.create("SPAN",{props:{className:"bx-core-adm-dialog-head-inner"},text:this.PARAMS.title})),this.PARTS.TITLEBAR_ICONS=this.PARTS.TITLEBAR.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-head-icons"},children:this.PARAMS.resizable?[BX.create("SPAN",{props:{className:"bx-core-adm-icon-expand",title:BX.message("JS_CORE_WINDOW_EXPAND")}}),BX.create("SPAN",{props:{className:"bx-core-adm-icon-close",title:BX.message("JS_CORE_WINDOW_CLOSE")}})]:[BX.create("SPAN",{props:{className:"bx-core-adm-icon-close",title:BX.message("JS_CORE_WINDOW_CLOSE")}})]})),this.PARTS.CONTENT=this.DIV.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-content-wrap adm-workarea"}})),this.PARTS.CONTENT_DATA=this.PARTS.CONTENT.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-content"},style:{height:this.PARAMS.height+"px",width:this.PARAMS.width+"px"}})),this.PARTS.HEAD=this.PARTS.CONTENT_DATA.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-head-block"+(this.PARAMS.icon?" "+this.PARAMS.icon:"")}})),this.SetHead(this.PARAMS.head),this.SetContent(this.PARAMS.content),this.SetTitle(this.PARAMS.title),this.SetClose(this.PARTS.TITLEBAR_ICONS.lastChild),this.PARAMS.resizable&&(this.SetExpand(this.PARTS.TITLEBAR_ICONS.firstChild),this.SetExpand(this.PARTS.TITLEBAR,"dblclick"),BX.addCustomEvent(this,"onWindowExpand",BX.proxy(this.__onexpand,this)),BX.addCustomEvent(this,"onWindowNarrow",BX.proxy(this.__onexpand,this))),this.PARTS.FOOT=this.PARTS.BUTTONS_CONTAINER=this.PARTS.CONTENT.appendChild(BX.create("DIV",{props:{className:"bx-core-adm-dialog-buttons"},children:this.ShowButtons()})),this.PARAMS.draggable&&this.SetDraggable(this.PARTS.TITLEBAR),this.PARAMS.resizable&&(this.PARTS.RESIZER=this.DIV.appendChild(BX.create("DIV",{props:{className:"bx-core-resizer"}})),this.SetResize(this.PARTS.RESIZER),this.SETTINGS.min_width=this.PARAMS.min_width,this.SETTINGS.min_height=this.PARAMS.min_height),this.auth_callback=BX.delegate((function(){this.PARAMS.content="",this.hideNotify(),this.Show()}),this)},BX.extend(BX.CDialog,BX.CWindowDialog),BX.CDialog.prototype.defaultParams={width:700,height:400,min_width:500,min_height:300,resizable:!0,draggable:!0,title:"",icon:""},BX.CDialog.prototype.showWait=function(t){if(BX.type.isElementNode(t)&&("button"==t.type||"submit"==t.type)){BX.defer((function(){t.disabled=!0}))();var e=BX.hasClass(t,"adm-btn-save")||BX.hasClass(t,"adm-btn-save"),i=BX.pos(t,!0);return t.bxwaiter=this.PARTS.FOOT.appendChild(BX.create("DIV",{props:{className:"adm-btn-load-img"+(e?"-green":"")},style:{top:parseInt((i.bottom+i.top)/2-10)+"px",left:parseInt((i.right+i.left)/2-10)+"px"}})),BX.addClass(t,"adm-btn-load"),this.lastWaitElement=t,t.bxwaiter}return null},BX.CDialog.prototype.closeWait=function(t){t=t||this.lastWaitElement,BX.type.isElementNode(t)&&(t.bxwaiter&&(t.bxwaiter.parentNode&&t.bxwaiter.parentNode.removeChild(t.bxwaiter),t.bxwaiter=null),t.disabled=!1,BX.removeClass(t,"adm-btn-load"),this.lastWaitElement==t&&(this.lastWaitElement=null))},BX.CDialog.prototype.Authorize=function(t){this.bSkipReplaceContent=!0,this.ShowError(BX.message("JSADM_AUTH_REQ")),BX.onCustomEvent(this,"onWindowError",[]),BX.closeWait(),new BX.CAuthDialog({content_url:this.PARAMS.content_url,auth_result:t,callback:BX.delegate((function(){this.auth_callback&&this.auth_callback()}),this)}).Show()},BX.CDialog.prototype.ShowError=function(t){BX.onCustomEvent(this,"onWindowError",[t]),this.closeWait(),this._wait&&BX.closeWait(this._wait),this.Notify(t,!0)},BX.CDialog.prototype.__expandGetSize=function(){var t=BX.GetDocElement();t.style.overflow="hidden";var e=BX.GetWindowInnerSize();return t.scrollTop=0,this.DIV.style.top="-"+this.dxShadow+"px",this.DIV.style.left="-"+this.dxShadow+"px",{width:e.innerWidth-parseInt(BX.style(this.PARTS.CONTENT,"padding-right"))-parseInt(BX.style(this.PARTS.CONTENT,"padding-left"))+this.dxShadow,height:e.innerHeight-this.PARTS.TITLEBAR.offsetHeight-this.PARTS.FOOT.offsetHeight-parseInt(BX.style(this.PARTS.CONTENT,"padding-top"))-parseInt(BX.style(this.PARTS.CONTENT,"padding-bottom"))+this.dxShadow}},BX.CDialog.prototype.__expand=function(){var t=BX.GetDocElement();if(this.dxShadow=2,this.bExpanded)BX.unbind(window,"resize",BX.proxy(this.__expand_onresize,this)),this.SETTINGS.resizable=this.__expand_settings.resizable,this.SETTINGS.draggable=this.__expand_settings.draggable,t.style.overflow=this.__expand_settings.overflow,this.DIV.style.top=this.__expand_settings.top,this.DIV.style.left=this.__expand_settings.left,this.PARTS.CONTENT_DATA.style.width=this.__expand_settings.width,this.PARTS.CONTENT_DATA.style.height=this.__expand_settings.height,window.scrollTo(this.__expand_settings.scrollLeft,this.__expand_settings.scrollTop),this.bExpanded=!1,BX.onCustomEvent(this,"onWindowNarrow"),BX.onCustomEvent(this,"onWindowResize"),BX.onCustomEvent(this,"onWindowResizeExt",[{width:parseInt(this.__expand_settings.width),height:parseInt(this.__expand_settings.height)}]);else{var e=BX.GetWindowScrollPos();this.__expand_settings={resizable:this.SETTINGS.resizable,draggable:this.SETTINGS.draggable,width:this.PARTS.CONTENT_DATA.style.width,height:this.PARTS.CONTENT_DATA.style.height,left:this.DIV.style.left,top:this.DIV.style.top,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,overflow:BX.style(t,"overflow")},this.SETTINGS.resizable=!1,this.SETTINGS.draggable=!1;var i=this.__expandGetSize();this.PARTS.CONTENT_DATA.style.width=i.width+"px",this.PARTS.CONTENT_DATA.style.height=i.height+"px",window.scrollTo(0,0),t.style.overflow="hidden",this.bExpanded=!0,BX.onCustomEvent(this,"onWindowExpand"),BX.onCustomEvent(this,"onWindowResize"),BX.onCustomEvent(this,"onWindowResizeExt",[{width:i.width,height:i.height}]),BX.bind(window,"resize",BX.proxy(this.__expand_onresize,this))}},BX.CDialog.prototype.__expand_onresize=function(){var t=this.__expandGetSize();this.PARTS.CONTENT_DATA.style.width=t.width+"px",this.PARTS.CONTENT_DATA.style.height=t.height+"px",BX.onCustomEvent(this,"onWindowResize"),BX.onCustomEvent(this,"onWindowResizeExt",[t])},BX.CDialog.prototype.__onexpand=function(){var t=this.PARTS.TITLEBAR_ICONS.firstChild;t.className=BX.toggle(t.className,["bx-core-adm-icon-expand","bx-core-adm-icon-narrow"]),t.title=BX.toggle(t.title,[BX.message("JS_CORE_WINDOW_EXPAND"),BX.message("JS_CORE_WINDOW_NARROW")]),this.PARTS.RESIZER&&(this.PARTS.RESIZER.style.display=this.bExpanded?"none":"block")},BX.CDialog.prototype.__startResize=function(t){if(!this.SETTINGS.resizable)return!1;t||(t=window.event),this.wndSize=BX.GetWindowScrollPos(),this.wndSize.innerWidth=BX.GetWindowInnerSize().innerWidth,this.pos=BX.pos(this.PARTS.CONTENT_DATA),this.x=t.clientX+this.wndSize.scrollLeft,this.y=t.clientY+this.wndSize.scrollTop,this.dx=this.pos.left+this.pos.width-this.x,this.dy=this.pos.top+this.pos.height-this.y,this.dw=this.pos.width-parseInt(this.PARTS.CONTENT_DATA.style.width)+parseInt(BX.style(this.PARTS.CONTENT,"padding-right")),BX.bind(document,"mousemove",BX.proxy(this.__moveResize,this)),BX.bind(document,"mouseup",BX.proxy(this.__stopResize,this)),document.body.setCapture&&document.body.setCapture(),document.onmousedown=BX.False;var e=document.body;return e.ondrag=e.onselectstart=BX.False,e.style.MozUserSelect=this.DIV.style.MozUserSelect="none",e.style.cursor="se-resize",BX.onCustomEvent(this,"onWindowResizeStart"),!0},BX.CDialog.prototype.Resize=function(t,e){var i=Math.max(t-this.pos.left+this.dx,this.SETTINGS.min_width),s=Math.max(e-this.pos.top+this.dy,this.SETTINGS.min_height);if(this.SETTINGS.resize_restrict){var n=BX.GetWindowScrollSize();this.pos.left+i>n.scrollWidth-this.dw&&(i=n.scrollWidth-this.pos.left-this.dw)}this.PARTS.CONTENT_DATA.style.width=i+"px",this.PARTS.CONTENT_DATA.style.height=s+"px",BX.onCustomEvent(this,"onWindowResize"),BX.onCustomEvent(this,"onWindowResizeExt",[{height:s,width:i}])},BX.CDialog.prototype.SetSize=function(t){this.PARTS.CONTENT_DATA.style.width=t.width+"px",this.PARTS.CONTENT_DATA.style.height=t.height+"px",BX.onCustomEvent(this,"onWindowResize"),BX.onCustomEvent(this,"onWindowResizeExt",[t])},BX.CDialog.prototype.GetParameters=function(t){var e=this.GetForm();if(!e)return"";var i,s="",n=e.elements.length,o="";for(i=0;i<n;i++){""!=s&&(o="&");var a=e.elements[i];if(!a.disabled)switch(a.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":if(null==t&&"_alt"==a.name.substr(a.name.length-4)&&e.elements[a.name.substr(0,a.name.length-4)])break;s+=o+a.name+"="+BX.util.urlencode(a.value);break;case"radio":a.checked&&(s+=o+a.name+"="+BX.util.urlencode(a.value));break;case"checkbox":s+=o+a.name+"="+BX.util.urlencode(a.checked?"Y":"N");break;case"select-one":var r="";r=null==t&&e.elements[a.name+"_alt"]&&0==a.selectedIndex?e.elements[a.name+"_alt"].value:a.value,s+=o+a.name+"="+BX.util.urlencode(r);break;case"select-multiple":var h,l=!1,p=a.options.length;for(h=0;h<p;h++)a.options[h].selected&&(s+=o+a.name+"="+BX.util.urlencode(a.options[h].value),l=!0);l||(s+=o+a.name+"=")}}return s},BX.CDialog.prototype.PostParameters=function(t){var e=this.PARAMS.content_url;null==t&&(t=""),t+=(""==t?"":"&")+"bxsender="+this._sender;var i=e.indexOf("?");-1==i?e+="?"+t:e=e.substring(0,i)+"?"+t+"&"+e.substring(i+1),BX.showWait(),this.auth_callback=BX.delegate((function(){this.hideNotify(),this.PostParameters(t)}),this),BX.ajax.Setup({skipAuthCheck:!0},!0),BX.ajax.post(e,this.GetParameters(),BX.delegate((function(t){BX.closeWait(),this.bSkipReplaceContent||(this.ClearButtons(),this.SetContent(t),this.Show(!0)),this.bSkipReplaceContent=!1}),this))},BX.CDialog.prototype.Submit=function(t,e){var i=this.GetForm();if(i){if(i.onsubmit=null,i.method="POST",!i.action||e){if(e=e||this.PARAMS.content_url,null!=t){var s=e.indexOf("?");-1==s?e+="?"+t:e=e.substring(0,s)+"?"+t+"&"+e.substring(s+1)}i.action=e}i._bxsender||(i._bxsender=i.appendChild(BX.create("INPUT",{attrs:{type:"hidden",name:"bxsender",value:this._sender}}))),this._wait=BX.showWait(),this.auth_callback=BX.delegate((function(){this.hideNotify(),this.Submit(t)}),this),BX.ajax.submit(i,BX.delegate((function(){this.closeWait()}),this))}else window.alert("no form registered!")},BX.CDialog.prototype.GetForm=function(){if(null==this.__form){var t=this.PARTS.CONTENT_DATA.getElementsByTagName("FORM");this.__form=t[0]?t[0]:null}return this.__form},BX.CDialog.prototype.GetRealForm=function(){if(null==this.__rform){var t=this.PARTS.CONTENT_DATA.getElementsByTagName("FORM");this.__rform=t[1]?t[1]:t[0]?t[0]:null}return this.__rform},BX.CDialog.prototype._checkButton=function(t){for(var e=["btnSave","btnCancel","btnClose"],i=0;i<e.length;i++)if(this[e[i]]&&t==this[e[i]])return e[i];return!1},BX.CDialog.prototype.ShowButtons=function(){var t=[];if(this.PARAMS.buttons){this.PARAMS.buttons.title&&(this.PARAMS.buttons=[this.PARAMS.buttons]);for(var e=0,i=this.PARAMS.buttons.length;e<i;e++)if(BX.type.isNotEmptyString(this.PARAMS.buttons[e]))t.push(this.PARAMS.buttons[e]);else if(BX.type.isElementNode(this.PARAMS.buttons[e]))t.push(this.PARAMS.buttons[e]);else if(this.PARAMS.buttons[e]){if(!BX.is_subclass_of(this.PARAMS.buttons[e],BX.CWindowButton)){var s=this._checkButton(this.PARAMS.buttons[e]);this.PARAMS.buttons[e]=new BX.CWindowButton(this.PARAMS.buttons[e]),s&&(this[s]=this.PARAMS.buttons[e])}t.push(this.PARAMS.buttons[e].Button(this))}}return t},BX.CDialog.prototype.setAutosave=function(){this.bSetAutosaveDelay||(this.bSetAutosaveDelay=!0,setTimeout(BX.proxy(this.setAutosave,this),10))},BX.CDialog.prototype.SetTitle=function(t){this.PARAMS.title=t,BX.cleanNode(this.PARTS.TITLE_CONTAINER).appendChild(document.createTextNode(this.PARAMS.title))},BX.CDialog.prototype.SetHead=function(t){this.PARAMS.head=BX.util.trim(t),this.PARTS.HEAD.innerHTML=this.PARAMS.head||"&nbsp;",this.PARTS.HEAD.style.display=this.PARAMS.head?"block":"none",this.adjustSize()},BX.CDialog.prototype.Notify=function(t,e,i){this.PARTS.NOTIFY||(this.PARTS.NOTIFY=this.DIV.insertBefore(BX.create("DIV",{props:{className:"adm-warning-block"},children:[BX.create("SPAN",{props:{className:"adm-warning-text"}}),BX.create("SPAN",{props:{className:"adm-warning-icon"}}),BX.create("SPAN",{props:{className:"adm-warning-close"},events:{click:BX.proxy(this.hideNotify,this)}})]}),this.DIV.firstChild)),e?BX.addClass(this.PARTS.NOTIFY,"adm-warning-block-red"):BX.removeClass(this.PARTS.NOTIFY,"adm-warning-block-red"),!0!==i&&(t=BX.util.htmlspecialchars(t)),this.PARTS.NOTIFY.firstChild.innerHTML=t||"&nbsp;",this.PARTS.NOTIFY.firstChild.style.width=this.PARAMS.width-50+"px",BX.removeClass(this.PARTS.NOTIFY,"adm-warning-animate")},BX.CDialog.prototype.hideNotify=function(){BX.addClass(this.PARTS.NOTIFY,"adm-warning-animate")},BX.CDialog.prototype.__adjustHeadToIcon=function(){this.PARTS.HEAD.offsetHeight?(this.icon_image&&this.icon_image.height&&this.icon_image.height>this.PARTS.HEAD.offsetHeight-5&&(this.PARTS.HEAD.style.height=this.icon_image.height+5+"px",this.adjustSize()),this.icon_image.onload=null,this.icon_image=null):setTimeout(BX.delegate(this.__adjustHeadToIcon,this),50)},BX.CDialog.prototype.SetIcon=function(t){if(this.PARAMS.icon!=t&&(this.PARAMS.icon&&BX.removeClass(this.PARTS.HEAD,this.PARAMS.icon),this.PARAMS.icon=t,this.PARAMS.icon)){BX.addClass(this.PARTS.HEAD,this.PARAMS.icon);var e=BX.style(this.PARTS.HEAD,"background-image")||BX.style(this.PARTS.HEAD,"backgroundImage");if(BX.type.isNotEmptyString(e)&&"none"!=e){var i=e.match(new RegExp("url\\s*\\(\\s*('|\"|)(.+?)(\\1)\\s*\\)"));i&&(e=i[2],BX.type.isNotEmptyString(e)&&(this.icon_image=new Image,this.icon_image.onload=BX.delegate(this.__adjustHeadToIcon,this),this.icon_image.src=e))}}this.adjustSize()},BX.CDialog.prototype.SetIconFile=function(t){this.icon_image=new Image,this.icon_image.onload=BX.delegate(this.__adjustHeadToIcon,this),this.icon_image.src=t,BX.adjust(this.PARTS.HEAD,{style:{backgroundImage:"url("+t+")",backgroundPosition:"right 9px"}}),this.adjustSize()},BX.CDialog.prototype.SetButtons=function(t){if(BX.type.isString(t)){if(t.length>0){this.PARTS.BUTTONS_CONTAINER.innerHTML+=t;var e=this.PARTS.BUTTONS_CONTAINER.getElementsByTagName("INPUT");if(e.length>0){this.PARAMS.buttons=[];for(var i=0;i<e.length;i++)this.PARAMS.buttons.push(new BX.CWindowButton({btn:e[i],parentWindow:this}))}}}else this.PARAMS.buttons=t,BX.adjust(this.PARTS.BUTTONS_CONTAINER,{children:this.ShowButtons()});this.adjustSize()},BX.CDialog.prototype.ClearButtons=function(){BX.cleanNode(this.PARTS.BUTTONS_CONTAINER),this.adjustSize()},BX.CDialog.prototype.SetContent=function(t){this.__form=null,BX.type.isElementNode(t)?t.parentNode&&t.parentNode.removeChild(t):BX.type.isString(t)&&(t=BX.create("DIV",{html:t})),this.PARAMS.content=t,BX.cleanNode(this.PARTS.CONTENT_DATA),BX.adjust(this.PARTS.CONTENT_DATA,{children:[this.PARTS.HEAD,BX.create("DIV",{props:{className:"bx-core-adm-dialog-content-wrap-inner"},children:[this.PARAMS.content]})]}),this.PARAMS.content_url&&this.GetForm()&&(this.__form.submitbtn=this.__form.appendChild(BX.create("INPUT",{props:{type:"submit"},style:{display:"none"}})),this.__form.onsubmit=BX.delegate(this.__submit,this))},BX.CDialog.prototype.__submit=function(t){for(var e=0,i=this.PARAMS.buttons.length;e<i;e++)if(this.PARAMS.buttons[e]&&(this.PARAMS.buttons[e].name&&/save|apply/i.test(this.PARAMS.buttons[e].name)||this.PARAMS.buttons[e].btn&&this.PARAMS.buttons[e].btn.name&&/save|apply/i.test(this.PARAMS.buttons[e].btn.name))){this.PARAMS.buttons[e].emulate();break}return BX.PreventDefault(t)},BX.CDialog.prototype.SwapContent=function(t){t=BX(t),BX.cleanNode(this.PARTS.CONTENT_DATA),t.parentNode.removeChild(t),this.PARTS.CONTENT_DATA.appendChild(t),t.style.display="block",this.SetContent(t.innerHTML)},BX.CDialog.prototype.adjustSize=function(){},BX.CDialog.prototype.__adjustSize=function(){},BX.CDialog.prototype.adjustSizeEx=function(){BX.defer(this.__adjustSizeEx,this)()},BX.CDialog.prototype.__adjustSizeEx=function(){for(var t,e,i=this.PARTS.CONTENT_DATA.firstChild,s=0;i;)BX.type.isElementNode(i)&&(t=parseInt(BX.style(i,"margin-top"),10),isNaN(t)&&(t=0),e=parseInt(BX.style(i,"margin-bottom"),10),isNaN(e)&&(e=0),s+=i.offsetHeight+t+e),i=BX.nextSibling(i);s&&(this.PARTS.CONTENT_DATA.style.height=s+"px")},BX.CDialog.prototype.__onResizeFinished=function(){BX.WindowManager.saveWindowSize(this.PARAMS.resize_id||this.PARAMS.content_url,{height:parseInt(this.PARTS.CONTENT_DATA.style.height),width:parseInt(this.PARTS.CONTENT_DATA.style.width)})},BX.CDialog.prototype.Show=function(t){if(!this.PARAMS.content&&this.PARAMS.content_url&&BX.ajax&&!t){var e=BX.showWait();BX.WindowManager.currently_loaded=this;var i=this.PARAMS.zIndex?this.PARAMS.zIndex:parseInt(BX.style(e,"z-index"))-1;this.CreateOverlay(i),this.OVERLAY.style.display="block",this.OVERLAY.className="bx-core-dialog-overlay";var s="",n="GET";this.PARAMS.content_post&&(s=this.PARAMS.content_post,n="POST");var o=this.PARAMS.content_url+(this.PARAMS.content_url.indexOf("?")<0?"?":"&")+"bxsender="+this._sender;this.auth_callback=BX.delegate((function(){this.PARAMS.content="",this.hideNotify(),this.Show()}),this),BX.ajax({method:n,dataType:"html",url:o,data:s,skipAuthCheck:!0,onsuccess:BX.delegate((function(t){BX.closeWait(null,e),this.SetContent(t||"&nbsp;"),this.Show()}),this)})}else BX.WindowManager.currently_loaded=null,BX.CDialog.superclass.Show.apply(this,arguments),this.adjustPos(),this.OVERLAY.className="bx-core-dialog-overlay",this.__adjustSize(),BX.removeCustomEvent(this,"onWindowResize",BX.proxy(this.__adjustSize,this)),BX.addCustomEvent(this,"onWindowResize",BX.proxy(this.__adjustSize,this)),this.PARAMS.resizable&&(this.PARAMS.content_url||this.PARAMS.resize_id)&&(BX.removeCustomEvent(this,"onWindowResizeFinished",BX.proxy(this.__onResizeFinished,this)),BX.addCustomEvent(this,"onWindowResizeFinished",BX.proxy(this.__onResizeFinished,this)))},BX.CDialog.prototype.GetInnerPos=function(){return{width:parseInt(this.PARTS.CONTENT_DATA.style.width),height:parseInt(this.PARTS.CONTENT_DATA.style.height)}},BX.CDialog.prototype.adjustPos=function(){if(!this.bExpanded){var t=window,e=BX.PageObject.getRootWindow();e.BX.SidePanel&&e.BX.SidePanel.Instance&&e.BX.SidePanel.Instance.getTopSlider()&&(t=e.BX.SidePanel.Instance.getTopSlider().getWindow());var i=t.BX.GetWindowInnerSize(),s=t.BX.GetWindowScrollPos(),n={left:parseInt(s.scrollLeft+i.innerWidth/2-parseInt(this.DIV.offsetWidth)/2)+"px",top:Math.max(parseInt(s.scrollTop+i.innerHeight/2-parseInt(this.DIV.offsetHeight)/2),0)+"px"};this.PARAMS.zIndex&&(n["z-index"]=this.PARAMS.zIndex),BX.adjust(this.DIV,{style:n})}},BX.CDialog.prototype.GetContent=function(){return this.PARTS.CONTENT_DATA},BX.CDialog.prototype.btnSave=BX.CDialog.btnSave={title:BX.message("JS_CORE_WINDOW_SAVE"),id:"savebtn",name:"savebtn",className:BX.browser.IsIE()&&BX.browser.IsDoctype()&&!BX.browser.IsIE10()?"":"adm-btn-save",action:function(){this.disableUntilError(),this.parentWindow.PostParameters()}},BX.CDialog.prototype.btnCancel=BX.CDialog.btnCancel={title:BX.message("JS_CORE_WINDOW_CANCEL"),id:"cancel",name:"cancel",action:function(){this.parentWindow.Close()}},BX.CDialog.prototype.btnClose=BX.CDialog.btnClose={title:BX.message("JS_CORE_WINDOW_CLOSE"),id:"close",name:"close",action:function(){this.parentWindow.Close()}},BX.CAdminDialog=function(t){BX.CAdminDialog.superclass.constructor.apply(this,arguments),this._sender="core_window_cadmindialog",BX.addClass(this.DIV,"bx-core-adm-admin-dialog"),this.PARTS.CONTENT.insertBefore(this.PARTS.HEAD,this.PARTS.CONTENT.firstChild),this.PARTS.HEAD.className="bx-core-adm-dialog-tabs"},BX.extend(BX.CAdminDialog,BX.CDialog),BX.CAdminDialog.prototype.SetHead=function(){if(BX.CAdminDialog.superclass.SetHead.apply(this,arguments),this.PARTS.HEAD.firstChild&&BX.type.isElementNode(this.PARTS.HEAD.firstChild)){for(var t=this.PARTS.HEAD.firstChild,e=0,i=0,s=0;t;)BX.type.isElementNode(t)&&(i=parseInt(BX.style(t,"margin-left"),10),isNaN(i)&&(i=0),s=parseInt(BX.style(t,"margin-right"),10),isNaN(s)&&(s=0),e+=t.offsetWidth+i+s),t=BX.nextSibling(t);this.SETTINGS.min_width=Math.max(e,this.SETTINGS.min_width)-2,this.PARAMS.width<this.SETTINGS.min_width&&BX.adjust(this.PARTS.CONTENT_DATA,{style:{width:this.SETTINGS.min_width+"px"}})}},BX.CAdminDialog.prototype.SetContent=function(t){this.__form=null,BX.type.isElementNode(t)&&t.parentNode&&t.parentNode.removeChild(t),this.PARAMS.content=t,BX.cleanNode(this.PARTS.CONTENT_DATA),BX.adjust(this.PARTS.CONTENT_DATA,{children:[this.PARAMS.content||"&nbsp;"]}),this.PARAMS.content_url&&this.GetForm()&&(this.__form.appendChild(BX.create("INPUT",{props:{type:"submit"},style:{display:"none"}})),this.__form.onsubmit=BX.delegate(this.__submit,this))},BX.CAdminDialog.prototype.__expandGetSize=function(){var t=BX.CAdminDialog.superclass.__expandGetSize.apply(this,arguments);return t.width-=parseInt(BX.style(this.PARTS.CONTENT_DATA,"padding-right"))+parseInt(BX.style(this.PARTS.CONTENT_DATA,"padding-left")),t.height-=parseInt(BX.style(this.PARTS.CONTENT_DATA,"padding-top"))+parseInt(BX.style(this.PARTS.CONTENT_DATA,"padding-bottom")),t.height-=this.PARTS.HEAD.offsetHeight,t},BX.CAdminDialog.prototype.Submit=function(){var t=this.GetForm();return!t||t.bxpublic||/bxpublic=/.test(t.action)||t.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"bxpublic",value:"Y"}})),BX.CAdminDialog.superclass.Submit.apply(this,arguments)},BX.CAdminDialog.prototype.btnSave=BX.CAdminDialog.btnSave={title:BX.message("JS_CORE_WINDOW_SAVE"),id:"savebtn",name:"savebtn",className:"adm-btn-save",action:function(){this.disableUntilError(),this.parentWindow.Submit()}},BX.CAdminDialog.btnCancel=BX.CAdminDialog.superclass.btnCancel,BX.CAdminDialog.btnClose=BX.CAdminDialog.superclass.btnClose,BX.CDebugDialog=function(t){BX.CDebugDialog.superclass.constructor.apply(this,arguments)},BX.extend(BX.CDebugDialog,BX.CDialog),BX.CDebugDialog.prototype.ShowDetails=function(t){var e=BX(t);e&&(this.div_detail_current&&(this.div_detail_current.style.display="none"),e.style.display="block",this.div_detail_current=e)},BX.CDebugDialog.prototype.SetContent=function(t){if(t){var e=t.split("#DIVIDER#");e.length>1?(this.PARAMS.content=e[1],this.PARTS.CONTENT_DATA.style.overflow="hidden",BX.CDebugDialog.superclass.SetContent.apply(this,[e[1]]),this.PARTS.CONTENT_INNER=this.PARTS.CONTENT_DATA.firstChild.nextSibling,this.PARTS.CONTENT_TOP=this.PARTS.CONTENT_DATA.insertBefore(BX.create("DIV",{props:{className:"bx-debug-content-top"},html:e[0]}),this.PARTS.CONTENT_INNER),this.PARTS.CONTENT_INNER.style.overflow="auto"):BX.CDebugDialog.superclass.SetContent.apply(this,arguments)}},BX.CDebugDialog.prototype.__adjustSize=function(){if(BX.CDebugDialog.superclass.__adjustSize.apply(this,arguments),this.PARTS.CONTENT_TOP){var t=this.PARTS.CONTENT_DATA.offsetHeight-this.PARTS.HEAD.offsetHeight-this.PARTS.CONTENT_TOP.offsetHeight-38;t>0&&(this.PARTS.CONTENT_INNER.style.height=t+"px")}},BX.CEditorDialog=function(t){BX.CEditorDialog.superclass.constructor.apply(this,arguments),BX.removeClass(this.PARTS.CONTENT,"bx-core-adm-dialog-content-wrap"),BX.removeClass(this.PARTS.CONTENT_DATA,"bx-core-adm-dialog-content"),BX.removeClass(this.PARTS.CONTENT_DATA.lastChild,"bx-core-adm-dialog-content-wrap-inner"),BX.removeClass(this.PARTS.BUTTONS_CONTAINER,"bx-core-adm-dialog-buttons"),BX.addClass(this.PARTS.CONTENT,"bx-core-editor-dialog-content-wrap"),BX.addClass(this.PARTS.CONTENT_DATA,"bx-core-editor-dialog-content"),BX.addClass(this.PARTS.BUTTONS_CONTAINER,"bx-core-editor-dialog-buttons")},BX.extend(BX.CEditorDialog,BX.CDialog),BX.CEditorDialog.prototype.SetContent=function(){BX.CEditorDialog.superclass.SetContent.apply(this,arguments),BX.removeClass(this.PARTS.CONTENT_DATA.lastChild,"bx-core-adm-dialog-content-wrap-inner")},BX.CWizardDialog=function(t){BX.CWizardDialog.superclass.constructor.apply(this,arguments),BX.removeClass(this.PARTS.CONTENT,"bx-core-adm-dialog-content-wrap"),BX.removeClass(this.PARTS.CONTENT_DATA,"bx-core-adm-dialog-content"),BX.removeClass(this.PARTS.CONTENT_DATA.lastChild,"bx-core-adm-dialog-content-wrap-inner"),BX.removeClass(this.PARTS.BUTTONS_CONTAINER,"bx-core-adm-dialog-buttons"),BX.addClass(this.PARTS.CONTENT,"bx-core-wizard-dialog-content-wrap")},BX.extend(BX.CWizardDialog,BX.CDialog),BX.CAuthDialog=function(t){t.resizable=!1,t.width=350,t.height=200,t.buttons=[this.btnSave],BX.CAuthDialog.superclass.constructor.apply(this,arguments),this._sender="core_window_cauthdialog",BX.addClass(this.DIV,"bx-core-auth-dialog"),BX.AUTHAGENT=this},BX.extend(BX.CAuthDialog,BX.CDialog),BX.CAuthDialog.prototype.btnSave=BX.CAuthDialog.btnSave={title:BX.message("JS_CORE_WINDOW_AUTH"),id:"savebtn",name:"savebtn",className:"adm-btn-save",action:function(){this.disableUntilError(),this.parentWindow.Submit("",this.parentWindow.PARAMS.content_url)}},BX.CAuthDialog.prototype.SetError=function(t){BX.closeWait(),t&&this.ShowError(t.MESSAGE||t)},BX.CAuthDialog.prototype.setAuthResult=function(t){BX.closeWait(),!1===t?(this.Close(),this.PARAMS.callback&&this.PARAMS.callback()):this.SetError(t)},BX.CWindowFloat=function(t){BX.CWindowFloat.superclass.constructor.apply(this,[t,"float"]),this.SETTINGS.resizable=!1},BX.extend(BX.CWindowFloat,BX.CWindow),BX.CWindowFloat.prototype.adjustPos=function(){this.PARAMS.parent?this.adjustToNode():this.PARAMS.x&&this.PARAMS.y&&this.adjustToPos([this.PARAMS.x,this.PARAMS.y])},BX.CWindowFloat.prototype.adjustToPos=function(t){this.DIV.style.left=parseInt(t[0])+"px",this.DIV.style.top=parseInt(t[1])+"px"},BX.CWindowFloat.prototype.adjustToNodeGetPos=function(){return BX.pos(this.PARAMS.parent)},BX.CWindowFloat.prototype.adjustToNode=function(t){if(t=t||this.PARAMS.parent,this.PARAMS.parent=BX(t),this.PARAMS.parent){var e=this.adjustToNodeGetPos();this.DIV.style.top=e.top+"px",this.DIV.style.left=e.left+"px",this.PARAMS.parent.OPENER=this}},BX.CWindowFloat.prototype.Show=function(){this.adjustToPos([-1e3,-1e3]),BX.CWindowFloat.superclass.Show.apply(this,arguments),this.adjustPos()},BX.COpener=function(t){this.PARAMS=t||{},this.MENU=t.MENU||[],this.DIV=t.DIV,this.ATTACH=t.ATTACH||t.DIV,this.ATTACH_MODE=t.ATTACH_MODE||"bottom",this.ACTIVE_CLASS=t.ACTIVE_CLASS||"",this.PUBLIC_FRAME=t.PUBLIC_FRAME||0,this.LEVEL=t.LEVEL||0,this.CLOSE_ON_CLICK=void 0===t.CLOSE_ON_CLICK||!!t.CLOSE_ON_CLICK,this.ADJUST_ON_CLICK=void 0===t.ADJUST_ON_CLICK||!!t.ADJUST_ON_CLICK,this.TYPE="hover"==this.PARAMS.TYPE?"hover":"click",this._openTimeout=null,"hover"==this.PARAMS.TYPE&&0!==t.TIMEOUT?this.TIMEOUT=t.TIMEOUT||1e3:this.TIMEOUT=0,this.PARAMS.MENU_URL&&(this.bMenuLoaded=!1,this.bMenuLoading=!1,this.MENU=[{TEXT:BX.message("JS_CORE_LOADING"),CLOSE_ON_CLICK:!1}],this.PARAMS.MENU_PRELOAD&&BX.defer(this.Load,this)()),BX.ready(BX.defer(this.Init,this))},BX.COpener.prototype.Init=function(){switch(this.DIV=BX(this.DIV),this.TYPE){case"hover":BX.bind(this.DIV,"mouseover",BX.proxy(this.Open,this)),BX.bind(this.DIV,"click",BX.proxy(this.Toggle,this));break;case"click":BX.bind(this.DIV,"click",BX.proxy(this.Toggle,this))}this.bMenuInit=!1},BX.COpener.prototype.Load=function(){if(this.PARAMS.MENU_URL&&!this.bMenuLoaded&&!this.bMenuLoading){var t=this.PARAMS.MENU_URL;t.indexOf("sessid=")<=0&&(t+=(t.indexOf("?")>0?"&":"?")+"sessid="+BX.bitrix_sessid()),this.bMenuLoading=!0,BX.ajax.loadJSON(t,BX.proxy(this.SetMenu,this),BX.proxy(this.LoadFailed,this))}},BX.COpener.prototype.SetMenu=function(t){this.bMenuLoaded=!0,this.bMenuLoading=!1,this.bMenuInit?this.MENU.setItems(t):this.MENU=t},BX.COpener.prototype.LoadFailed=function(t,e){this.bMenuLoading=!1,this.SetMenu([{TEXT:BX.message("JS_CORE_NO_DATA"),CLOSE_ON_CLICK:!0}]),BX.debug(arguments)},BX.COpener.prototype.checkAdminMenu=function(){return"bx-admin-prefix"==document.documentElement.id||!!BX.findParent(this.DIV,{property:{id:"bx-admin-prefix"}})},BX.COpener.prototype.Toggle=function(t){if(this.__clear_timeout(),this.bMenuInit&&this.MENU.visible())this.MENU.Close();else{var e=this.TIMEOUT;this.TIMEOUT=0,this.Open(t),this.TIMEOUT=e}return!(!t&&!window.event)&&BX.PreventDefault(t)},BX.COpener.prototype.GetMenu=function(){return this.bMenuInit||(BX.type.isArray(this.MENU)&&(this.MENU=new BX.CMenu({ITEMS:this.MENU,ATTACH_MODE:this.ATTACH_MODE,SET_ID:this.checkAdminMenu()?"bx-admin-prefix":"",CLOSE_ON_CLICK:!!this.CLOSE_ON_CLICK,ADJUST_ON_CLICK:!!this.ADJUST_ON_CLICK,PUBLIC_FRAME:!!this.PUBLIC_FRAME,LEVEL:this.LEVEL,parent:BX(this.DIV),parent_attach:BX(this.ATTACH)}),this.LEVEL>0&&(BX.bind(this.MENU.DIV,"mouseover",BX.proxy(this._on_menu_hover,this)),BX.bind(this.MENU.DIV,"mouseout",BX.proxy(this._on_menu_hout,this)))),BX.addCustomEvent(this.MENU,"onMenuOpen",BX.proxy(this.handler_onopen,this)),BX.addCustomEvent(this.MENU,"onMenuClose",BX.proxy(this.handler_onclose,this)),BX.addCustomEvent("onMenuItemHover",BX.proxy(this.handler_onover,this)),this.bMenuInit=!0),this.MENU},BX.COpener.prototype.Open=function(){return this.GetMenu(),this.bOpen=!0,this.__clear_timeout(),this.TIMEOUT>0?(BX.bind(this.DIV,"mouseout",BX.proxy(this.__clear_timeout,this)),this._openTimeout=setTimeout(BX.proxy(this.__open,this),this.TIMEOUT)):this.__open(),this.PARAMS.MENU_URL&&!this.bMenuLoaded&&(this._loadTimeout=setTimeout(BX.proxy(this.Load,this),parseInt(this.TIMEOUT/2))),!0},BX.COpener.prototype.__clear_timeout=function(){this._openTimeout&&clearTimeout(this._openTimeout),this._loadTimeout&&clearTimeout(this._loadTimeout),BX.unbind(this.DIV,"mouseout",BX.proxy(this.__clear_timeout,this))},BX.COpener.prototype._on_menu_hover=function(){this.bMenuHover=!0,this.__clear_timeout(),this.ACTIVE_CLASS&&BX.addClass(this.DIV,this.ACTIVE_CLASS)},BX.COpener.prototype._on_menu_hout=function(){this.bMenuHover=!1},BX.COpener.prototype.handler_onover=function(t,e){this.bMenuHover||(e!=this&&t==this.LEVEL-1&&this.ACTIVE_CLASS&&BX.removeClass(this.DIV,this.ACTIVE_CLASS),this.bMenuInit&&t<=this.LEVEL-1&&this.MENU.visible()&&e!=this&&(this.__clear_timeout(),this._openTimeout=setTimeout(BX.proxy(this.Close,this),this.TIMEOUT)))},BX.COpener.prototype.handler_onopen=function(){this.bOpen=!0,this.ACTIVE_CLASS&&BX.addClass(this.DIV,this.ACTIVE_CLASS),BX.defer((function(){BX.onCustomEvent(this,"onOpenerMenuOpen")}),this)()},BX.COpener.prototype.handler_onclose=function(){this.bOpen=!1,BX.onCustomEvent(this,"onOpenerMenuClose"),this.ACTIVE_CLASS&&BX.removeClass(this.DIV,this.ACTIVE_CLASS)},BX.COpener.prototype.Close=function(){this.bMenuInit&&(this._openTimeout&&clearTimeout(this._openTimeout),this.bOpen=!1,this.__close())},BX.COpener.prototype.__open=function(){this.__clear_timeout(),this.bMenuInit&&this.bOpen&&!this.MENU.visible()&&this.MENU.Show()},BX.COpener.prototype.__close=function(){this.bMenuInit&&!this.bOpen&&this.MENU.visible()&&this.MENU.Hide()},BX.COpener.prototype.__close_immediately=function(){this.bOpen=!1,this.__close()},BX.COpener.prototype.isMenuVisible=function(){return null!=this.MENU.visible&&this.MENU.visible()},BX.CMenu=function(t){BX.CMenu.superclass.constructor.apply(this),this.DIV.style.width="auto",this.DIV.style.height="auto",this.PARAMS=t||{},this.PARTS={},this.PARAMS.ATTACH_MODE=this.PARAMS.ATTACH_MODE||"bottom",this.PARAMS.CLOSE_ON_CLICK=void 0===this.PARAMS.CLOSE_ON_CLICK||this.PARAMS.CLOSE_ON_CLICK,this.PARAMS.ADJUST_ON_CLICK=void 0===this.PARAMS.ADJUST_ON_CLICK||this.PARAMS.ADJUST_ON_CLICK,this.PARAMS.PUBLIC_FRAME=void 0!==this.PARAMS.PUBLIC_FRAME&&this.PARAMS.PUBLIC_FRAME,this.PARAMS.LEVEL=this.PARAMS.LEVEL||0,this.DIV.className="bx-core-popup-menu bx-core-popup-menu-"+this.PARAMS.ATTACH_MODE+" bx-core-popup-menu-level"+this.PARAMS.LEVEL+(void 0!==this.PARAMS.ADDITIONAL_CLASS?" "+this.PARAMS.ADDITIONAL_CLASS:""),this.PARAMS.SET_ID&&(this.DIV.id=this.PARAMS.SET_ID),0==this.PARAMS.LEVEL&&(this.ARROW=this.DIV.appendChild(BX.create("SPAN",{props:{className:"bx-core-popup-menu-angle"},style:{left:"15px"}}))),this.PARAMS.CLASS_NAME&&(this.DIV.className+=" "+this.PARAMS.CLASS_NAME),BX.bind(this.DIV,"click",BX.eventCancelBubble),this.ITEMS=[],this.setItems(this.PARAMS.ITEMS),BX.addCustomEvent("onMenuOpen",BX.proxy(this._onMenuOpen,this)),BX.addCustomEvent("onMenuItemSelected",BX.proxy(this.Hide,this))},BX.extend(BX.CMenu,BX.CWindowFloat),BX.CMenu.broadcastCloseEvent=function(){BX.onCustomEvent("onMenuItemSelected")},BX.CMenu._toggleChecked=function(){BX.toggleClass(this,"bx-core-popup-menu-item-checked")},BX.CMenu._itemDblClick=function(){window.location.href=this.href},BX.CMenu.prototype.toggleArrow=function(t){this.ARROW&&(void 0===t&&(t="hidden"==this.ARROW.style.visibility),this.ARROW.style.visibility=t?"visible":"hidden")},BX.CMenu.prototype.visible=function(){return"none"!==this.DIV.style.display},BX.CMenu.prototype._onMenuOpen=function(t,e){this.visible()&&e==this.PARAMS.LEVEL&&t!=this&&this.Hide()},BX.CMenu.prototype.onUnRegister=function(){this.visible()&&this.Hide()},BX.CMenu.prototype.setItems=function(t){if(this.PARAMS.ITEMS=t,BX.cleanNode(this.DIV),this.ARROW&&this.DIV.appendChild(this.ARROW),this.PARAMS.ITEMS){this.PARAMS.ITEMS=BX.util.array_values(this.PARAMS.ITEMS);for(var e=!1,i=0,s=0,n=this.PARAMS.ITEMS.length;s<n;s++)(0!=s&&s!=n-1||!this.PARAMS.ITEMS[s].SEPARATOR)&&(i++,e||(e=!!this.PARAMS.ITEMS[s].GLOBAL_ICON),this.addItem(this.PARAMS.ITEMS[s],s));1===i?BX.addClass(this.DIV,"bx-core-popup-menu-single-item"):BX.removeClass(this.DIV,"bx-core-popup-menu-single-item"),e?BX.removeClass(this.DIV,"bx-core-popup-menu-no-icons"):BX.addClass(this.DIV,"bx-core-popup-menu-no-icons")}},BX.CMenu.prototype.addItem=function(t){if(this.ITEMS.push(t),t.SEPARATOR)t.NODE=BX.create("DIV",{props:{className:"bx-core-popup-menu-separator"}});else{var e=!!t.MENU&&(BX.type.isArray(t.MENU)&&t.MENU.length>0||t.MENU instanceof BX.CMenu)||!!t.MENU_URL;t.DISABLED&&(t.CLOSE_ON_CLICK=!1,t.LINK=null,t.ONCLICK=null,t.ACTION=null);var i={};(t.LINK||BX.browser.IsIE()&&!BX.browser.IsDoctype())&&(i.href=t.LINK||"javascript:void(0)"),this.PARAMS.PUBLIC_FRAME&&(i.target="_top"),t.NODE=BX.create(t.LINK||BX.browser.IsIE()&&!BX.browser.IsDoctype()?"A":"SPAN",{props:{className:"bx-core-popup-menu-item"+(e?" bx-core-popup-menu-item-opener":"")+(t.DEFAULT?" bx-core-popup-menu-item-default":"")+(t.DISABLED?" bx-core-popup-menu-item-disabled":"")+(t.CHECKED?" bx-core-popup-menu-item-checked":""),title:(BX.message.MENU_ENABLE_TOOLTIP||t.SHOW_TITLE)&&t.TITLE||"",BXMENULEVEL:this.PARAMS.LEVEL},attrs:i,events:{mouseover:function(){BX.onCustomEvent("onMenuItemHover",[this.BXMENULEVEL,this.OPENER])}},html:'<span class="bx-core-popup-menu-item-icon'+(t.GLOBAL_ICON?" "+t.GLOBAL_ICON:"")+'"></span><span class="bx-core-popup-menu-item-text">'+(t.HTML||(t.TEXT?BX.util.htmlspecialchars(t.TEXT):""))+"</span>"}),e&&!t.DISABLED?t.NODE.OPENER=new BX.COpener({DIV:t.NODE,ACTIVE_CLASS:"bx-core-popup-menu-item-opened",TYPE:"hover",MENU:t.MENU,MENU_URL:t.MENU_URL,MENU_PRELOAD:!!t.MENU_PRELOAD,LEVEL:this.PARAMS.LEVEL+1,ATTACH_MODE:"right",TIMEOUT:500}):this.PARAMS.CLOSE_ON_CLICK&&(void 0===t.CLOSE_ON_CLICK||t.CLOSE_ON_CLICK)?BX.bind(t.NODE,"click",BX.CMenu.broadcastCloseEvent):this.PARAMS.ADJUST_ON_CLICK&&(void 0===t.ADJUST_ON_CLICK||t.ADJUST_ON_CLICK)&&BX.bind(t.NODE,"click",BX.defer(this.adjustPos,this)),e&&t.LINK&&BX.bind(t.NODE,"dblclick",BX.CMenu._itemDblClick),void 0!==t.CHECKED&&BX.bind(t.NODE,"click",BX.CMenu._toggleChecked),t.ONCLICK=t.ACTION||t.ONCLICK,t.ONCLICK&&(BX.type.isString(t.ONCLICK)&&(t.ONCLICK=new Function("event",t.ONCLICK)),BX.bind(t.NODE,"click",t.ONCLICK))}this.DIV.appendChild(t.NODE)},BX.CMenu.prototype._documentClickBind=function(){this._documentClickUnBind(),BX.bind(document,"click",BX.proxy(this._documentClick,this))},BX.CMenu.prototype._documentClickUnBind=function(){BX.unbind(document,"click",BX.proxy(this._documentClick,this))},BX.CMenu.prototype._documentClick=function(t){(!(t=t||window.event)||BX.getEventButton(t)&BX.MSLEFT)&&this.Close()},BX.CMenu.prototype.Show=function(){BX.onCustomEvent(this,"onMenuOpen",[this,this.PARAMS.LEVEL]),BX.CMenu.superclass.Show.apply(this,[]),this.bCloseEventFired=!1,BX.addCustomEvent(this.PARAMS.parent_attach,"onChangeNodePosition",BX.proxy(this.adjustToNode,this)),BX.defer(this._documentClickBind,this)()},BX.CMenu.prototype.Close=BX.CMenu.prototype.Hide=function(){this.visible()&&(BX.removeCustomEvent(this.PARAMS.parent_attach,"onChangeNodePosition",BX.proxy(this.adjustToNode,this)),this._documentClickUnBind(),this.bCloseEventFired||(BX.onCustomEvent(this,"onMenuClose",[this,this.PARAMS.LEVEL]),this.bCloseEventFired=!0),BX.CMenu.superclass.Hide.apply(this,arguments))},BX.CMenu.prototype.__adjustMenuToNode=function(){var t=BX.pos(this.PARAMS.parent_attach),e=!!BX.findParent(this.PARAMS.parent_attach,BX.is_fixed);if(this.DIV.style.position=e?"fixed":"absolute",t.top||(this.DIV.style.top="-1000px",this.DIV.style.left="-1000px"),!this.bTimeoutSet){var i=this.DIV.offsetWidth,s=this.DIV.offsetHeight;if(!i)return setTimeout(BX.delegate((function(){this.bTimeoutSet=!1,this.__adjustMenuToNode()}),this),100),void(this.bTimeoutSet=!0);var n={},o=BX.GetWindowSize();switch(this.PARAMS.ATTACH_MODE){case"bottom":n.top=t.bottom+9,n.left=t.left;var a=0;if(this.ARROW&&(a=t.width>i?parseInt(i/2-7):parseInt(Math.min(i,t.width)/2-7))<7&&(n.left-=15,a+=15),n.left>o.scrollWidth-i-10){var r=n.left;n.left=o.scrollWidth-i-10,this.ARROW&&(a+=r-n.left)}e&&(n.left-=o.scrollLeft),this.ARROW&&(this.ARROW.style.left=a+"px");break;case"right":n.top=t.top-1,n.left=t.right,n.left>o.scrollWidth-i-10&&(n.left=t.left-i-1)}if(e&&(n.top-=o.scrollTop),this.ARROW&&(this.ARROW.className="bx-core-popup-menu-angle"),n.top+s>o.scrollTop+o.innerHeight||n.top+s>o.scrollHeight){var h="bottom"==this.PARAMS.ATTACH_MODE?t.top-s-9:t.bottom-s+1;(h>o.scrollTop||n.top+s>o.scrollHeight)&&(n.top+s>o.scrollHeight?(n.top=Math.max(0,o.scrollHeight-s),this.toggleArrow(!1)):(n.top=h,this.ARROW&&(this.ARROW.className="bx-core-popup-menu-angle-bottom")))}n.top+n.left==0?this.Hide():(this.DIV.style.top=n.top+"px",this.DIV.style.left=n.left+"px")}},BX.CMenu.prototype.adjustToNode=function(t){this.PARAMS.parent_attach=BX(t)||this.PARAMS.parent_attach||this.PARAMS.parent,this.__adjustMenuToNode()},BX.CMenuOpener=function(t){BX.CMenuOpener.superclass.constructor.apply(this),this.PARAMS=t||{},this.setParent(this.PARAMS.parent),this.PARTS={},this.SETTINGS.drag_restrict=!0,this.defaultAction=null,this.timeout=500,this.DIV.className="bx-component-opener",this.DIV.ondblclick=BX.PreventDefault,this.PARAMS.component_id&&(this.PARAMS.transform=!!this.PARAMS.transform),this.OPENERS=[],this.DIV.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar"+(this.PARAMS.transform?" bx-context-toolbar-vertical-mode":"")}})),this.PARTS.INNER=this.DIV.firstChild.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-inner"},html:'<span class="bx-context-toolbar-drag-icon"></span><span class="bx-context-toolbar-vertical-line"></span><br>'})),this.EXTRA_BUTTONS={};for(var e=0,i=0,s=this.PARAMS.menu.length;i<s;i++){var n=this.addItem(this.PARAMS.menu[i]);null!=n&&(e++,this.PARTS.INNER.appendChild(n),this.PARTS.INNER.appendChild(BX.create("BR")))}var o=e>0;if(this.PARTS.ICONS=this.PARTS.INNER.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-icons"}})),this.PARAMS.component_id&&(this.PARAMS.pin=!!this.PARAMS.pin,o&&this.PARTS.ICONS.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-separator"}})),this.PARTS.ICON_PIN=this.PARTS.ICONS.appendChild(BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:this.PARAMS.pin?"bx-context-toolbar-pin-fixed":"bx-context-toolbar-pin"},events:{click:BX.delegate(this.__pin_btn_clicked,this)}}))),this.EXTRA_BUTTONS.components2_props){var a=this.EXTRA_BUTTONS.components2_props||{URL:"javascript:void(0)"};null==this.defaultAction&&(this.defaultAction=a.ONCLICK,this.defaultActionTitle=a.TITLE||a.TEXT),a.URL="javascript:"+BX.util.urlencode(a.ONCLICK),this.ATTACH=this.PARTS.ICONS.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-button bx-context-toolbar-button-settings"},children:[BX.create("SPAN",{props:{className:"bx-context-toolbar-button-inner"},children:[BX.create("A",{attrs:{href:a.URL},events:{mouseover:BX.proxy(this.__msover_text,this),mouseout:BX.proxy(this.__msout_text,this),mousedown:BX.proxy(this.__msdown_text,this)},html:'<span class="bx-context-toolbar-button-icon bx-context-toolbar-settings-icon"></span>'}),BX.create("A",{attrs:{href:"javascript: void(0)"},props:{className:"bx-context-toolbar-button-arrow"},events:{mouseover:BX.proxy(this.__msover_arrow,this),mouseout:BX.proxy(this.__msout_arrow,this),mousedown:BX.proxy(this.__msdown_arrow,this)},html:'<span class="bx-context-toolbar-button-arrow"></span>'})]})]})),this.OPENER=this.ATTACH.firstChild.lastChild;var r=this.attachMenu(this.EXTRA_BUTTONS.components2_submenu.MENU);BX.addCustomEvent(r,"onOpenerMenuOpen",BX.proxy(this.__menu_open,this)),BX.addCustomEvent(r,"onOpenerMenuClose",BX.proxy(this.__menu_close,this))}if(e>1&&(this.PARTS.ICONS.appendChild(BX.create("span",{props:{className:"bx-context-toolbar-separator bx-context-toolbar-separator-switcher"}})),this.ICON_TRANSFORM=this.PARTS.ICONS.appendChild(BX.create("A",{attrs:{href:"javascript: void(0)"},props:{className:"bx-context-toolbar-switcher"},events:{click:BX.delegate(this.__trf_btn_clicked,this)}}))),this.PARAMS.HINT&&(this.DIV.BXHINT=this.HINT=new BX.CHint({parent:this.DIV,hint:this.PARAMS.HINT.TEXT||"",title:this.PARAMS.HINT.TITLE||"",hide_timeout:this.timeout/2,preventHide:!1})),BX.addCustomEvent(this,"onWindowDragFinished",BX.delegate(this.__onMoveFinished,this)),BX.addCustomEvent("onDynamicModeChange",BX.delegate(this.__onDynamicModeChange,this)),BX.addCustomEvent("onTopPanelCollapse",BX.delegate(this.__onPanelCollapse,this)),BX.addCustomEvent("onMenuOpenerMoved",BX.delegate(this.checkPosition,this)),BX.addCustomEvent("onMenuOpenerUnhide",BX.delegate(this.checkPosition,this)),this.OPENERS)for(i=0,s=this.OPENERS.length;i<s;i++)BX.addCustomEvent(this.OPENERS[i],"onOpenerMenuOpen",BX.proxy(this.__hide_hint,this))},BX.extend(BX.CMenuOpener,BX.CWindowFloat),BX.CMenuOpener.prototype.setParent=function(t){(t=BX(t)).OPENER&&t.OPENER!=this&&(t.OPENER.Close(),t.OPENER.clearHoverHoutEvents()),this.PARAMS.parent&&this.PARAMS.parent!=t&&(this.clearHoverHoutEvents(),this.PARAMS.parent.OPENER=null),this.PARAMS.parent=t,this.PARAMS.parent.OPENER=this},BX.CMenuOpener.prototype.setHoverHoutEvents=function(t,e){this.__opener_events_set||(BX.bind(this.Get(),"mouseover",t),BX.bind(this.Get(),"mouseout",e),this.__opener_events_set=!0)},BX.CMenuOpener.prototype.clearHoverHoutEvents=function(){this.Get()&&(BX.unbindAll(this.Get()),this.__opener_events_set=!1)},BX.CMenuOpener.prototype.unclosable=!0,BX.CMenuOpener.prototype.__check_intersection=function(t,e){return!(e.right<=t.left||e.left>=t.right||e.bottom<=t.top||e.top>=t.bottom)},BX.CMenuOpener.prototype.__msover_text=function(){this.bx_hover=!0,this._menu_open||BX.addClass(this.ATTACH,"bx-context-toolbar-button-text-hover")},BX.CMenuOpener.prototype.__msout_text=function(){this.bx_hover=!1,this._menu_open||BX.removeClass(this.ATTACH,"bx-context-toolbar-button-text-hover bx-context-toolbar-button-text-active")},BX.CMenuOpener.prototype.__msover_arrow=function(){this.bx_hover=!0,this._menu_open||BX.addClass(this.ATTACH,"bx-context-toolbar-button-arrow-hover")},BX.CMenuOpener.prototype.__msout_arrow=function(){this.bx_hover=!1,this._menu_open||BX.removeClass(this.ATTACH,"bx-context-toolbar-button-arrow-hover bx-context-toolbar-button-arrow-active")},BX.CMenuOpener.prototype.__msdown_text=function(){this.bx_active=!0,this._menu_open||BX.addClass(this.ATTACH,"bx-context-toolbar-button-text-active")},BX.CMenuOpener.prototype.__msdown_arrow=function(){this.bx_active=!0,this._menu_open||BX.addClass(this.ATTACH,"bx-context-toolbar-button-arrow-active")},BX.CMenuOpener.prototype.__menu_close=function(){this._menu_open=!1,this.bx_active=!1,BX.removeClass(this.ATTACH,"bx-context-toolbar-button-active bx-context-toolbar-button-text-active bx-context-toolbar-button-arrow-active"),this.bx_hover||(BX.removeClass(this.ATTACH,"bx-context-toolbar-button-hover bx-context-toolbar-button-text-hover bx-context-toolbar-button-arrow-hover"),this.bx_hover=!1)},BX.CMenuOpener.prototype.__menu_open=function(){this._menu_open=!0},BX.CMenuOpener.prototype.checkPosition=function(){this.isMenuVisible()||"none"==this.DIV.style.display||this==BX.proxy_context||BX.proxy_context.zIndex>this.zIndex||this.correctPosition(BX.proxy_context)},BX.CMenuOpener.prototype.correctPosition=function(t){var e=BX.pos(this.DIV),i=BX.pos(t.Get());if(this.__check_intersection(e,i)){var s=i.top-e.height;s<0&&(s=i.bottom),this.DIV.style.top=s+"px",BX.addCustomEvent(t,"onMenuOpenerHide",BX.proxy(this.restorePosition,this)),BX.onCustomEvent(this,"onMenuOpenerMoved")}},BX.CMenuOpener.prototype.restorePosition=function(){this.MOUSEOVER||this.isMenuVisible()?this.restore_pos_timeout=setTimeout(BX.proxy(this.restorePosition,this),this.timeout):(this.originalPos&&(this.DIV.style.top=this.originalPos.top+"px"),BX.removeCustomEvent(BX.proxy_context,"onMenuOpenerHide",BX.proxy(this.restorePosition,this)),this.restore_pos_timeout&&clearTimeout(this.restore_pos_timeout))},BX.CMenuOpener.prototype.Show=function(){BX.CMenuOpener.superclass.Show.apply(this,arguments),this.SetDraggable(this.PARTS.INNER.firstChild),this.DIV.style.width="auto",this.DIV.style.height="auto",this.PARAMS.pin?(this.bPosAdjusted=!0,this.bMoved=!0,this.PARAMS.top&&(this.DIV.style.top=this.PARAMS.top+"px"),this.PARAMS.left&&(this.DIV.style.left=this.PARAMS.left+"px"),this.DIV.style.display=!BX.admin.dynamic_mode||BX.admin.dynamic_mode_show_borders?"block":"none","block"==this.DIV.style.display&&setTimeout(BX.delegate((function(){BX.onCustomEvent(this,"onMenuOpenerUnhide")}),this),50)):(this.DIV.style.left="-1000px",this.DIV.style.top="-1000px",this.Hide())},BX.CMenuOpener.prototype.executeDefaultAction=function(){this.defaultAction&&(BX.type.isFunction(this.defaultAction)?this.defaultAction():BX.type.isString(this.defaultAction)&&BX.evalGlobal(this.defaultAction))},BX.CMenuOpener.prototype.__onDynamicModeChange=function(t){this.DIV.style.display=t?"block":"none"},BX.CMenuOpener.prototype.__onPanelCollapse=function(t,e){this.DIV.style.top=parseInt(this.DIV.style.top)+e+"px",this.PARAMS.pin&&this.__savePosition()},BX.CMenuOpener.prototype.__onMoveFinished=function(){BX.onCustomEvent(this,"onMenuOpenerMoved"),this.bMoved=!0,this.PARAMS.pin&&this.__savePosition()},BX.CMenuOpener.prototype.__savePosition=function(){var t={};t.pin=this.PARAMS.pin,this.PARAMS.pin?(t.transform=this.PARAMS.transform,this.bMoved&&(t.left=parseInt(this.DIV.style.left),t.top=parseInt(this.DIV.style.top))):(t.top=!1,t.left=!1,t.transform=!1),BX.WindowManager.saveWindowOptions(this.PARAMS.component_id,t)},BX.CMenuOpener.prototype.__pin_btn_clicked=function(){this.Pin()},BX.CMenuOpener.prototype.Pin=function(t){this.PARAMS.pin=null==t?!this.PARAMS.pin:!!t,this.PARTS.ICON_PIN.className=this.PARAMS.pin?"bx-context-toolbar-pin-fixed":"bx-context-toolbar-pin",this.__savePosition()},BX.CMenuOpener.prototype.__trf_btn_clicked=function(){this.Transform()},BX.CMenuOpener.prototype.Transform=function(t){var e={};this.PARAMS.transform=null==t?!this.PARAMS.transform:!!t,this.bMoved&&(e=BX.pos(this.DIV)),this.PARAMS.transform?BX.addClass(this.DIV.firstChild,"bx-context-toolbar-vertical-mode"):BX.removeClass(this.DIV.firstChild,"bx-context-toolbar-vertical-mode"),this.bMoved?this.DIV.style.left=e.right-this.DIV.offsetWidth-(BX.browser.IsIE()&&!BX.browser.IsDoctype()?2:0)+"px":this.adjustPos(),this.__savePosition()},BX.CMenuOpener.prototype.adjustToNodeGetPos=function(){var t=BX.pos(this.PARAMS.parent),e=BX.GetWindowScrollSize(),i=this.DIV.offsetWidth;return t.left-=BX.admin.__border_dx,t.top-=BX.admin.__border_dx,t.top-=45,t.left>e.scrollWidth-i&&(t.left=e.scrollWidth-i),t},BX.CMenuOpener.prototype.addItem=function(t){if(t.TYPE)return this.EXTRA_BUTTONS[t.TYPE]=t,null;var e=new BX.CMenuOpenerItem(t);return null==this.defaultAction&&(e.item.ONCLICK?this.defaultAction=t.ONCLICK:e.item.MENU&&(this.defaultAction=BX.delegate((function(){this.Open()}),e.item.OPENER)),this.defaultActionTitle=t.TITLE||t.TEXT,BX.addClass(e.Get(),"bx-content-toolbar-default")),e.item.OPENER&&(this.OPENERS[this.OPENERS.length]=e.item.OPENER),e.Get()},BX.CMenuOpener.prototype.attachMenu=function(t){var e=new BX.COpener({DIV:this.OPENER,ATTACH:this.ATTACH,MENU:t,TYPE:"click"});return this.OPENERS[this.OPENERS.length]=e,e},BX.CMenuOpener.prototype.__hide_hint=function(){this.HINT&&this.HINT.__hide_immediately()},BX.CMenuOpener.prototype.isMenuVisible=function(){for(var t=0,e=this.OPENERS.length;t<e;t++)if(this.OPENERS[t].isMenuVisible())return!0;return!1},BX.CMenuOpener.prototype.Hide=function(){this.PARAMS.pin||(this.DIV.style.display="none",BX.onCustomEvent(this,"onMenuOpenerHide"))},BX.CMenuOpener.prototype.UnHide=function(){this.DIV.style.display="block",this.bPosAdjusted||this.PARAMS.pin||(this.adjustPos(),this.bPosAdjusted=!0),null!=this.originalPos||this.bMoved||(this.originalPos=BX.pos(this.DIV)),BX.onCustomEvent(this,"onMenuOpenerUnhide")},BX.CMenuOpenerItem=function(t){this.item=t,this.item.ACTION&&!this.item.ONCLICK&&(this.item.ONCLICK=this.item.ACTION),this.DIV=BX.create("SPAN"),this.DIV.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-button-underlay"}})),this.WRAPPER=this.DIV.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-button-wrapper"},children:[BX.create("SPAN",{props:{className:"bx-context-toolbar-button",title:t.TITLE},children:[BX.create("SPAN",{props:{className:"bx-context-toolbar-button-inner"}})]})]}));var e=BX.create("SPAN",{props:{className:"bx-context-toolbar-button-icon"+(this.item.ICON||this.item.ICONCLASS?" "+(this.item.ICON||this.item.ICONCLASS):"")},attrs:this.item.ICON||this.item.ICONCLASS||!this.item.SRC&&!this.item.IMAGE?{}:{style:"background: scroll transparent url("+(this.item.SRC||this.item.IMAGE)+") no-repeat center center !important;"}}),i=BX.create("SPAN",{props:{className:"bx-context-toolbar-button-text"},text:this.item.TEXT});this.item.ACTION&&!this.item.ONCLICK&&(this.item.ONCLICK=this.item.ACTION),this.bHasMenu=!!this.item.MENU,this.bHasAction=!!this.item.ONCLICK,this.bHasAction?(this.LINK=this.WRAPPER.firstChild.firstChild.appendChild(BX.create("A",{attrs:{href:"javascript: void(0)"},events:{mouseover:this.bHasMenu?BX.proxy(this.__msover_text,this):BX.proxy(this.__msover,this),mouseout:this.bHasMenu?BX.proxy(this.__msout_text,this):BX.proxy(this.__msout,this),mousedown:this.bHasMenu?BX.proxy(this.__msdown_text,this):BX.proxy(this.__msdown,this)},children:[e,i]})),this.bHasMenu&&(this.LINK_MENU=this.WRAPPER.firstChild.firstChild.appendChild(BX.create("A",{props:{className:"bx-context-toolbar-button-arrow"},attrs:{href:"javascript: void(0)"},events:{mouseover:BX.proxy(this.__msover_arrow,this),mouseout:BX.proxy(this.__msout_arrow,this),mousedown:BX.proxy(this.__msdown_arrow,this)},children:[BX.create("SPAN",{props:{className:"bx-context-toolbar-button-arrow"}})]})))):this.bHasMenu&&(this.item.ONCLICK=null,this.LINK=this.LINK_MENU=this.WRAPPER.firstChild.firstChild.appendChild(BX.create("A",{attrs:{href:"javascript: void(0)"},events:{mouseover:BX.proxy(this.__msover,this),mouseout:BX.proxy(this.__msout,this),mousedown:BX.proxy(this.__msdown,this)},children:[e,i]})),this.LINK.appendChild(BX.create("SPAN",{props:{className:"bx-context-toolbar-single-button-arrow"}}))),this.bHasMenu&&(this.item.SUBMENU=new BX.CMenu({ATTACH_MODE:"bottom",ITEMS:this.item.MENU,parent:this.LINK_MENU,parent_attach:this.WRAPPER.firstChild}),this.item.OPENER=new BX.COpener({DIV:this.LINK_MENU,TYPE:"click",MENU:this.item.SUBMENU}),BX.addCustomEvent(this.item.OPENER,"onOpenerMenuOpen",BX.proxy(this.__menu_open,this)),BX.addCustomEvent(this.item.OPENER,"onOpenerMenuClose",BX.proxy(this.__menu_close,this))),this.bHasAction&&BX.bind(this.LINK,"click",BX.delegate(this.__click,this))},BX.CMenuOpenerItem.prototype.Get=function(){return this.DIV},BX.CMenuOpenerItem.prototype.__msover=function(){this.bx_hover=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-hover")},BX.CMenuOpenerItem.prototype.__msout=function(){this.bx_hover=!1,this._menu_open||BX.removeClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-hover bx-context-toolbar-button-active")},BX.CMenuOpenerItem.prototype.__msover_text=function(){this.bx_hover=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-text-hover")},BX.CMenuOpenerItem.prototype.__msout_text=function(){this.bx_hover=!1,this._menu_open||BX.removeClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-text-hover bx-context-toolbar-button-text-active")},BX.CMenuOpenerItem.prototype.__msover_arrow=function(){this.bx_hover=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-arrow-hover")},BX.CMenuOpenerItem.prototype.__msout_arrow=function(){this.bx_hover=!1,this._menu_open||BX.removeClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-arrow-hover bx-context-toolbar-button-arrow-active")},BX.CMenuOpenerItem.prototype.__msdown=function(){this.bx_active=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-active")},BX.CMenuOpenerItem.prototype.__msdown_text=function(){this.bx_active=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-text-active")},BX.CMenuOpenerItem.prototype.__msdown_arrow=function(){this.bx_active=!0,this._menu_open||BX.addClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-arrow-active")},BX.CMenuOpenerItem.prototype.__menu_close=function(){this._menu_open=!1,this.bx_active=!1,BX.removeClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-active bx-context-toolbar-button-text-active bx-context-toolbar-button-arrow-active"),this.bx_hover||(BX.removeClass(this.LINK.parentNode.parentNode,"bx-context-toolbar-button-hover bx-context-toolbar-button-text-hover bx-context-toolbar-button-arrow-hover"),this.bx_hover=!1)},BX.CMenuOpenerItem.prototype.__menu_open=function(){this._menu_open=!0},BX.CMenuOpenerItem.prototype.__click=function(){BX.evalGlobal(this.item.ONCLICK)},BX.CPageOpener=function(t){BX.CPageOpener.superclass.constructor.apply(this,arguments),this.timeout=505,window.PAGE_EDIT_CONTROL=this},BX.extend(BX.CPageOpener,BX.CMenuOpener),BX.CPageOpener.prototype.checkPosition=function(){this!=BX.proxy_context&&this.correctPosition(BX.proxy_context)},BX.CPageOpener.prototype.correctPosition=function(t){if(!this.bPosCorrected){var e;"none"==this.DIV.style.display?((e=this.adjustToNodeGetPos()).bottom=e.top+30,e.right=e.left+300):e=BX.pos(this.DIV);var i=BX.pos(t.Get());this.__check_intersection(e,i)&&(this.DIV.style.display="none",BX.addCustomEvent(t,"onMenuOpenerHide",BX.proxy(this.restorePosition,this)),this.bPosCorrected=!0)}},BX.CPageOpener.prototype.restorePosition=function(){BX.proxy_context&&"none"==BX.proxy_context.Get().style.display&&(this.bPosCorrected=!1,(this.PARAMS.parent.bx_over||this.PARAMS.pin)&&this.UnHide(),BX.removeCustomEvent("onMenuOpenerHide",BX.proxy(this.restorePosition,this)))},BX.CPageOpener.prototype.UnHide=function(){this.bPosCorrected||BX.CPageOpener.superclass.UnHide.apply(this,arguments)},BX.CPageOpener.prototype.Remove=function(){BX.admin.removeComponentBorder(this.PARAMS.parent),BX.userOptions.save("global","settings","page_edit_control_enable","N"),this.DIV.style.display="none"},BX.CHintSimple=function(){BX.CHintSimple.superclass.constructor.apply(this,arguments)},BX.extend(BX.CHintSimple,BX.CHint),BX.CHintSimple.prototype.Init=function(){this.DIV=document.body.appendChild(BX.create("DIV",{props:{className:"bx-tooltip-simple"},style:{display:"none"},children:[this.CONTENT=BX.create("DIV")]})),this.HINT_TITLE&&this.CONTENT.appendChild(BX.create("B",{text:this.HINT_TITLE})),this.HINT&&(this.CONTENT_TEXT=this.CONTENT.appendChild(BX.create("DIV")).appendChild(BX.create("SPAN",{html:this.HINT}))),this.PARAMS.preventHide&&(BX.bind(this.DIV,"mouseout",BX.proxy(this.Hide,this)),BX.bind(this.DIV,"mouseover",BX.proxy(this.Show,this))),this.bInited=!0},BX.adminInformer={itemsShow:3,Init:function(t){t&&(BX.adminInformer.itemsShow=t);var e=BX("admin-informer");e&&document.body.appendChild(e),BX.addCustomEvent("onTopPanelCollapse",BX.proxy(BX.adminInformer.Close,BX.adminInformer))},Toggle:function(t){var e=BX("admin-informer");if(!e)return!1;var i=BX.pos(t);return e.style.top=parseInt(i.top)+parseInt(i.height)+7+"px",e.style.left=i.left+"px",BX.hasClass(e,"adm-informer-active")?BX.adminInformer.Hide(e):BX.adminInformer.Show(e),!1},Close:function(){BX.adminInformer.Hide(BX("admin-informer"))},OnInnerClick:function(t){var e=t.target||t.srcElement;return"a"==e.nodeName.toLowerCase()&&!BX.hasClass(e,"adm-informer-footer")||BX.PreventDefault(t)},ToggleExtra:function(){var t=BX("adm-informer-footer");return BX.hasClass(t,"adm-informer-footer-collapsed")?this.ShowAll():this.HideExtra(),!1},ShowAll:function(){for(var t=BX("admin-informer"),e=0;e<t.children.length;e++)BX.hasClass(t.children[e],"adm-informer-item")&&"none"==t.children[e].style.display&&(t.children[e].style.display="block");var i=BX("adm-informer-footer");return void 0!==i.textContent?i.textContent=BX.message("JSADM_AI_HIDE_EXTRA"):i.innerText=BX.message("JSADM_AI_HIDE_EXTRA"),BX.removeClass(i,"adm-informer-footer-collapsed"),!1},HideExtra:function(){for(var t=BX("admin-informer"),e=0,i=BX.adminInformer.itemsShow+1;i<t.children.length;i++)BX.hasClass(t.children[i],"adm-informer-item")&&"block"==t.children[i].style.display&&(t.children[i].style.display="none",e++);var s=BX("adm-informer-footer"),n=BX.message("JSADM_AI_ALL_NOTIF")+" ("+(BX.adminInformer.itemsShow+parseInt(e))+")";return void 0!==s.textContent?s.textContent=n:s.innerText=n,BX.addClass(s,"adm-informer-footer-collapsed"),!1},Show:function(t){var e=BX("adm-header-notif-block");e&&BX.addClass(e,"adm-header-notif-block-active"),BX.onCustomEvent(t,"onBeforeAdminInformerShow"),setTimeout(BX.proxy((function(){BX.bind(document,"click",BX.proxy(BX.adminInformer.Close,BX.adminInformer))}),BX.adminInformer),0),BX.addClass(t,"adm-informer-active"),setTimeout((function(){BX.addClass(t,"adm-informer-animate")}),0)},Hide:function(t){var e=BX("adm-header-notif-block");e&&BX.removeClass(e,"adm-header-notif-block-active"),BX.unbind(document,"click",BX.proxy(BX.adminInformer.Close,BX.adminInformer)),BX.removeClass(t,"adm-informer-animate"),this.IsAnimationSupported()?setTimeout((function(){BX.removeClass(t,"adm-informer-active")}),300):BX.removeClass(t,"adm-informer-active"),BX.onCustomEvent(t,"onAdminInformerHide")},IsAnimationSupported:function(){var t=document.body||document.documentElement;return"string"==typeof t.style.transition||("string"==typeof t.style.MozTransition||("string"==typeof t.style.OTransition||("string"==typeof t.style.WebkitTransition||"string"==typeof t.style.msTransition)))},SetItemHtml:function(t,e){var i=BX("adm-informer-item-html-"+t);return!!i&&(i.innerHTML=e,!0)},SetItemFooter:function(t,e){var i=BX("adm-informer-item-footer-"+t);return!!i&&(i.innerHTML=e,i.style.display=e?"block":"none",!0)}})}(window),function(t){if(t.BX||(t.BX={}),t.BX.Main){if(t.BX.Main.Date)return}else t.BX.Main={};var e=t.BX;e.Main.Date={AM_PM_MODE:{UPPER:1,LOWER:2,NONE:!1},format:function(t,e,s,n){var o=this,a=i.isDate(e)?new Date(e.getTime()):i.isNumber(e)?new Date(1e3*e):new Date,r=i.isDate(s)?new Date(s.getTime()):i.isNumber(s)?new Date(1e3*s):new Date,h=!!n;if(i.isArray(t))return function(t,e,i,s){for(var n=b((i-e)/1e3),a=0;a<t.length;a++){var r=t[a][0],h=t[a][1],l=null;if("s"==r){if(n<60)return o.format(h,e,i,s)}else if(null!=(l=/^s(\d+)\>?(\d+)?/.exec(r))){if(l[1]&&l[2]){if(n<l[1]&&n>l[2])return o.format(h,e,i,s)}else if(n<l[1])return o.format(h,e,i,s)}else if("i"==r){if(n<3600)return o.format(h,e,i,s)}else if(null!=(l=/^i(\d+)\>?(\d+)?/.exec(r))){if(l[1]&&l[2]){if(n<60*l[1]&&n>60*l[2])return o.format(h,e,i,s)}else if(n<60*l[1])return o.format(h,e,i,s)}else if("H"==r){if(n<86400)return o.format(h,e,i,s)}else if(null!=(l=/^H(\d+)\>?(\d+)?/.exec(r))){if(l[1]&&l[2]){if(n<60*l[1]*60&&n>60*l[2]*60)return o.format(h,e,i,s)}else if(n<60*l[1]*60)return o.format(h,e,i,s)}else if("d"==r){if(n<2678400)return o.format(h,e,i,s)}else if(null!=(l=/^d(\d+)\>?(\d+)?/.exec(r))){if(l[1]&&l[2]){if(n<24*l[1]*60*60&&n>24*l[2]*60*60)return o.format(h,e,i,s)}else if(n<24*l[1]*60*60)return o.format(h,e,i,s)}else if("m"==r){if(n<31536e3)return o.format(h,e,i,s)}else if(null!=(l=/^m(\d+)\>?(\d+)?/.exec(r))){if(l[1]&&l[2]){if(n<31*l[1]*24*60*60&&n>31*l[2]*24*60*60)return o.format(h,e,i,s)}else if(n<31*l[1]*24*60*60)return o.format(h,e,i,s)}else if("now"==r){if(e.getTime()==i.getTime())return o.format(h,e,i,s)}else if("today"==r){var p=_(i),c=B(i),d=m(i),u=s?new Date(Date.UTC(p,c,d,0,0,0,0)):new Date(p,c,d,0,0,0,0),A=s?new Date(Date.UTC(p,c,d+1,0,0,0,0)):new Date(p,c,d+1,0,0,0,0);if(e>=u&&e<A)return o.format(h,e,i,s)}else if("todayFuture"==r){p=_(i),c=B(i),d=m(i),u=i.getTime(),A=s?new Date(Date.UTC(p,c,d+1,0,0,0,0)):new Date(p,c,d+1,0,0,0,0);if(e>=u&&e<A)return o.format(h,e,i,s)}else if("yesterday"==r){p=_(i),c=B(i),d=m(i);var f=s?new Date(Date.UTC(p,c,d-1,0,0,0,0)):new Date(p,c,d-1,0,0,0,0),X=s?new Date(Date.UTC(p,c,d,0,0,0,0)):new Date(p,c,d,0,0,0,0);if(e>=f&&e<X)return o.format(h,e,i,s)}else if("tommorow"==r||"tomorrow"==r){p=_(i),c=B(i),d=m(i);var C=s?new Date(Date.UTC(p,c,d+1,0,0,0,0)):new Date(p,c,d+1,0,0,0,0),T=s?new Date(Date.UTC(p,c,d+2,0,0,0,0)):new Date(p,c,d+2,0,0,0,0);if(e>=C&&e<T)return o.format(h,e,i,s)}else if("-"==r&&n<0)return o.format(h,e,i,s)}return t.length>0?o.format(t[t.length-1][1],e,i,s):""}(t,a,r,h);if(!i.isNotEmptyString(t))return"";var l=(t.match(/{{([^{}]*)}}/g)||[]).map((function(t){return(t.match(/[^{}]+/)||[""])[0]}));l.length>0&&l.forEach((function(e,i){t=t.replace("{{"+e+"}}","{{"+i+"}}")}));var p=/\\?(sago|iago|isago|Hago|dago|mago|Yago|sdiff|idiff|Hdiff|ddiff|mdiff|Ydiff|sshort|ishort|Hshort|dshort|mhort|Yshort|yesterday|today|tommorow|tomorrow|[a-z])/gi,c={d:function(){return i.strPadLeft(m(a).toString(),2,"0")},D:function(){return o._getMessage("DOW_"+f(a))},j:function(){return m(a)},l:function(){return o._getMessage("DAY_OF_WEEK_"+f(a))},N:function(){return f(a)||7},S:function(){return m(a)%10==1&&11!=m(a)?"st":m(a)%10==2&&12!=m(a)?"nd":m(a)%10==3&&13!=m(a)?"rd":"th"},w:function(){return f(a)},z:function(){var t=new Date(_(a),0,1),e=new Date(_(a),B(a),m(a));return Math.ceil((e-t)/864e5)},W:function(){var t=new Date(a.getTime()),e=(f(a)+6)%7;X(t,m(t)-e+3);var s=t.getTime();C(t,0,1),4!=f(t)&&C(t,0,1+(4-f(t)+7)%7);var n=1+Math.ceil((s-t)/6048e5);return i.strPadLeft(n.toString(),2,"0")},F:function(){return o._getMessage("MONTH_"+(B(a)+1)+"_S")},f:function(){return o._getMessage("MONTH_"+(B(a)+1))},m:function(){return i.strPadLeft((B(a)+1).toString(),2,"0")},M:function(){return o._getMessage("MON_"+(B(a)+1))},n:function(){return B(a)+1},t:function(){return m(h?new Date(Date.UTC(_(a),B(a)+1,0)):new Date(_(a),B(a)+1,0))},L:function(){var t=_(a);return t%4==0&&t%100!=0||t%400==0?1:0},o:function(){var t=new Date(a.getTime());return X(t,m(t)-(f(a)+6)%7+3),_(t)},Y:function(){return _(a)},y:function(){return _(a).toString().slice(2)},a:function(){return A(a)>11?"pm":"am"},A:function(){return A(a)>11?"PM":"AM"},B:function(){var t=(a.getUTCHours()+1)%24+a.getUTCMinutes()/60+a.getUTCSeconds()/3600;return i.strPadLeft(Math.floor(1e3*t/24).toString(),3,"0")},g:function(){return A(a)%12||12},G:function(){return A(a)},h:function(){return i.strPadLeft((A(a)%12||12).toString(),2,"0")},H:function(){return i.strPadLeft(A(a).toString(),2,"0")},i:function(){return i.strPadLeft(function(t){return h?t.getUTCMinutes():t.getMinutes()}(a).toString(),2,"0")},s:function(){return i.strPadLeft(function(t){return h?t.getUTCSeconds():t.getSeconds()}(a).toString(),2,"0")},u:function(){return i.strPadLeft((1e3*function(t){return h?t.getUTCMilliseconds():t.getMilliseconds()}(a)).toString(),6,"0")},e:function(){return h?"UTC":""},I:function(){return h?0:0+(new Date(_(a),0,1)-Date.UTC(_(a),0,1)!=new Date(_(a),6,0)-Date.UTC(_(a),6,0))},O:function(){if(h)return"+0000";var t=a.getTimezoneOffset(),e=Math.abs(t);return(t>0?"-":"+")+i.strPadLeft((100*Math.floor(e/60)+e%60).toString(),4,"0")},P:function(){if(h)return"+00:00";var t=this.O();return t.substr(0,3)+":"+t.substr(3)},Z:function(){return h?0:60*-a.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(p,S)},r:function(){return"D, d M Y H:i:s O".replace(p,S)},U:function(){return Math.floor(a.getTime()/1e3)},sago:function(){return T(b((r-a)/1e3),{0:"FD_SECOND_AGO_0",1:"FD_SECOND_AGO_1","10_20":"FD_SECOND_AGO_10_20",MOD_1:"FD_SECOND_AGO_MOD_1",MOD_2_4:"FD_SECOND_AGO_MOD_2_4",MOD_OTHER:"FD_SECOND_AGO_MOD_OTHER"})},sdiff:function(){return T(b((r-a)/1e3),{0:"FD_SECOND_DIFF_0",1:"FD_SECOND_DIFF_1","10_20":"FD_SECOND_DIFF_10_20",MOD_1:"FD_SECOND_DIFF_MOD_1",MOD_2_4:"FD_SECOND_DIFF_MOD_2_4",MOD_OTHER:"FD_SECOND_DIFF_MOD_OTHER"})},sshort:function(){return o._getMessage("FD_SECOND_SHORT").replace(/#VALUE#/g,b((r-a)/1e3))},iago:function(){return T(b((r-a)/60/1e3),{0:"FD_MINUTE_AGO_0",1:"FD_MINUTE_AGO_1","10_20":"FD_MINUTE_AGO_10_20",MOD_1:"FD_MINUTE_AGO_MOD_1",MOD_2_4:"FD_MINUTE_AGO_MOD_2_4",MOD_OTHER:"FD_MINUTE_AGO_MOD_OTHER"})},idiff:function(){return T(b((r-a)/60/1e3),{0:"FD_MINUTE_DIFF_0",1:"FD_MINUTE_DIFF_1","10_20":"FD_MINUTE_DIFF_10_20",MOD_1:"FD_MINUTE_DIFF_MOD_1",MOD_2_4:"FD_MINUTE_DIFF_MOD_2_4",MOD_OTHER:"FD_MINUTE_DIFF_MOD_OTHER"})},isago:function(){var t=b((r-a)/60/1e3),e=T(t,{0:"FD_MINUTE_0",1:"FD_MINUTE_1","10_20":"FD_MINUTE_10_20",MOD_1:"FD_MINUTE_MOD_1",MOD_2_4:"FD_MINUTE_MOD_2_4",MOD_OTHER:"FD_MINUTE_MOD_OTHER"});return e+=" ",e+=T(b((r-a)/1e3)-60*t,{0:"FD_SECOND_AGO_0",1:"FD_SECOND_AGO_1","10_20":"FD_SECOND_AGO_10_20",MOD_1:"FD_SECOND_AGO_MOD_1",MOD_2_4:"FD_SECOND_AGO_MOD_2_4",MOD_OTHER:"FD_SECOND_AGO_MOD_OTHER"})},ishort:function(){return o._getMessage("FD_MINUTE_SHORT").replace(/#VALUE#/g,b((r-a)/60/1e3))},Hago:function(){return T(b((r-a)/60/60/1e3),{0:"FD_HOUR_AGO_0",1:"FD_HOUR_AGO_1","10_20":"FD_HOUR_AGO_10_20",MOD_1:"FD_HOUR_AGO_MOD_1",MOD_2_4:"FD_HOUR_AGO_MOD_2_4",MOD_OTHER:"FD_HOUR_AGO_MOD_OTHER"})},Hdiff:function(){return T(b((r-a)/60/60/1e3),{0:"FD_HOUR_DIFF_0",1:"FD_HOUR_DIFF_1","10_20":"FD_HOUR_DIFF_10_20",MOD_1:"FD_HOUR_DIFF_MOD_1",MOD_2_4:"FD_HOUR_DIFF_MOD_2_4",MOD_OTHER:"FD_HOUR_DIFF_MOD_OTHER"})},Hshort:function(){return o._getMessage("FD_HOUR_SHORT").replace(/#VALUE#/g,b((r-a)/60/60/1e3))},yesterday:function(){return o._getMessage("FD_YESTERDAY")},today:function(){return o._getMessage("FD_TODAY")},tommorow:function(){return o._getMessage("FD_TOMORROW")},tomorrow:function(){return o._getMessage("FD_TOMORROW")},dago:function(){return T(b((r-a)/60/60/24/1e3),{0:"FD_DAY_AGO_0",1:"FD_DAY_AGO_1","10_20":"FD_DAY_AGO_10_20",MOD_1:"FD_DAY_AGO_MOD_1",MOD_2_4:"FD_DAY_AGO_MOD_2_4",MOD_OTHER:"FD_DAY_AGO_MOD_OTHER"})},ddiff:function(){return T(b((r-a)/60/60/24/1e3),{0:"FD_DAY_DIFF_0",1:"FD_DAY_DIFF_1","10_20":"FD_DAY_DIFF_10_20",MOD_1:"FD_DAY_DIFF_MOD_1",MOD_2_4:"FD_DAY_DIFF_MOD_2_4",MOD_OTHER:"FD_DAY_DIFF_MOD_OTHER"})},dshort:function(){return o._getMessage("FD_DAY_SHORT").replace(/#VALUE#/g,b((r-a)/60/60/24/1e3))},mago:function(){return T(b((r-a)/60/60/24/31/1e3),{0:"FD_MONTH_AGO_0",1:"FD_MONTH_AGO_1","10_20":"FD_MONTH_AGO_10_20",MOD_1:"FD_MONTH_AGO_MOD_1",MOD_2_4:"FD_MONTH_AGO_MOD_2_4",MOD_OTHER:"FD_MONTH_AGO_MOD_OTHER"})},mdiff:function(){return T(b((r-a)/60/60/24/31/1e3),{0:"FD_MONTH_DIFF_0",1:"FD_MONTH_DIFF_1","10_20":"FD_MONTH_DIFF_10_20",MOD_1:"FD_MONTH_DIFF_MOD_1",MOD_2_4:"FD_MONTH_DIFF_MOD_2_4",MOD_OTHER:"FD_MONTH_DIFF_MOD_OTHER"})},mshort:function(){return o._getMessage("FD_MONTH_SHORT").replace(/#VALUE#/g,b((r-a)/60/60/24/31/1e3))},Yago:function(){return T(b((r-a)/60/60/24/365/1e3),{0:"FD_YEARS_AGO_0",1:"FD_YEARS_AGO_1","10_20":"FD_YEARS_AGO_10_20",MOD_1:"FD_YEARS_AGO_MOD_1",MOD_2_4:"FD_YEARS_AGO_MOD_2_4",MOD_OTHER:"FD_YEARS_AGO_MOD_OTHER"})},Ydiff:function(){return T(b((r-a)/60/60/24/365/1e3),{0:"FD_YEARS_DIFF_0",1:"FD_YEARS_DIFF_1","10_20":"FD_YEARS_DIFF_10_20",MOD_1:"FD_YEARS_DIFF_MOD_1",MOD_2_4:"FD_YEARS_DIFF_MOD_2_4",MOD_OTHER:"FD_YEARS_DIFF_MOD_OTHER"})},Yshort:function(){return T(b((r-a)/60/60/24/365/1e3),{0:"FD_YEARS_SHORT_0",1:"FD_YEARS_SHORT_1","10_20":"FD_YEARS_SHORT_10_20",MOD_1:"FD_YEARS_SHORT_MOD_1",MOD_2_4:"FD_YEARS_SHORT_MOD_2_4",MOD_OTHER:"FD_YEARS_SHORT_MOD_OTHER"})},x:function(){var t=o.isAmPmMode(!0),e=t===o.AM_PM_MODE.LOWER?"g:i a":t===o.AM_PM_MODE.UPPER?"g:i A":"H:i";return o.format([["tomorrow","tomorrow, "+e],["-",o.convertBitrixFormat(o._getMessage("FORMAT_DATETIME")).replace(/:s/g,"")],["s","sago"],["i","iago"],["today","today, "+e],["yesterday","yesterday, "+e],["",o.convertBitrixFormat(o._getMessage("FORMAT_DATETIME")).replace(/:s/g,"")]],a,r,h)},X:function(){var t=o.isAmPmMode(!0),e=t===o.AM_PM_MODE.LOWER?"g:i a":t===o.AM_PM_MODE.UPPER?"g:i A":"H:i",i=o.format([["tomorrow","tomorrow"],["-",o.convertBitrixFormat(o._getMessage("FORMAT_DATE"))],["today","today"],["yesterday","yesterday"],["",o.convertBitrixFormat(o._getMessage("FORMAT_DATE"))]],a,r,h),s=o.format([["tomorrow",e],["today",e],["yesterday",e],["",""]],a,r,h);return s.length>0?o._getMessage("FD_DAY_AT_TIME").replace(/#DAY#/g,i).replace(/#TIME#/g,s):i},Q:function(){return 0==b((r-a)/60/60/24/1e3)?o._getMessage("FD_DAY_DIFF_1").replace(/#VALUE#/g,1):o.format([["d","ddiff"],["m","mdiff"],["","Ydiff"]],a,r)}},d=!1;t[0]&&"^"==t[0]&&(d=!0,t=t.substr(1));var u=t.replace(p,S);return d&&(u=u.replace(/\s*00:00:00\s*/g,"").replace(/(\d\d:\d\d)(:00)/g,"$1").replace(/(\s*00:00\s*)(?!:)/g,"")),l.length>0&&l.forEach((function(t,e){u=u.replace("{{"+e+"}}",t)})),u;function _(t){return h?t.getUTCFullYear():t.getFullYear()}function m(t){return h?t.getUTCDate():t.getDate()}function B(t){return h?t.getUTCMonth():t.getMonth()}function A(t){return h?t.getUTCHours():t.getHours()}function f(t){return h?t.getUTCDay():t.getDay()}function X(t,e){return h?t.setUTCDate(e):t.setDate(e)}function C(t,e,i){return h?t.setUTCMonth(e,i):t.setMonth(e,i)}function T(t,e){var i=t<100?Math.abs(t):Math.abs(t%100),s=i%10;return(0==i?o._getMessage(e[0]):1==i?o._getMessage(e[1]):i>=10&&i<=20?o._getMessage(e["10_20"]):1==s?o._getMessage(e.MOD_1):2<=s&&s<=4?o._getMessage(e.MOD_2_4):o._getMessage(e.MOD_OTHER)).replace(/#VALUE#/g,t)}function S(t,e){return c[t]?c[t]():e}function b(t){return t>=0?Math.floor(t):Math.ceil(t)}},convertBitrixFormat:function(t){return i.isNotEmptyString(t)?t.replace("YYYY","Y").replace("MMMM","F").replace("MM","m").replace("M","M").replace("DD","d").replace("G","g").replace(/GG/i,"G").replace("H","h").replace(/HH/i,"H").replace("MI","i").replace("SS","s").replace("TT","A").replace("T","a"):""},convertToUTC:function(t){return i.isDate(t)?new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())):null},getNewDate:function(t){return new Date(this.getBrowserTimestamp(t))},getBrowserTimestamp:function(t){t=parseInt(t,10);var e=60*new Date(1e3*t).getTimezoneOffset();return 1e3*(parseInt(t,10)+parseInt(this._getMessage("SERVER_TZ_OFFSET"))+e)},getServerTimestamp:function(t){t=parseInt(t,10);var e=60*new Date(t).getTimezoneOffset();return Math.round(t/1e3-(parseInt(this._getMessage("SERVER_TZ_OFFSET"),10)+parseInt(e,10)))},formatLastActivityDate:function(t,e,i){var s,n=this.isAmPmMode(!0),o=n===this.AM_PM_MODE.LOWER?"g:i a":n===this.AM_PM_MODE.UPPER?"g:i A":"H:i",a=[["tomorrow","#01#"+o],["now","#02#"],["todayFuture","#03#"+o],["yesterday","#04#"+o],["-",this.convertBitrixFormat(this._getMessage("FORMAT_DATETIME")).replace(/:s/g,"")],["s60","sago"],["i60","iago"],["H5","Hago"],["H24","#03#"+o],["d31","dago"],["m12>1","mago"],["m12>0","dago"],["","#05#"]],r=this.format(a,t,e,i);if(null!=(s=/^#(\d+)#(.*)/.exec(r)))switch(s[1]){case"01":r=this._getMessage("FD_LAST_SEEN_TOMORROW").replace("#TIME#",s[2]);break;case"02":r=this._getMessage("FD_LAST_SEEN_NOW");break;case"03":r=this._getMessage("FD_LAST_SEEN_TODAY").replace("#TIME#",s[2]);break;case"04":r=this._getMessage("FD_LAST_SEEN_YESTERDAY").replace("#TIME#",s[2]);break;case"05":r=this._getMessage("FD_LAST_SEEN_MORE_YEAR");break;default:r=s[2]}return r},isAmPmMode:function(t){return!0===t?this._getMessage("AMPM_MODE"):!1!==this._getMessage("AMPM_MODE")},_getMessage:function(t){return e.message(t)},parse:function(t,e,s,n){if(i.isNotEmptyString(t)){s||(s=this._getMessage("FORMAT_DATE")),n||(n=this._getMessage("FORMAT_DATETIME"));var o="";for(a=1;a<=12;a++)o=o+"|"+this._getMessage("MON_"+a);var a,r,h=new RegExp("([0-9]+|[a-z]+"+o+")","ig"),l=t.match(h),p=s.match(/(DD|MI|MMMM|MM|M|YYYY)/gi),c=[],d=[],u={};if(!l)return null;for(l.length>p.length&&(p=n.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)),a=0,r=l.length;a<r;a++)""!==l[a].trim()&&(c[c.length]=l[a]);for(a=0,r=p.length;a<r;a++)""!==p[a].trim()&&(d[d.length]=p[a]);var _=i.array_search("MMMM",d);for((_>0||(_=i.array_search("M",d))>0)&&(c[_]=this.getMonthIndex(c[_]),d[_]="MM"),a=0,r=d.length;a<r;a++){var m=d[a].toUpperCase();u[m]="T"===m||"TT"===m?c[a]:parseInt(c[a],10)}if(u.DD>0&&u.MM>0&&u.YYYY>0){var B=new Date;if(e?(B.setUTCDate(1),B.setUTCFullYear(u.YYYY),B.setUTCMonth(u.MM-1),B.setUTCDate(u.DD),B.setUTCHours(0,0,0,0)):(B.setDate(1),B.setFullYear(u.YYYY),B.setMonth(u.MM-1),B.setDate(u.DD),B.setHours(0,0,0,0)),!(isNaN(u.HH)&&isNaN(u.GG)&&isNaN(u.H)&&isNaN(u.G)||isNaN(u.MI))){if(isNaN(u.H)&&isNaN(u.G))u.HH=parseInt(u.HH||u.GG||0,10);else{var A="PM"===(u.T||u.TT||"am").toUpperCase(),f=parseInt(u.H||u.G||0,10);u.HH=A?f+(12===f?0:12):f<12?f:0}isNaN(u.SS)&&(u.SS=0),e?B.setUTCHours(u.HH,u.MI,u.SS):B.setHours(u.HH,u.MI,u.SS)}return B}}return null},getMonthIndex:function(t){var e,i=t.toUpperCase(),s=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],n=["january","february","march","april","may","june","july","august","september","october","november","december"];for(e=1;e<=12;e++)if(i===this._getMessage("MON_"+e).toUpperCase()||i===this._getMessage("MONTH_"+e).toUpperCase()||i===s[e-1].toUpperCase()||i===n[e-1].toUpperCase())return e;return t}};var i={isDate:function(t){return t&&"[object Date]"==Object.prototype.toString.call(t)},isNumber:function(t){return 0===t||!!t&&("number"==typeof t||t instanceof Number)},isArray:function(t){return t&&"[object Array]"==Object.prototype.toString.call(t)},isString:function(t){return""===t||!!t&&("string"==typeof t||t instanceof String)},isNotEmptyString:function(t){return!!this.isString(t)&&t.length>0},strPadLeft:function(t,e,i){var s=t.length,n=i.length;if(s>=e)return t;for(;s<e;s+=n)t=i+t;return t},array_search:function(t,e){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}}}(window),function(){if(!BX.date){BX.date=BX.Main.Date;var t=null;BX.calendar=function(t){return BX.calendar.get().Show(t)},BX.calendar.get=function(){return t||(t=new BX.JCCalendar),t},BX.calendar.InsertDaysBack=function(t,e){if(""!=e){var i=new Date;e>0&&i.setTime(i.valueOf()-864e5*e),t.value=BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),i,null)}else t.value=""},BX.calendar.ValueToString=function(t,e,i){return BX.date.format(BX.date.convertBitrixFormat(BX.message(e?"FORMAT_DATETIME":"FORMAT_DATE")),t,null,!!i)},BX.calendar.ValueToStringFormat=function(t,e,i){return BX.date.format(BX.date.convertBitrixFormat(e),t,null,!!i)},BX.CalendarPeriod={Init:function(t,e,i){""==t.value&&""==e.value||""!=i.value||(i.value="interval"),i.onchange()},ChangeDirectOpts:function(t,e){var i=BX.findChild(e,{className:"adm-select adm-calendar-direction"},!0);"week"==t?(i.options[0].text=BX.message("JSADM_CALEND_PREV_WEEK"),i.options[1].text=BX.message("JSADM_CALEND_CURR_WEEK"),i.options[2].text=BX.message("JSADM_CALEND_NEXT_WEEK")):(i.options[0].text=BX.message("JSADM_CALEND_PREV"),i.options[1].text=BX.message("JSADM_CALEND_CURR"),i.options[2].text=BX.message("JSADM_CALEND_NEXT"))},SaveAndClearInput:function(t){window.SavedPeriodValues||(window.SavedPeriodValues={}),window.SavedPeriodValues[t.id]=t.value,t.value=""},RestoreInput:function(t){window.SavedPeriodValues&&window.SavedPeriodValues[t.id]&&(t.value=window.SavedPeriodValues[t.id],delete window.SavedPeriodValues[t.id])},OnChangeP:function(t){var e,i,s,n,o=t.parentNode.parentNode;e=i=s=n=!1;var a=BX.findChild(o,{className:"adm-input-wrap adm-calendar-inp adm-calendar-first"}),r=BX.findChild(o,{className:"adm-input-wrap adm-calendar-second"}),h=BX.findChild(o,{className:"adm-select-wrap adm-calendar-direction"}),l=BX.findChild(o,{className:"adm-calendar-separate"}),p=BX.findChild(o,{className:"adm-input adm-calendar-from"},!0),c=BX.findChild(o,{className:"adm-input adm-calendar-to"},!0);switch(t.value){case"day":case"week":case"month":case"quarter":case"year":s=!0,BX.CalendarPeriod.OnChangeD(h.children[0]);break;case"before":i=!0;break;case"after":case"exact":e=!0;break;case"interval":e=i=n=!0,BX.CalendarPeriod.RestoreInput(p),BX.CalendarPeriod.RestoreInput(c);break;case"":BX.CalendarPeriod.SaveAndClearInput(p),BX.CalendarPeriod.SaveAndClearInput(c)}BX.CalendarPeriod.ChangeDirectOpts(t.value,o),a.style.display=e?"inline-block":"none",r.style.display=i?"inline-block":"none",h.style.display=s?"inline-block":"none",l.style.display=n?"inline-block":"none"},OnChangeD:function(t){var e=t.parentNode.parentNode,i=BX.findChild(e,{className:"adm-input adm-calendar-from"},!0),s=BX.findChild(e,{className:"adm-input adm-calendar-to"},!0),n=BX.findChild(e,{className:"adm-select adm-calendar-period"},!0),o=0;switch(t.value){case"previous":o=-1;break;case"next":o=1}var a=!1,r=!1,h=new Date,l=h.getFullYear(),p=h.getMonth(),c=h.getDate(),d=h.getDay();switch(0==d&&(d=7),n.value){case"day":a=new Date(l,p,c+o,0,0,0),r=new Date(l,p,c+o,23,59,59);break;case"week":a=new Date(l,p,c-d+1+7*o,0,0,0),r=new Date(l,p,c+(7-d)+7*o,23,59,59);break;case"month":a=new Date(l,p+o,1,0,0,0),r=new Date(l,p+1+o,0,23,59,59);break;case"quarter":var u=Math.floor(p/3)+o;a=new Date(l,3*u,1,0,0,0),r=new Date(l,3*(u+1),0,23,59,59);break;case"year":a=new Date(l+o,0,1,0,0,0),r=new Date(l+1+o,0,0,23,59,59)}var _=window[i.name+"_bTime"]?BX.message("FORMAT_DATETIME"):BX.message("FORMAT_DATE");a&&(i.value=BX.formatDate(a,_),BX.addClass(i,"adm-calendar-inp-setted")),r&&(s.value=BX.formatDate(r,_),BX.addClass(s,"adm-calendar-inp-setted"))}},BX.JCCalendar=function(){this.params={},this.bAmPm=BX.isAmPmMode(),this.popup=null,this.popup_month=null,this.popup_year=null,this.month_popup_classname="",this.year_popup_classname="",this.value=null,this.control_id=Math.random(),this._layers={},this._current_layer=null,this.DIV=null,this.PARTS={},this.weekStart=0,this.numRows=6,this._create=function(t){this.popup=new BX.PopupWindow("calendar_popup_"+this.control_id,t.node,{closeByEsc:!0,autoHide:!1,content:this._get_content(),zIndex:3e3,bindOptions:{forceBindPosition:!0}}),BX.bind(this.popup.popupContainer,"click",(function(t){t.stopPropagation()}))},this._auto_hide_disable=function(){BX.unbind(document,"click",BX.proxy(this._auto_hide,this))},this._auto_hide_enable=function(){BX.bind(document,"click",BX.proxy(this._auto_hide,this))},this._auto_hide=function(t){this._auto_hide_disable(),this.popup.close()},this._get_content=function(){var t=BX.delegate((function(t){t=t||window.event,this.SetDate(new Date(parseInt(BX.proxy_context.getAttribute("data-date"))),"dblclick"===t.type||this.params.bCompatibility)}),this);this.DIV=BX.create("DIV",{props:{className:"bx-calendar"},children:[BX.create("DIV",{props:{className:"bx-calendar-header"},children:[BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-left-arrow"},events:{click:BX.proxy(this._prev,this)}}),BX.create("SPAN",{props:{className:"bx-calendar-header-content"},children:[this.PARTS.MONTH=BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-top-month"},events:{click:BX.proxy(this._menu_month,this)}}),this.PARTS.YEAR=BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-top-year"},events:{click:BX.proxy(this._menu_year,this)}})]}),BX.create("A",{attrs:{href:"javascript:void(0)"},props:{className:"bx-calendar-right-arrow"},events:{click:BX.proxy(this._next,this)}})]}),this.PARTS.WEEK=BX.create("DIV",{props:{className:"bx-calendar-name-day-wrap"}}),this.PARTS.LAYERS=BX.create("DIV",{props:{className:"bx-calendar-cell-block"},events:{click:BX.delegateEvent({className:"bx-calendar-cell"},t),dblclick:BX.delegateEvent({className:"bx-calendar-cell"},t)}}),this.PARTS.TIME=BX.create("DIV",{props:{className:"bx-calendar-set-time-wrap"},events:{click:BX.delegateEvent({attr:"data-action"},BX.delegate(this._time_actions,this))},html:'<a href="javascript:void(0)" data-action="time_show" class="bx-calendar-set-time"><i></i>'+BX.message("CAL_TIME_SET")+'</a><div class="bx-calendar-form-block"><span class="bx-calendar-form-text">'+BX.message("CAL_TIME")+'</span><span class="bx-calendar-form"><input type="text" class="bx-calendar-form-input" maxwidth="2" onkeyup="BX.calendar.get()._check_time()" /><span class="bx-calendar-form-separator"></span><input type="text" class="bx-calendar-form-input" maxwidth="2" onkeyup="BX.calendar.get()._check_time()" />'+(this.bAmPm?'<span class="bx-calendar-AM-PM-block"><span class="bx-calendar-AM-PM-text" data-action="time_ampm"></span><span class="bx-calendar-form-arrow-r"><a href="javascript:void(0)" class="bx-calendar-form-arrow-top" data-action="time_ampm_up"><i></i></a><a href="javascript:void(0)" class="bx-calendar-form-arrow-bottom" data-action="time_ampm_down"><i></i></a></span></span>':"")+'</span><a href="javascript:void(0)" data-action="time_hide" class="bx-calendar-form-close"><i></i></a></div>'}),this.PARTS.BUTTONS=BX.create("DIV",{props:{className:"bx-calendar-button-block"},events:{click:BX.delegateEvent({attr:"data-action"},BX.delegate(this._button_actions,this))},html:'<a href="javascript:void(0)" class="bx-calendar-button bx-calendar-button-select" data-action="submit"><span class="bx-calendar-button-left"></span><span class="bx-calendar-button-text">'+BX.message("CAL_BUTTON")+'</span><span class="bx-calendar-button-right"></span></a><a href="javascript:void(0)" class="bx-calendar-button bx-calendar-button-cancel" data-action="cancel"><span class="bx-calendar-button-left"></span><span class="bx-calendar-button-text">'+BX.message("JS_CORE_WINDOW_CLOSE")+'</span><span class="bx-calendar-button-right"></span></a>'})]}),this.PARTS.TIME_INPUT_H=BX.findChild(this.PARTS.TIME,{tag:"INPUT"},!0),this.PARTS.TIME_INPUT_M=this.PARTS.TIME_INPUT_H.nextSibling.nextSibling,this.bAmPm&&(this.PARTS.TIME_AMPM=this.PARTS.TIME_INPUT_M.nextSibling.firstChild);var e=new BX.JCSpinner({input:this.PARTS.TIME_INPUT_H,callback_change:BX.proxy(this._check_time,this),bSaveValue:!1}).Show();e.className="bx-calendar-form-arrow-l",this.PARTS.TIME_INPUT_H.parentNode.insertBefore(e,this.PARTS.TIME_INPUT_H),(e=new BX.JCSpinner({input:this.PARTS.TIME_INPUT_M,callback_change:BX.proxy(this._check_time,this),bSaveValue:!0}).Show()).className="bx-calendar-form-arrow-r",this.PARTS.TIME_INPUT_M.nextSibling?this.PARTS.TIME_INPUT_M.parentNode.insertBefore(e,this.PARTS.TIME_INPUT_M.nextSibling):this.PARTS.TIME_INPUT_M.parentNode.appendChild(e);for(var i=0;i<7;i++)this.PARTS.WEEK.appendChild(BX.create("SPAN",{props:{className:"bx-calendar-name-day"},text:BX.message("DOW_"+(i+this.weekStart)%7)}));return this.DIV},this._time_actions=function(){switch(BX.proxy_context.getAttribute("data-action")){case"time_show":BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened"),this.params.bCompatibility&&BX.removeClass(this.PARTS.BUTTONS,"bx-calendar-buttons-disabled"),this.popup.adjustPosition();break;case"time_hide":BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened"),this.params.bCompatibility&&BX.addClass(this.PARTS.BUTTONS,"bx-calendar-buttons-disabled"),this.popup.adjustPosition();break;case"time_ampm":this.PARTS.TIME_AMPM.innerHTML="AM"==this.PARTS.TIME_AMPM.innerHTML?"PM":"AM";break;case"time_ampm_up":return void this._check_time({bSaveValue:!1},null,12);case"time_ampm_down":return void this._check_time({bSaveValue:!1},null,-12)}this._check_time()},this._button_actions=function(){switch(BX.proxy_context.getAttribute("data-action")){case"submit":this.SaveValue();break;case"cancel":this.Close()}},this._check_time=function(t,e,i){var s=parseInt(this.PARTS.TIME_INPUT_H.value.substring(0,5),10)||0,n=parseInt(this.PARTS.TIME_INPUT_M.value.substring(0,5),10)||0,o=!1;t&&!t.bSaveValue?this.value.setUTCHours(this.value.getUTCHours()+i):isNaN(s)||(this.bAmPm&&12!=s&&"PM"==this.PARTS.TIME_AMPM.innerHTML&&(s+=12),o=!0,this.value.setUTCHours(s%24)),isNaN(n)||(o=!0,this.value.setUTCMinutes(n%60)),o&&this.SetValue(this.value)},this._set_layer=function(){var t=parseInt(this.value.getUTCFullYear()+""+BX.util.str_pad_left(this.value.getUTCMonth()+"",2,"0"));if(this._layers[t]||(this._layers[t]=this._create_layer(),this._layers[t].BXLAYERID=t),this._current_layer){var e=new Date(this.value.valueOf());e.setUTCHours(0),e.setUTCMinutes(0);var i=BX.findChild(this._layers[t],{tag:"A",className:"bx-calendar-active"},!0),s=BX.findChild(this._layers[t],{tag:"A",attr:{"data-date":e.valueOf()+""}},!0);i&&BX.removeClass(i,"bx-calendar-active"),s&&BX.addClass(s,"bx-calendar-active"),this._replace_layer(this._current_layer,this._layers[t])}else this.PARTS.LAYERS.appendChild(this._layers[t]);this._current_layer=this._layers[t]},this._replace_layer=function(t,e){if(t!=e)if(!BX.browser.IsIE()||BX.browser.IsDoctype()){var i=t.BXLAYERID>e.BXLAYERID?1:-1,s=0,n=-i*t.offsetHeight;t.style.position="relative",t.style.top="0px",t.style.zIndex=5,e.style.position="absolute",e.style.top=n+"px",e.style.zIndex=6,this.PARTS.LAYERS.appendChild(e);var o;(o=function(){s+=15*i,i*(n+=15*i)<0?(t.style.top=s+"px",e.style.top=n+"px",setTimeout(o,10)):(t.parentNode.removeChild(t),e.style.top="0px",e.style.position="static",e.style.zIndex=0)})()}else this.PARTS.LAYERS.replaceChild(e,t)},this._create_layer=function(){var t=BX.create("DIV",{props:{className:"bx-calendar-layer"}}),e=new Date(this.value);if(e.setUTCHours(0),e.setUTCMinutes(0),e.setUTCDate(1),e.getUTCDay()!=this.weekStart){var i=e.getUTCDay()-this.weekStart;i+=i<0?7:0,e.setUTCDate(e.getUTCDate()-i)}for(var s=this.value.getUTCMonth(),n=this.value.getUTCDate(),o="",a=0;a<this.numRows;a++){o+='<div class="bx-calendar-range'+(a==this.numRows-1?" bx-calendar-range-noline":"")+'">';for(var r=0;r<7;r++){i=e.getUTCDate();var h=e.getUTCDay(),l="bx-calendar-cell";s!=e.getUTCMonth()?l+=" bx-calendar-date-hidden":n==i&&(l+=" bx-calendar-active"),0!=h&&6!=h||(l+=" bx-calendar-weekend"),o+='<a href="javascript:void(0)" class="'+l+'" data-date="'+e.valueOf()+'">'+i+"</a>",e.setUTCDate(e.getUTCDate()+1)}o+="</div>"}return t.innerHTML=o,t},this._prev=function(){this.SetMonth(this.value.getUTCMonth()-1)},this._next=function(){this.SetMonth(this.value.getUTCMonth()+1)},this._menu_month_content=function(){var t,e="",i=this.value.getMonth();for(t=0;t<12;t++)e+='<span class="bx-calendar-month'+(t==i?" bx-calendar-month-active":"")+'" data-bx-month="'+t+'">'+BX.message("MONTH_"+(t+1))+"</span>";return'<div class="bx-calendar-month-popup"><div class="bx-calendar-month-title" data-bx-month="'+this.value.getUTCMonth()+'">'+BX.message("MONTH_"+(this.value.getUTCMonth()+1))+'</div><div class="bx-calendar-month-content">'+e+"</div></div>"},this._menu_month=function(){this.popup_month?this.popup_month.BXMONTH!=this.value.getUTCMonth()&&(this.popup_month.setContent(this._menu_month_content()),this.popup_month.BXMONTH=this.value.getUTCMonth()):(this.popup_month=new BX.PopupWindow("calendar_popup_month_"+this.control_id,this.PARTS.MONTH,{content:this._menu_month_content(),zIndex:3001,closeByEsc:!0,autoHide:!0,offsetTop:-29,offsetLeft:-1,className:this.month_popup_classname,events:{onPopupShow:BX.delegate((function(){this.popup_year&&this.popup_year.close()}),this)}}),BX.bind(this.popup_month.popupContainer,"click",BX.proxy(this.month_popup_click,this)),this.popup_month.BXMONTH=this.value.getUTCMonth()),this.popup_month.show()},this.month_popup_click=function(t){var e=t.target||t.srcElement;e&&e.getAttribute&&e.getAttribute("data-bx-month")&&(this.SetMonth(parseInt(e.getAttribute("data-bx-month"))),this.popup_month.close())},this._menu_year_content=function(){for(var t='<div class="bx-calendar-year-popup"><div class="bx-calendar-year-title" data-bx-year="'+this.value.getUTCFullYear()+'">'+this.value.getUTCFullYear()+'</div><div class="bx-calendar-year-content" id="bx-calendar-year-content">',e=-3;e<=3;e++)t+='<span class="bx-calendar-year-number'+(0==e?" bx-calendar-year-active":"")+'" data-bx-year="'+(this.value.getUTCFullYear()-e)+'">'+(this.value.getUTCFullYear()-e)+"</span>";return t+='</div><input data-bx-year-input="Y" type="text" class="bx-calendar-year-input" maxlength="4" /></div>'},this._menu_year=function(){this.popup_year?this.popup_year.BXYEAR!=this.value.getUTCFullYear()&&(this.popup_year.setContent(this._menu_year_content()),this.popup_year.BXYEAR=this.value.getUTCFullYear()):(this.popup_year=new BX.PopupWindow("calendar_popup_year_"+this.control_id,this.PARTS.YEAR,{content:this._menu_year_content(),zIndex:3001,closeByEsc:!0,autoHide:!0,offsetTop:-29,offsetLeft:-1,className:this.year_popup_classname,events:{onPopupShow:BX.delegate((function(){this.popup_month&&this.popup_month.close()}),this)}}),BX.bind(this.popup_year.popupContainer,"click",BX.proxy(this.year_popup_click,this)),BX.bind(this.popup_year.popupContainer,"keyup",BX.proxy(this.year_popup_keyup,this)),this.popup_year.BXYEAR=this.value.getUTCFullYear()),this.popup_year.show()},this.year_popup_click=function(t){var e=t.target||t.srcElement;e&&e.getAttribute&&e.getAttribute("data-bx-year")&&(this.SetYear(parseInt(e.getAttribute("data-bx-year"))),this.popup_year.close())},this.year_popup_keyup=function(t){var e=t.target||t.srcElement;if(e&&e.getAttribute&&"Y"==e.getAttribute("data-bx-year-input")){var i=parseInt(e.value);i>=1900&&i<=2100&&(this.SetYear(i),this.popup_year.close())}},this._check_date=function(t){var e=t;return BX.type.isString(t)&&(e=BX.parseDate(t,!0)),BX.type.isDate(e)&&!isNaN(e.valueOf())||(e=BX.date.convertToUTC(new Date),this.params.bHideTime&&(e.setUTCHours(0),e.setUTCMinutes(0))),e.setUTCMilliseconds(0),e.setUTCSeconds(0),e.BXCHECKED=!0,e}},BX.JCCalendar.prototype.Show=function(t){if(BX.isReady){if(t.node=t.node||document.body,BX.type.isNotEmptyString(t.node)){var e=BX(t.node);e||(e=document.getElementsByName(t.node))&&e.length>0&&(e=e[0]),t.node=e}if(t.node){t.field&&BX.type.isString(t.field)&&((e=BX(t.field))?t.field=e:(t.form&&BX.type.isString(t.form)&&(t.form=document.forms[t.form]),BX.type.isDomNode(t.form)&&t.form[t.field]?t.field=t.form[t.field]:(e=document.getElementsByName(t.field))&&e.length>0&&(e=e[0],t.field=e)),BX.type.isString(t.field)&&(t.field=BX(t.field)));var i=!this.popup||!this.popup.isShown()||this.params.node!=t.node;this.params=t,this.params.bCompatibility=void 0!==this.params.bCompatibility&&!!this.params.bCompatibility,this.params.bTime=void 0===this.params.bTime||!!this.params.bTime,this.params.bHideTime=void 0===this.params.bHideTime||!!this.params.bHideTime,this.params.bUseSecond=void 0===this.params.bUseSecond||!!this.params.bUseSecond,this.weekStart=parseInt(this.params.weekStart||this.params.weekStart||BX.message("WEEK_START")),isNaN(this.weekStart)&&(this.weekStart=1),this.popup?this.popup.setBindElement(this.params.node):this._create(this.params);var s=!!this.params.bHideTime;return this.params.value?(this.SetValue(this.params.value),s=this.value.getUTCHours()<=0&&this.value.getUTCMinutes()<=0):this.params.field?(this.SetValue(this.params.field.value),s=this.value.getUTCHours()<=0&&this.value.getUTCMinutes()<=0):this.params.currentTime?this.SetValue(this.params.currentTime):this.SetValue(),this.params.bTime?this.activateTimeStyle(s):this.activateDateStyle(s),i&&(this._auto_hide_disable(),this.popup.show(),setTimeout(BX.proxy(this._auto_hide_enable,this),0)),this.params.bSetFocus=void 0===this.params.bSetFocus||!!this.params.bSetFocus,this.params.bSetFocus?t.node.blur():BX.bind(t.node,"keyup",BX.defer((function(){this.SetValue(t.node.value),this.params.bTime&&(this.value.getUTCHours()<=0&&this.value.getUTCMinutes()<=0?BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened"):BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened"))}),this)),this}}else BX.ready(BX.delegate((function(){this.Show(t)}),this))},BX.JCCalendar.prototype.activateDateStyle=function(t){BX.addClass(this.DIV,"bx-calendar-time-disabled"),t?BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened"):BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened")},BX.JCCalendar.prototype.activateTimeStyle=function(t){this.params.bCompatibility?(BX.addClass(this.PARTS.BUTTONS,"bx-calendar-buttons-disabled"),BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-wrap-simple"),BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened")):(BX.removeClass(this.DIV,"bx-calendar-time-disabled"),t?BX.removeClass(this.PARTS.TIME,"bx-calendar-set-time-opened"):BX.addClass(this.PARTS.TIME,"bx-calendar-set-time-opened"))},BX.JCCalendar.prototype.SetDay=function(t){return this.value.setUTCDate(t),this.SetValue(this.value)},BX.JCCalendar.prototype.SetMonth=function(t){for(this.popup_month&&this.popup_month.close(),this.value.setUTCMonth(t),t<0?t+=12:t>=12&&(t-=12);this.value.getUTCMonth()>t;)this.value.setUTCDate(this.value.getUTCDate()-1);return this.SetValue(this.value)},BX.JCCalendar.prototype.SetYear=function(t){return this.popup_year&&this.popup_year.close(),this.value.setUTCFullYear(t),this.SetValue(this.value)},BX.JCCalendar.prototype.SetDate=function(t,e){if((t=this._check_date(t)).setUTCHours(this.value.getUTCHours()),t.setUTCMinutes(this.value.getUTCMinutes()),t.setUTCSeconds(this.value.getUTCSeconds()),this.params.bTime&&!e)return this.SetValue(t);this.SetValue(t),this.SaveValue()},BX.JCCalendar.prototype.SetValue=function(t){if(this.value=t&&t.BXCHECKED?t:this._check_date(t),this.PARTS.MONTH.innerHTML=BX.message("MONTH_"+(this.value.getUTCMonth()+1)),this.PARTS.YEAR.innerHTML=this.value.getUTCFullYear(),this.params.bTime){var e=this.value.getUTCHours();this.bAmPm&&(e>=12?(this.PARTS.TIME_AMPM.innerHTML="PM",12!=e&&(e-=12)):(this.PARTS.TIME_AMPM.innerHTML="AM",0==e&&(e=12))),this.PARTS.TIME_INPUT_H.value=BX.util.str_pad_left(e.toString(),2,"0"),this.PARTS.TIME_INPUT_M.value=BX.util.str_pad_left(this.value.getUTCMinutes().toString(),2,"0")}return this._set_layer(),this},BX.JCCalendar.prototype.SaveValue=function(){this.popup_month&&this.popup_month.close(),this.popup_year&&this.popup_year.close();var t=!0;this.params.callback&&(!1===this.params.callback.apply(this,[new Date(this.value.valueOf()+6e4*this.value.getTimezoneOffset())])&&(t=!1));if(t){var e=!!this.params.bTime&&BX.hasClass(this.PARTS.TIME,"bx-calendar-set-time-opened");if(this.params.field){var i=BX.message(e?"FORMAT_DATETIME":"FORMAT_DATE");e&&!this.params.bUseSecond&&(i=i.replace(":SS","")),this.params.field.value=BX.calendar.ValueToStringFormat(this.value,i,!0),BX.fireEvent(this.params.field,"change")}this.popup.close(),this.params.callback_after&&this.params.callback_after.apply(this,[new Date(this.value.valueOf()+6e4*this.value.getTimezoneOffset()),e])}return this},BX.JCCalendar.prototype.Close=function(){return this.popup&&this.popup.close(),this},BX.JCSpinner=function(t){t=t||{},this.params={input:t.input||null,delta:t.delta||1,timeout_start:t.timeout_start||1e3,timeout_cont:t.timeout_cont||150,callback_start:t.callback_start||null,callback_change:t.callback_change||null,callback_finish:t.callback_finish||null,bSaveValue:void 0===t.bSaveValue?!!t.input:!!t.bSaveValue},this.mousedown=!1,this.direction=1},BX.JCSpinner.prototype.Show=function(){return this.node=BX.create("span",{events:{mousedown:BX.delegateEvent({attr:"data-dir"},BX.delegate(this.Start,this))},html:'<a href="javascript:void(0)" class="bx-calendar-form-arrow bx-calendar-form-arrow-top" data-dir="1"><i></i></a><a href="javascript:void(0)" class="bx-calendar-form-arrow bx-calendar-form-arrow-bottom" data-dir="-1"><i></i></a>'}),this.node},BX.JCSpinner.prototype.Start=function(){this.mousedown=!0,this.direction=BX.proxy_context.getAttribute("data-dir")>0?1:-1,BX.bind(document,"mouseup",BX.proxy(this.MouseUp,this)),this.ChangeValue(!0)},BX.JCSpinner.prototype.ChangeValue=function(t){if(this.mousedown&&this.params.input){var e=parseInt(this.params.input.value,10)+this.params.delta*this.direction;this.params.bSaveValue&&(this.params.input.value=e),t&&this.params.callback_start&&this.params.callback_start(this.params,e,this.direction),this.params.callback_change&&this.params.callback_change(this.params,e,this.direction),setTimeout(BX.proxy(this.ChangeValue,this),t?this.params.timeout_start:this.params.timeout_cont)}},BX.JCSpinner.prototype.MouseUp=function(){this.mousedown=!1,BX.unbind(document,"mouseup",BX.proxy(this.MouseUp,this)),this.params.callback_finish&&this.params.callback_finish(this.params,this.params.input.value)},window.jsCalendar={Show:function(t,e,i,s,n,o,a,r){return BX.calendar({node:t,field:e,form:a,bTime:!!n,currentTime:o,bHideTimebar:!!r})},ValueToString:BX.calendar.ValueToString},BX.CClockSelector=function(t){this.params=t,this.params.popup_buttons=this.params.popup_buttons||[new BX.PopupWindowButton({text:BX.message("CAL_BUTTON"),className:"popup-window-button-create",events:{click:BX.proxy(this.setValue,this)}})],this.isReady=!1,this.WND=new BX.PopupWindow(this.params.popup_id||"clock_selector_popup",this.params.node,this.params.popup_config||{titleBar:BX.message("CAL_TIME"),offsetLeft:-45,offsetTop:-135,autoHide:!0,closeIcon:!0,closeByEsc:!0,zIndex:this.params.zIndex}),this.SHOW=!1,BX.addCustomEvent(this.WND,"onPopupClose",BX.delegate(this.onPopupClose,this)),this.obClocks={},this.CLOCK_ID=this.params.clock_id||"clock_selector"},BX.CClockSelector.prototype.Show=function(){return this.isReady?(this.WND.setButtons(this.params.popup_buttons),this.WND.show(),this.SHOW=!0,window["bxClock_"+this.obClocks[this.CLOCK_ID]]&&setTimeout("window['bxClock_"+this.obClocks[this.CLOCK_ID]+"'].CalculateCoordinates()",40),!0):(BX.addCustomEvent("onClockRegister",BX.proxy(this.onClockRegister,this)),BX.ajax.get("/bitrix/tools/clock_selector.php",{start_time:this.params.start_time,clock_id:this.CLOCK_ID,sessid:BX.bitrix_sessid()},BX.delegate(this.Ready,this)))},BX.CClockSelector.prototype.onClockRegister=function(t){t[this.CLOCK_ID]&&(this.obClocks[this.CLOCK_ID]=t[this.CLOCK_ID],BX.removeCustomEvent("onClockRegister",BX.proxy(this.onClockRegister,this)))},BX.CClockSelector.prototype.Ready=function(t){this.content=this.CreateContent(t),this.WND.setContent(this.content),this.isReady=!0,setTimeout(BX.proxy(this.Show,this),30)},BX.CClockSelector.prototype.CreateContent=function(t){return BX.create("DIV",{events:{click:BX.PreventDefault},html:'<div class="bx-tm-popup-clock">'+t+"</div>"})},BX.CClockSelector.prototype.setValue=function(t){if(this.params.callback){var e=BX.findChild(this.content,{tagName:"INPUT"},!0);this.params.callback.apply(this.params.node,[e.value])}return BX.PreventDefault(t)},BX.CClockSelector.prototype.closeWnd=function(t){return this.WND.close(),!t&&!window.event||BX.PreventDefault(t)},BX.CClockSelector.prototype.setNode=function(t){this.WND.setBindElement(t)},BX.CClockSelector.prototype.setTime=function(t){this.params.start_time=t,window["bxClock_"+this.obClocks[this.CLOCK_ID]]&&window["bxClock_"+this.obClocks[this.CLOCK_ID]].SetTime(parseInt(t/3600),parseInt(t%3600/60))},BX.CClockSelector.prototype.setCallback=function(t){this.params.callback=t},BX.CClockSelector.prototype.onPopupClose=function(){this.SHOW=!1}}}();var bxSession=new CBXSession;