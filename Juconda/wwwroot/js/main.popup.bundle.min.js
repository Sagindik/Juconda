this.BX=this.BX||{},function(e,t,n){"use strict";var i=function(){function e(t){for(var i in babelHelpers.classCallCheck(this,e),this.popupWindow=null,this.params=t||{},this.text=this.params.text||"",this.id=this.params.id||"",this.className=this.params.className||"",this.events=this.params.events||{},this.contextEvents={},this.events)n.Type.isFunction(this.events[i])&&(this.contextEvents[i]=this.events[i].bind(this));this.buttonNode=n.Dom.create("span",{props:{className:"popup-window-button"+(this.className.length>0?" "+this.className:""),id:this.id},events:this.contextEvents,text:this.text})}return babelHelpers.createClass(e,[{key:"render",value:function(){return this.buttonNode}},{key:"getId",value:function(){return this.id}},{key:"getContainer",value:function(){return this.buttonNode}},{key:"getName",value:function(){return this.text}},{key:"setName",value:function(e){this.text=e||"",this.buttonNode&&(n.Dom.clean(this.buttonNode),n.Dom.adjust(this.buttonNode,{text:this.text}))}},{key:"setClassName",value:function(e){this.buttonNode&&(n.Type.isString(this.className)&&""!==this.className&&n.Dom.removeClass(this.buttonNode,this.className),n.Dom.addClass(this.buttonNode,e)),this.className=e}},{key:"addClassName",value:function(e){this.buttonNode&&(n.Dom.addClass(this.buttonNode,e),this.className=this.buttonNode.className)}},{key:"removeClassName",value:function(e){this.buttonNode&&(n.Dom.removeClass(this.buttonNode,e),this.className=this.buttonNode.className)}}]),e}();function s(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="popup-window-overlay" id="popup-window-overlay-','"></div>\n\t\t\t\t']);return s=function(){return e},e}function o(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="popup-window-resize" onmousedown="','"></div>\n\t\t\t\t']);return o=function(){return e},e}function a(){var e=babelHelpers.taggedTemplateLiteral(['<div class="'," ","-",'"></div>']);return a=function(){return e},e}function l(){var e=babelHelpers.taggedTemplateLiteral(['<div class="popup-window-buttons">',"</div>"]);return l=function(){return e},e}function u(){var e=babelHelpers.taggedTemplateLiteral(['<div \n\t\t\t\tclass="','" \n\t\t\t\tid="','"\n\t\t\t\tstyle="display: none; position: absolute; left: 0; top: 0; z-index: ','"\n\t\t\t>',"</div>"]);return u=function(){return e},e}function r(){var e=babelHelpers.taggedTemplateLiteral(['<div id="popup-window-content-','" class="popup-window-content"></div>']);return r=function(){return e},e}function h(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="','" onclick="','"></span>\n\t\t\t']);return h=function(){return e},e}function p(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="popup-window-titlebar" id="popup-window-titlebar-','"></div>\n\t\t\t']);return p=function(){return e},e}var d={onPopupWindowInit:{namespace:"BX.Main.Popup",eventName:"onInit"},onPopupWindowIsInitialized:{namespace:"BX.Main.Popup",eventName:"onAfterInit"},onPopupFirstShow:{namespace:"BX.Main.Popup",eventName:"onFirstShow"},onPopupShow:{namespace:"BX.Main.Popup",eventName:"onShow"},onAfterPopupShow:{namespace:"BX.Main.Popup",eventName:"onAfterShow"},onPopupClose:{namespace:"BX.Main.Popup",eventName:"onClose"},onPopupAfterClose:{namespace:"BX.Main.Popup",eventName:"onAfterClose"},onPopupDestroy:{namespace:"BX.Main.Popup",eventName:"onDestroy"},onPopupFullscreenLeave:{namespace:"BX.Main.Popup",eventName:"onFullscreenLeave"},onPopupFullscreenEnter:{namespace:"BX.Main.Popup",eventName:"onFullscreenEnter"},onPopupDragStart:{namespace:"BX.Main.Popup",eventName:"onDragStart"},onPopupDrag:{namespace:"BX.Main.Popup",eventName:"onDrag"},onPopupDragEnd:{namespace:"BX.Main.Popup",eventName:"onDragEnd"},onPopupResizeStart:{namespace:"BX.Main.Popup",eventName:"onResizeStart"},onPopupResize:{namespace:"BX.Main.Popup",eventName:"onResize"},onPopupResizeEnd:{namespace:"BX.Main.Popup",eventName:"onResizeEnd"}};t.EventEmitter.registerAliases(d);var c=function(e){function c(e){var i;babelHelpers.classCallCheck(this,c),(i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(c).call(this))).setEventNamespace("BX.Main.Popup");var s=Array.prototype.slice.call(arguments),o=s[0],a=s[1],l=s[2];i.compatibleMode=!l||!n.Type.isBoolean(l.compatibleMode)||l.compatibleMode,!n.Type.isPlainObject(e)||a||l||(l=e,o=e.id,a=e.bindElement,i.compatibleMode=!1),l=l||{},i.params=l,n.Type.isStringFilled(o)||(o="popup-window-"+n.Text.getRandom().toLowerCase()),i.emit("onInit",new t.BaseEvent({compatData:[o,a,l]})),i.uniquePopupId=o,i.params.zIndex=n.Type.isNumber(l.zIndex)?parseInt(l.zIndex):0,i.params.zIndexAbsolute=n.Type.isNumber(l.zIndexAbsolute)?parseInt(l.zIndexAbsolute):0,i.buttons=l.buttons&&n.Type.isArray(l.buttons)?l.buttons:[],i.offsetTop=c.getOption("offsetTop"),i.offsetLeft=c.getOption("offsetLeft"),i.firstShow=!1,i.bordersWidth=20,i.bindElementPos=null,i.closeIcon=null,i.resizeIcon=null,i.angle=null,i.overlay=null,i.titleBar=null,i.bindOptions="object"===babelHelpers.typeof(l.bindOptions)?l.bindOptions:{},i.autoHide=!0===l.autoHide,i.autoHideHandler=n.Type.isFunction(l.autoHideHandler)?l.autoHideHandler:null,i.handleAutoHide=i.handleAutoHide.bind(babelHelpers.assertThisInitialized(i)),i.handleOverlayClick=i.handleOverlayClick.bind(babelHelpers.assertThisInitialized(i)),i.isAutoHideBinded=!1,i.closeByEsc=!0===l.closeByEsc,i.isCloseByEscBinded=!1,i.cacheable=!0,i.destroyed=!1,i.width=null,i.height=null,i.minWidth=null,i.minHeight=null,i.maxWidth=null,i.maxHeight=null,i.padding=null,i.contentPadding=null,i.background=null,i.contentBackground=null,i.appendContainer=document.body,i.dragOptions={cursor:"",callback:function(){},eventName:""},i.dragged=!1,i.dragPageX=0,i.dragPageY=0,i.animationShowClassName=null,i.animationCloseClassName=null,i.animationCloseEventType=null,i.handleDocumentMouseMove=i.handleDocumentMouseMove.bind(babelHelpers.assertThisInitialized(i)),i.handleDocumentMouseUp=i.handleDocumentMouseUp.bind(babelHelpers.assertThisInitialized(i)),i.handleDocumentKeyUp=i.handleDocumentKeyUp.bind(babelHelpers.assertThisInitialized(i)),i.handleResizeWindow=i.handleResizeWindow.bind(babelHelpers.assertThisInitialized(i)),i.handleResize=i.handleResize.bind(babelHelpers.assertThisInitialized(i)),i.handleMove=i.handleMove.bind(babelHelpers.assertThisInitialized(i)),i.onTitleMouseDown=i.onTitleMouseDown.bind(babelHelpers.assertThisInitialized(i)),i.handleFullScreen=i.handleFullScreen.bind(babelHelpers.assertThisInitialized(i)),i.subscribeFromOptions(l.events);var d="popup-window";if(l.contentColor&&n.Type.isStringFilled(l.contentColor)&&(d+=" popup-window-content-"+l.contentColor),l.titleBar&&(d+=" popup-window-with-titlebar"),l.className&&n.Type.isStringFilled(l.className)&&(d+=" "+l.className),l.darkMode&&(d+=" popup-window-dark"),l.titleBar&&(i.titleBar=n.Tag.render(p(),o)),l.closeIcon){var m="popup-window-close-icon"+(l.titleBar?" popup-window-titlebar-close-icon":"");i.closeIcon=n.Tag.render(h(),m,i.handleCloseIconClick.bind(babelHelpers.assertThisInitialized(i))),n.Type.isPlainObject(l.closeIcon)&&n.Dom.style(i.closeIcon,l.closeIcon)}return i.contentContainer=n.Tag.render(r(),o),i.popupContainer=n.Tag.render(u(),d,o,i.getZindex(),[i.titleBar,i.contentContainer,i.closeIcon]),i.appendContainer.appendChild(i.popupContainer),i.buttonsContainer=null,l.angle&&i.setAngle(l.angle),l.overlay&&i.setOverlay(l.overlay),i.setOffset(l),i.setBindElement(a),i.setTitleBar(l.titleBar),i.setContent(l.content),i.setButtons(l.buttons),i.setWidth(l.width),i.setHeight(l.height),i.setMinWidth(l.minWidth),i.setMinHeight(l.minHeight),i.setMaxWidth(l.maxWidth),i.setMaxHeight(l.maxHeight),i.setResizeMode(l.resizable),i.setPadding(l.padding),i.setContentPadding(l.contentPadding),i.setBackground(l.background),i.setContentBackground(l.contentBackground),i.setAnimation(l.animation),i.setCacheable(l.cacheable),l.contentNoPaddings&&i.setContentPadding(0),l.noAllPaddings&&(i.setPadding(0),i.setContentPadding(0)),!1!==l.bindOnResize&&n.Event.bind(window,"resize",i.handleResizeWindow),i.emit("onAfterInit",new t.BaseEvent({compatData:[o,babelHelpers.assertThisInitialized(i)]})),i}return babelHelpers.inherits(c,e),babelHelpers.createClass(c,null,[{key:"setOptions",value:function(e){if(n.Type.isPlainObject(e))for(var t in e)this.options[t]=e[t]}},{key:"getOption",value:function(e,t){return n.Type.isUndefined(this.options[e])?n.Type.isUndefined(t)?this.defaultOptions[e]:t:this.options[e]}}]),babelHelpers.createClass(c,[{key:"subscribeFromOptions",value:function(e){babelHelpers.get(babelHelpers.getPrototypeOf(c.prototype),"subscribeFromOptions",this).call(this,e,d)}},{key:"getId",value:function(){return this.uniquePopupId}},{key:"isCompatibleMode",value:function(){return this.compatibleMode}},{key:"setContent",value:function(e){if(this.contentContainer&&e)if(n.Type.isElementNode(e)){n.Dom.clean(this.contentContainer);var t=n.Type.isDomNode(e.parentNode);this.contentContainer.appendChild(e),(this.isCompatibleMode()||t)&&(e.style.display="block")}else n.Type.isString(e)?this.contentContainer.innerHTML=e:this.contentContainer.innerHTML="&nbsp;"}},{key:"setButtons",value:function(e){this.buttons=e&&n.Type.isArray(e)?e:[],this.buttonsContainer&&n.Dom.remove(this.buttonsContainer);var t=n.Reflection.getClass("BX.UI.Button");if(this.buttons.length>0&&this.contentContainer){for(var s=[],o=0;o<this.buttons.length;o++){var a=this.buttons[o];a instanceof i?(a.popupWindow=this,s.push(a.render())):t&&a instanceof t&&(a.setContext(this),s.push(a.render()))}this.buttonsContainer=this.contentContainer.parentNode.appendChild(n.Tag.render(l(),s))}}},{key:"getButtons",value:function(){return this.buttons}},{key:"getButton",value:function(e){for(var t=0;t<this.buttons.length;t++){var n=this.buttons[t];if(n.getId()===e)return n}return null}},{key:"setBindElement",value:function(e){null===e?this.bindElement=null:"object"===babelHelpers.typeof(e)&&(n.Type.isDomNode(e)||n.Type.isNumber(e.top)&&n.Type.isNumber(e.left)?this.bindElement=e:n.Type.isNumber(e.clientX)&&n.Type.isNumber(e.clientY)&&(this.bindElement={left:e.pageX,top:e.pageY,bottom:e.pageY}))}},{key:"getBindElementPos",value:function(e){if(n.Type.isDomNode(e))return n.Dom.getPosition(e);if(e&&"object"===babelHelpers.typeof(e))return n.Type.isNumber(e.bottom)||(e.bottom=e.top),e;var t={innerWidth:window.innerWidth,innerHeight:window.innerHeight},i={scrollLeft:window.pageXOffset,scrollTop:window.pageYOffset},s=this.getPopupContainer().offsetWidth,o=this.getPopupContainer().offsetHeight;return this.bindOptions.forceTop=!0,{left:t.innerWidth/2-s/2+i.scrollLeft,top:t.innerHeight/2-o/2+i.scrollTop,bottom:t.innerHeight/2-o/2+i.scrollTop,windowSize:t,windowScroll:i,popupWidth:s,popupHeight:o}}},{key:"setAngle",value:function(e){if(!1===e)return null!==this.angle&&n.Dom.remove(this.angle.element),void(this.angle=null);var t="popup-window-angly";if(null===this.angle){var i=this.bindOptions.position&&"top"===this.bindOptions.position?"bottom":"top",s=c.getOption("top"===i?"angleMinTop":"angleMinBottom"),o=n.Type.isNumber(e.offset)?e.offset:0,l=c.getOption("angleLeftOffset",null);o>0&&n.Type.isNumber(l)&&(o+=l-c.defaultOptions.angleLeftOffset),this.angle={element:n.Tag.render(a(),t,t,i),position:i,offset:0,defaultOffset:Math.max(o,s)},this.getPopupContainer().appendChild(this.angle.element)}if("object"===babelHelpers.typeof(e)&&e.position&&["top","right","bottom","left","hide"].includes(e.position)&&(n.Dom.removeClass(this.angle.element,t+"-"+this.angle.position),n.Dom.addClass(this.angle.element,t+"-"+e.position),this.angle.position=e.position),"object"===babelHelpers.typeof(e)&&n.Type.isNumber(e.offset)){var u,r,h=e.offset;"top"===this.angle.position?(u=c.getOption("angleMinTop"),r=(r=this.getPopupContainer().offsetWidth-c.getOption("angleMaxTop"))<u?Math.max(u,h):r,this.angle.offset=Math.min(Math.max(u,h),r),this.angle.element.style.left=this.angle.offset+"px",this.angle.element.style.marginLeft=0,this.angle.element.style.removeProperty("top")):"bottom"===this.angle.position?(u=c.getOption("angleMinBottom"),r=(r=this.getPopupContainer().offsetWidth-c.getOption("angleMaxBottom"))<u?Math.max(u,h):r,this.angle.offset=Math.min(Math.max(u,h),r),this.angle.element.style.marginLeft=this.angle.offset+"px",this.angle.element.style.left=0,this.angle.element.style.removeProperty("top")):"right"===this.angle.position?(u=c.getOption("angleMinRight"),r=(r=this.getPopupContainer().offsetHeight-c.getOption("angleMaxRight"))<u?Math.max(u,h):r,this.angle.offset=Math.min(Math.max(u,h),r),this.angle.element.style.top=this.angle.offset+"px",this.angle.element.style.removeProperty("left"),this.angle.element.style.removeProperty("margin-left")):"left"===this.angle.position&&(u=c.getOption("angleMinLeft"),r=(r=this.getPopupContainer().offsetHeight-c.getOption("angleMaxLeft"))<u?Math.max(u,h):r,this.angle.offset=Math.min(Math.max(u,h),r),this.angle.element.style.top=this.angle.offset+"px",this.angle.element.style.removeProperty("left"),this.angle.element.style.removeProperty("margin-left"))}}},{key:"getWidth",value:function(){return this.width}},{key:"setWidth",value:function(e){this.setWidthProperty("width",e)}},{key:"getHeight",value:function(){return this.height}},{key:"setHeight",value:function(e){this.setHeightProperty("height",e)}},{key:"getMinWidth",value:function(){return this.minWidth}},{key:"setMinWidth",value:function(e){this.setWidthProperty("minWidth",e)}},{key:"getMinHeight",value:function(){return this.minHeight}},{key:"setMinHeight",value:function(e){this.setHeightProperty("minHeight",e)}},{key:"getMaxWidth",value:function(){return this.maxWidth}},{key:"setMaxWidth",value:function(e){this.setWidthProperty("maxWidth",e)}},{key:"getMaxHeight",value:function(){return this.maxHeight}},{key:"setMaxHeight",value:function(e){this.setHeightProperty("maxHeight",e)}},{key:"setWidthProperty",value:function(e,t){var i=["width","minWidth","maxWidth"];if(-1!==i.indexOf(e))if(n.Type.isNumber(t)&&t>=0)this[e]=t,this.getResizableContainer().style[e]=t+"px",this.getContentContainer().style.overflowX="auto",this.getPopupContainer().classList.add("popup-window-fixed-width"),this.getTitleContainer()&&n.Browser.isIE11()&&(this.getTitleContainer().style[e]=t+"px");else if(null===t||!1===t){this[e]=null,this.getResizableContainer().style.removeProperty(n.Text.toKebabCase(e)),i.some((function(e){return""!==this.getResizableContainer().style.getPropertyValue(n.Text.toKebabCase(e))}),this)||(this.getContentContainer().style.removeProperty("overflow-x"),this.getPopupContainer().classList.remove("popup-window-fixed-width")),this.getTitleContainer()&&n.Browser.isIE11()&&this.getTitleContainer().style.removeProperty(n.Text.toKebabCase(e))}}},{key:"setHeightProperty",value:function(e,t){var i=["height","minHeight","maxHeight"];if(-1!==i.indexOf(e))if(n.Type.isNumber(t)&&t>=0)this[e]=t,this.getResizableContainer().style[e]=t+"px",this.getContentContainer().style.overflowY="auto",this.getPopupContainer().classList.add("popup-window-fixed-height");else if(null===t||!1===t){this[e]=null,this.getResizableContainer().style.removeProperty(n.Text.toKebabCase(e)),i.some((function(e){return""!==this.getResizableContainer().style.getPropertyValue(n.Text.toKebabCase(e))}),this)||(this.getContentContainer().style.removeProperty("overflow-y"),this.getPopupContainer().classList.remove("popup-window-fixed-height"))}}},{key:"setPadding",value:function(e){n.Type.isNumber(e)&&e>=0?(this.padding=e,this.getPopupContainer().style.padding=e+"px"):null===e&&(this.padding=null,this.getPopupContainer().style.removeProperty("padding"))}},{key:"getPadding",value:function(){return this.padding}},{key:"setContentPadding",value:function(e){n.Type.isNumber(e)&&e>=0?(this.contentPadding=e,this.getContentContainer().style.padding=e+"px"):null===e&&(this.contentPadding=null,this.getContentContainer().style.removeProperty("padding"))}},{key:"getContentPadding",value:function(){return this.contentPadding}},{key:"setBackground",value:function(e){n.Type.isStringFilled(e)?(this.background=e,this.getPopupContainer().style.background=e):null===e&&(this.background=null,this.getPopupContainer().style.removeProperty("background"))}},{key:"getBackground",value:function(){return this.background}},{key:"setContentBackground",value:function(e){n.Type.isStringFilled(e)?(this.contentBackground=e,this.getContentContainer().style.background=e):null===e&&(this.contentBackground=null,this.getContentContainer().style.removeProperty("background"))}},{key:"getContentBackground",value:function(){return this.contentBackground}},{key:"isDestroyed",value:function(){return this.destroyed}},{key:"setCacheable",value:function(e){this.cacheable=!1!==e}},{key:"isCacheable",value:function(){return this.cacheable}},{key:"setResizeMode",value:function(e){!0===e||n.Type.isPlainObject(e)?(this.resizeIcon||(this.resizeIcon=n.Tag.render(o(),this.handleResizeMouseDown.bind(this)),this.getPopupContainer().appendChild(this.resizeIcon)),this.setMinWidth(e.minWidth),this.setMinHeight(e.minHeight)):!1===e&&this.resizeIcon&&(n.Dom.remove(this.resizeIcon),this.resizeIcon=null)}},{key:"getPopupContainer",value:function(){return this.popupContainer}},{key:"getContentContainer",value:function(){return this.contentContainer}},{key:"getResizableContainer",value:function(){return n.Browser.isIE11()?this.getContentContainer():this.getPopupContainer()}},{key:"getTitleContainer",value:function(){return this.titleBar}},{key:"onTitleMouseDown",value:function(e){this._startDrag(e,{cursor:"move",callback:this.handleMove,eventName:"Drag"})}},{key:"handleResizeMouseDown",value:function(e){this._startDrag(e,{cursor:"nwse-resize",eventName:"Resize",callback:this.handleResize}),this.resizeContentPos=n.Dom.getPosition(this.getResizableContainer()),this.resizeContentOffset=this.resizeContentPos.left-n.Dom.getPosition(this.getPopupContainer()).left}},{key:"handleResize",value:function(e,t,n,i){var s=n-this.resizeContentPos.left,o=i-this.resizeContentPos.top,a=document.documentElement.scrollWidth;this.resizeContentPos.left+s+this.resizeContentOffset>=a&&(s=a-this.resizeContentPos.left-this.resizeContentOffset),s=Math.max(s,this.getMinWidth()),o=Math.max(o,this.getMinHeight()),null!==this.getMaxWidth()&&(s=Math.min(s,this.getMaxWidth())),null!==this.getMaxHeight()&&(o=Math.min(o,this.getMaxHeight())),this.setWidth(s),this.setHeight(o)}},{key:"isTopAngle",value:function(){return null!==this.angle&&"top"===this.angle.position}},{key:"isBottomAngle",value:function(){return null!==this.angle&&"bottom"===this.angle.position}},{key:"isTopOrBottomAngle",value:function(){return null!==this.angle&&("top"===this.angle.position||"bottom"===this.angle.position)}},{key:"getAngleHeight",value:function(){return this.isTopOrBottomAngle()?c.getOption("angleTopOffset"):0}},{key:"setOffset",value:function(e){n.Type.isPlainObject(e)&&(n.Type.isNumber(e.offsetLeft)&&(this.offsetLeft=e.offsetLeft+c.getOption("offsetLeft")),n.Type.isNumber(e.offsetTop)&&(this.offsetTop=e.offsetTop+c.getOption("offsetTop")))}},{key:"setTitleBar",value:function(e){this.titleBar&&("object"===babelHelpers.typeof(e)&&n.Type.isDomNode(e.content)?(this.titleBar.innerHTML="",this.titleBar.appendChild(e.content)):"string"==typeof e&&(this.titleBar.innerHTML="",this.titleBar.appendChild(n.Dom.create("span",{props:{className:"popup-window-titlebar-text"},text:e}))),this.params.draggable&&(this.titleBar.style.cursor="move",n.Event.bind(this.titleBar,"mousedown",this.onTitleMouseDown)))}},{key:"setClosingByEsc",value:function(e){(e=!n.Type.isBoolean(e)||e)?(this.closeByEsc=!0,this.bindClosingByEsc()):(this.closeByEsc=!1,this.unbindClosingByEsc())}},{key:"bindClosingByEsc",value:function(){this.closeByEsc&&!this.isCloseByEscBinded&&(n.Event.bind(document,"keyup",this.handleDocumentKeyUp),this.isCloseByEscBinded=!0)}},{key:"unbindClosingByEsc",value:function(){this.isCloseByEscBinded&&(n.Event.unbind(document,"keyup",this.handleDocumentKeyUp),this.isCloseByEscBinded=!1)}},{key:"setAutoHide",value:function(e){(e=!n.Type.isBoolean(e)||e)?(this.autoHide=!0,this.bindAutoHide()):(this.autoHide=!1,this.unbindAutoHide())}},{key:"bindAutoHide",value:function(){this.autoHide&&!this.isAutoHideBinded&&this.isShown()&&(this.isAutoHideBinded=!0,this.isCompatibleMode()&&n.Event.bind(this.getPopupContainer(),"click",this.handleContainerClick),this.overlay&&this.overlay.element?n.Event.bind(this.overlay.element,"click",this.handleOverlayClick):this.isCompatibleMode()?n.Event.bind(document,"click",this.handleAutoHide):document.addEventListener("click",this.handleAutoHide,!0))}},{key:"unbindAutoHide",value:function(){this.isAutoHideBinded&&(this.isAutoHideBinded=!1,this.isCompatibleMode()&&n.Event.unbind(this.getPopupContainer(),"click",this.handleContainerClick),this.overlay&&this.overlay.element?n.Event.unbind(this.overlay.element,"click",this.handleOverlayClick):this.isCompatibleMode()?n.Event.unbind(document,"click",this.handleAutoHide):document.removeEventListener("click",this.handleAutoHide,!0))}},{key:"handleAutoHide",value:function(e){this.isDestroyed()||(null!==this.autoHideHandler?this.autoHideHandler(e)&&this._tryCloseByEvent(e):e.target===this.getPopupContainer()||this.getPopupContainer().contains(e.target)||this._tryCloseByEvent(e))}},{key:"_tryCloseByEvent",value:function(e){var t=this;this.isCompatibleMode()?this.tryCloseByEvent(e):setTimeout((function(){t.tryCloseByEvent(e)}),0)}},{key:"tryCloseByEvent",value:function(e){0===e.button&&this.close()}},{key:"handleOverlayClick",value:function(e){this.tryCloseByEvent(e),e.stopPropagation()}},{key:"setOverlay",value:function(e){null===this.overlay&&(this.overlay={element:n.Tag.render(s(),this.getId())},this.adjustOverlayZindex(),this.resizeOverlay(),this.appendContainer.appendChild(this.overlay.element)),e&&n.Type.isNumber(e.opacity)&&e.opacity>=0&&e.opacity<=100&&(this.overlay.element.style.opacity=parseFloat(e.opacity/100).toPrecision(3)),e&&e.backgroundColor&&(this.overlay.element.style.backgroundColor=e.backgroundColor)}},{key:"removeOverlay",value:function(){null!==this.overlay&&null!==this.overlay.element&&n.Dom.remove(this.overlay.element),this.overlayTimeout&&(clearInterval(this.overlayTimeout),this.overlayTimeout=null),this.overlay=null}},{key:"hideOverlay",value:function(){null!==this.overlay&&null!==this.overlay.element&&(this.overlayTimeout&&(clearInterval(this.overlayTimeout),this.overlayTimeout=null),this.overlay.element.style.display="none")}},{key:"showOverlay",value:function(){var e=this;if(null!==this.overlay&&null!==this.overlay.element){this.overlay.element.style.display="block";var t=this.getPopupContainer().offsetHeight;this.overlayTimeout=setInterval((function(){t!==e.getPopupContainer().offsetHeight&&(e.resizeOverlay(),t=e.getPopupContainer().offsetHeight)}),1e3)}}},{key:"resizeOverlay",value:function(){if(null!==this.overlay&&null!==this.overlay.element){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);this.overlay.element.style.width=document.documentElement.scrollWidth+"px",this.overlay.element.style.height=e+"px"}}},{key:"getZindex",value:function(){return null!==this.overlay?this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:c.getOption("popupOverlayZindex")+this.params.zIndex:this.params.zIndexAbsolute>0?this.params.zIndexAbsolute:c.getOption("popupZindex")+this.params.zIndex}},{key:"adjustOverlayZindex",value:function(){null!==this.overlay&&null!==this.overlay.element&&(this.overlay.element.style.zIndex=parseInt(this.getPopupContainer().style.zIndex)-1)}},{key:"show",value:function(){var e=this;this.isShown()||this.isDestroyed()||(this.firstShow||(this.emit("onFirstShow",new t.BaseEvent({compatData:[this]})),this.firstShow=!0),this.emit("onShow",new t.BaseEvent({compatData:[this]})),this.showOverlay(),this.getPopupContainer().style.display="block",this.adjustPosition(),this.animateOpening((function(){e.isDestroyed()||(n.Dom.removeClass(e.getPopupContainer(),e.animationShowClassName),e.emit("onAfterShow",new t.BaseEvent({compatData:[e]})))})),this.bindClosingByEsc(),this.isCompatibleMode()?setTimeout((function(){e.bindAutoHide()}),100):this.bindAutoHide())}},{key:"close",value:function(){var e=this;!this.isDestroyed()&&this.isShown()&&(this.emit("onClose",new t.BaseEvent({compatData:[this]})),this.isDestroyed()||this.animateClosing((function(){e.isDestroyed()||(e.hideOverlay(),e.getPopupContainer().style.display="none",n.Dom.removeClass(e.getPopupContainer(),e.animationCloseClassName),e.unbindClosingByEsc(),e.isCompatibleMode()?setTimeout((function(){e.unbindAutoHide()}),0):e.unbindAutoHide(),e.emit("onAfterClose",new t.BaseEvent({compatData:[e]})),e.isCacheable()||e.destroy())})))}},{key:"toggle",value:function(){this.isShown()?this.close():this.show()}},{key:"animateOpening",value:function(e){if(n.Dom.removeClass(this.getPopupContainer(),this.animationCloseClassName),null!==this.animationShowClassName)if(n.Dom.addClass(this.getPopupContainer(),this.animationShowClassName),null!==this.animationCloseEventType){var t=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(t,(function n(){this.removeEventListener(t,n),e()}))}else e();else e()}},{key:"animateClosing",value:function(e){if(n.Dom.removeClass(this.getPopupContainer(),this.animationShowClassName),null!==this.animationCloseClassName)if(n.Dom.addClass(this.getPopupContainer(),this.animationCloseClassName),null!==this.animationCloseEventType){var t=this.animationCloseEventType+"end";this.getPopupContainer().addEventListener(t,(function n(){this.removeEventListener(t,n),e()}))}else e();else e()}},{key:"setAnimation",value:function(e){if(n.Type.isPlainObject(e))this.animationShowClassName=n.Type.isStringFilled(e.showClassName)?e.showClassName:null,this.animationCloseClassName=n.Type.isStringFilled(e.closeClassName)?e.closeClassName:null,this.animationCloseEventType="animation"===e.closeAnimationType||"transition"===e.closeAnimationType?e.closeAnimationType:null;else if(n.Type.isStringFilled(e)){var t=e;"fading"===t?(this.animationShowClassName="popup-window-show-animation-opacity",this.animationCloseClassName="popup-window-close-animation-opacity",this.animationCloseEventType="animation"):"fading-slide"===t?(this.animationShowClassName="popup-window-show-animation-opacity-transform",this.animationCloseClassName="popup-window-close-animation-opacity",this.animationCloseEventType="animation"):"scale"===t&&(this.animationShowClassName="popup-window-show-animation-scale",this.animationCloseClassName="popup-window-close-animation-opacity",this.animationCloseEventType="animation")}else!1!==e&&null!==e||(this.animationShowClassName=null,this.animationCloseClassName=null,this.animationCloseEventType=null)}},{key:"isShown",value:function(){return!this.isDestroyed()&&"block"===this.getPopupContainer().style.display}},{key:"destroy",value:function(){var e=this;this.destroyed||(this.destroyed=!0,this.emit("onDestroy",new t.BaseEvent({compatData:[this]})),this.unbindClosingByEsc(),this.isCompatibleMode()?setTimeout((function(){e.unbindAutoHide()}),0):this.unbindAutoHide(),n.Event.unbindAll(this),n.Event.unbind(document,"mousemove",this.handleDocumentMouseMove),n.Event.unbind(document,"mouseup",this.handleDocumentMouseUp),n.Event.unbind(window,"resize",this.handleResizeWindow),n.Dom.remove(this.popupContainer),this.removeOverlay(),this.popupContainer=null,this.contentContainer=null,this.closeIcon=null,this.titleBar=null,this.buttonsContainer=null,this.angle=null,this.resizeIcon=null)}},{key:"adjustPosition",value:function(e){e&&"object"===babelHelpers.typeof(e)&&(this.bindOptions=e);var t=this.getBindElementPos(this.bindElement);if(this.bindOptions.forceBindPosition||null===this.bindElementPos||t.top!==this.bindElementPos.top||t.left!==this.bindElementPos.left){this.bindElementPos=t;var i=t.windowSize?t.windowSize:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},s=t.windowScroll?t.windowScroll:{scrollLeft:window.pageXOffset,scrollTop:window.pageYOffset},o=t.popupWidth?t.popupWidth:this.popupContainer.offsetWidth,a=t.popupHeight?t.popupHeight:this.popupContainer.offsetHeight,l=c.getOption("angleTopOffset"),u=this.bindElementPos.left+this.offsetLeft-(this.isTopOrBottomAngle()?c.getOption("angleLeftOffset"):0);if(!this.bindOptions.forceLeft&&u+o+this.bordersWidth>=i.innerWidth+s.scrollLeft&&i.innerWidth+s.scrollLeft-o-this.bordersWidth>0){var r=u;u=i.innerWidth+s.scrollLeft-o-this.bordersWidth,this.isTopOrBottomAngle()&&this.setAngle({offset:r-u+this.angle.defaultOffset})}else this.isTopOrBottomAngle()&&this.setAngle({offset:this.angle.defaultOffset+(u<0?u:0)});u<0&&(u=0);var h=0;this.bindOptions.position&&"top"===this.bindOptions.position?(h=this.bindElementPos.top-a-this.offsetTop-(this.isBottomAngle()?l:0))<0||!this.bindOptions.forceTop&&h<s.scrollTop?(h=this.bindElementPos.bottom+this.offsetTop,null!==this.angle&&(h+=l,this.setAngle({position:"top"}))):this.isTopAngle()?(h=h-l+c.getOption("positionTopXOffset"),this.setAngle({position:"bottom"})):h+=c.getOption("positionTopXOffset"):(h=this.bindElementPos.bottom+this.offsetTop+this.getAngleHeight(),!this.bindOptions.forceTop&&h+a>i.innerHeight+s.scrollTop&&this.bindElementPos.top-a-this.getAngleHeight()>=0?(h=this.bindElementPos.top-a,this.isTopOrBottomAngle()&&(h-=l,this.setAngle({position:"bottom"})),h+=c.getOption("positionTopXOffset")):this.isBottomAngle()&&(h+=l,this.setAngle({position:"top"}))),h<0&&(h=0),n.Dom.adjust(this.popupContainer,{style:{top:h+"px",left:u+"px",zIndex:this.getZindex()}}),this.adjustOverlayZindex()}}},{key:"enterFullScreen",value:function(){c.fullscreenStatus?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this.contentContainer.requestFullScreen?(this.contentContainer.requestFullScreen(),n.Event.bind(window,"fullscreenchange",this.handleFullScreen)):this.contentContainer.mozRequestFullScreen?(this.contentContainer.mozRequestFullScreen(),n.Event.bind(window,"mozfullscreenchange",this.handleFullScreen)):this.contentContainer.webkitRequestFullScreen?(this.contentContainer.webkitRequestFullScreen(),n.Event.bind(window,"webkitfullscreenchange",this.handleFullScreen)):console.log("fullscreen mode is not supported")}},{key:"handleFullScreen",value:function(e){c.fullscreenStatus?(n.Event.unbind(window,"fullscreenchange",this.handleFullScreen),n.Event.unbind(window,"webkitfullscreenchange",this.handleFullScreen),n.Event.unbind(window,"mozfullscreenchange",this.handleFullScreen),c.fullscreenStatus=!1,this.isDestroyed()||(n.Dom.removeClass(this.contentContainer,"popup-window-fullscreen"),this.emit("onFullscreenLeave"),this.adjustPosition())):(c.fullscreenStatus=!0,this.isDestroyed()||(n.Dom.addClass(this.contentContainer,"popup-window-fullscreen"),this.emit("onFullscreenEnter"),this.adjustPosition()))}},{key:"handleCloseIconClick",value:function(e){this.tryCloseByEvent(e),e.stopPropagation()}},{key:"handleContainerClick",value:function(e){e.stopPropagation()}},{key:"handleDocumentKeyUp",value:function(e){var t=this;27===e.keyCode&&f(this.getZindex(),(function(){t.close()}))}},{key:"handleResizeWindow",value:function(){this.isShown()&&(this.adjustPosition(),null!==this.overlay&&this.resizeOverlay())}},{key:"handleMove",value:function(e,t,n,i){var s=parseInt(this.popupContainer.style.left)+e,o=parseInt(this.popupContainer.style.top)+t;if("object"===babelHelpers.typeof(this.params.draggable)&&this.params.draggable.restrict){s<0&&(s=0);var a=document.documentElement.scrollWidth,l=document.documentElement.scrollHeight,u=this.popupContainer.offsetWidth,r=this.popupContainer.offsetHeight;s>a-u&&(s=a-u),o>l-r&&(o=l-r),o<0&&(o=0)}this.popupContainer.style.left=s+"px",this.popupContainer.style.top=o+"px"}},{key:"_startDrag",value:function(e,t){t=t||{},n.Type.isStringFilled(t.cursor)&&(this.dragOptions.cursor=t.cursor),n.Type.isStringFilled(t.eventName)&&(this.dragOptions.eventName=t.eventName),n.Type.isFunction(t.callback)&&(this.dragOptions.callback=t.callback),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged=!1,n.Event.bind(document,"mousemove",this.handleDocumentMouseMove),n.Event.bind(document,"mouseup",this.handleDocumentMouseUp),document.body.setCapture&&document.body.setCapture(),document.body.ondrag=function(){return!1},document.body.onselectstart=function(){return!1},document.body.style.cursor=this.dragOptions.cursor,document.body.style.MozUserSelect="none",this.popupContainer.style.MozUserSelect="none",e.preventDefault()}},{key:"handleDocumentMouseMove",value:function(e){this.dragPageX===e.pageX&&this.dragPageY===e.pageY||(this.dragOptions.callback(e.pageX-this.dragPageX,e.pageY-this.dragPageY,e.pageX,e.pageY),this.dragPageX=e.pageX,this.dragPageY=e.pageY,this.dragged||(this.emit("on".concat(this.dragOptions.eventName,"Start"),new t.BaseEvent({compatData:[this]})),this.dragged=!0),this.emit("on".concat(this.dragOptions.eventName),new t.BaseEvent({compatData:[this]})))}},{key:"handleDocumentMouseUp",value:function(e){document.body.releaseCapture&&document.body.releaseCapture(),n.Event.unbind(document,"mousemove",this.handleDocumentMouseMove),n.Event.unbind(document,"mouseup",this.handleDocumentMouseUp),document.body.ondrag=null,document.body.onselectstart=null,document.body.style.cursor="",document.body.style.MozUserSelect="",this.popupContainer.style.MozUserSelect="",this.emit("on".concat(this.dragOptions.eventName,"End"),new t.BaseEvent({compatData:[this]})),this.dragged=!1,e.preventDefault()}}]),c}(t.EventEmitter);babelHelpers.defineProperty(c,"options",{}),babelHelpers.defineProperty(c,"defaultOptions",{angleLeftOffset:40,positionTopXOffset:-11,angleTopOffset:10,popupZindex:1e3,popupOverlayZindex:1100,angleMinLeft:10,angleMaxLeft:30,angleMinRight:10,angleMaxRight:30,angleMinBottom:23,angleMaxBottom:25,angleMinTop:23,angleMaxTop:25,offsetLeft:0,offsetTop:0});var m=-1,g=null;function f(e,t){if(!1===e){if(g&&g.length>0){for(var n=0;n<g.length;n++)g[n]();g=null,m=-1}}else null===g&&(g=[],m=-1,setTimeout((function(){f(!1)}),10)),e>m?(m=e,g=[t]):e===m&&g.push(t)}var b=function(){function e(){throw babelHelpers.classCallCheck(this,e),new Error("You cannot make an instance of PopupManager.")}return babelHelpers.createClass(e,null,[{key:"create",value:function(e){var t=Array.prototype.slice.call(arguments),i=t[0],s=t[1],o=t[2],a=i,l=!0;if(n.Type.isPlainObject(i)&&!s&&!o&&(l=!1,a=i.id,!n.Type.isStringFilled(a)))throw new Error('BX.Main.Popup.Manager: "id" parameter is required.');var u=this.getPopupById(a);return null===u&&((u=l?new c(i,s,o):new c(e)).subscribe("onShow",this.handlePopupShow),u.subscribe("onClose",this.handlePopupClose)),u}},{key:"handleOnAfterInit",value:function(e){e.getTarget().subscribeOnce("onDestroy",this.handlePopupDestroy),this._popups.forEach((function(t){t.getId()===e.getTarget().getId()&&console.error("Duplicate id (".concat(t.getId(),") for the BX.Main.Popup instance."))})),this._popups.push(e.getTarget())}},{key:"handlePopupDestroy",value:function(e){this._popups=this._popups.filter((function(t){return t!==e.getTarget()}))}},{key:"handlePopupShow",value:function(e){null!==this._currentPopup&&this._currentPopup.close(),this._currentPopup=e.getTarget()}},{key:"handlePopupClose",value:function(){this._currentPopup=null}},{key:"getCurrentPopup",value:function(){return this._currentPopup}},{key:"isPopupExists",value:function(e){return null!==this.getPopupById(e)}},{key:"isAnyPopupShown",value:function(){for(var e=0,t=this._popups.length;e<t;e++)if(this._popups[e].isShown())return!0;return!1}},{key:"getPopupById",value:function(e){for(var t=0;t<this._popups.length;t++)if(this._popups[t].getId()===e)return this._popups[t];return null}},{key:"getMaxZIndex",value:function(){for(var e=0,t=0;t<this._popups.length;t++)e=Math.max(e,this._popups[t].params.zIndex);return e}}]),e}();function y(){var e=babelHelpers.taggedTemplateLiteral(['<span class="popup-window-delimiter">']);return y=function(){return e},e}babelHelpers.defineProperty(b,"_popups",[]),babelHelpers.defineProperty(b,"_currentPopup",null),b.handlePopupDestroy=b.handlePopupDestroy.bind(b),b.handlePopupShow=b.handlePopupShow.bind(b),b.handlePopupClose=b.handlePopupClose.bind(b),b.handleOnAfterInit=b.handleOnAfterInit.bind(b),t.EventEmitter.subscribe("BX.Main.Popup:onAfterInit",b.handleOnAfterInit);var v={onSubMenuShow:{namespace:"BX.Main.Menu.Item",eventName:"SubMenu:onShow"},onSubMenuClose:{namespace:"BX.Main.Menu.Item",eventName:"SubMenu:onClose"}},C=/[<>'"]/g,w={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};function M(e){return n.Type.isString(e)?e.replace(C,(function(e){return w[e]})):e}t.EventEmitter.registerAliases(v);var P=function(e){function i(e){var t;for(var s in babelHelpers.classCallCheck(this,i),(t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this))).setEventNamespace("BX.Main.Menu.Item"),e=e||{},t.options=e,t.id=e.id||n.Text.getRandom(),t.text="",t.allowHtml=!0,n.Type.isStringFilled(e.html)?t.text=e.html:n.Type.isStringFilled(e.text)&&(t.text=e.text,t.text.match(/<[^>]+>/)&&console.warn('BX.Main.MenuItem: use "html" option for the html item content.',t.getText())),t.title=n.Type.isStringFilled(e.title)?e.title:"",t.delimiter=!0===e.delimiter,t.href=n.Type.isStringFilled(e.href)?e.href:null,t.target=n.Type.isStringFilled(e.target)?e.target:null,t.dataset=n.Type.isPlainObject(e.dataset)?e.dataset:null,t.className=n.Type.isStringFilled(e.className)?e.className:null,t.menuShowDelay=n.Type.isNumber(e.menuShowDelay)?e.menuShowDelay:300,t.subMenuOffsetX=n.Type.isNumber(e.subMenuOffsetX)?e.subMenuOffsetX:4,t._items=n.Type.isArray(e.items)?e.items:[],t.disabled=!0===e.disabled,t.cacheable=!0===e.cacheable,t.onclick=n.Type.isStringFilled(e.onclick)||n.Type.isFunction(e.onclick)?e.onclick:null,t.subscribeFromOptions(e.events,v),t.menuWindow=null,t.subMenuWindow=null,t.layout={item:null,text:null},t.getLayout(),t.events={},t.items=[],e)e.hasOwnProperty(s)&&void 0===t[s]&&(t[s]=e[s]);return t}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"getLayout",value:function(){return this.layout.item||(this.delimiter?n.Type.isStringFilled(this.getText())?this.layout.item=n.Dom.create("span",{props:{className:"popup-window-delimiter-section"},children:[this.layout.text=n.Dom.create("span",{props:{className:"popup-window-delimiter-text"},html:this.allowHtml?this.getText():M(this.getText())})]}):this.layout.item=n.Tag.render(y()):(this.layout.item=n.Dom.create(this.href?"a":"span",{props:{className:["menu-popup-item",this.className?this.className:"menu-popup-no-icon",this.hasSubMenu()?"menu-popup-item-submenu":""].join(" ")},attrs:{title:this.title,onclick:n.Type.isString(this.onclick)?this.onclick:"",target:this.target?this.target:""},dataset:this.dataset,events:n.Type.isFunction(this.onclick)?{click:this.onItemClick.bind(this)}:null,children:[n.Dom.create("span",{props:{className:"menu-popup-item-icon"}}),this.layout.text=n.Dom.create("span",{props:{className:"menu-popup-item-text"},html:this.allowHtml?this.getText():M(this.getText())})]}),this.href&&(this.layout.item.href=this.href),this.isDisabled()&&this.disable(),n.Event.bind(this.layout.item,"mouseenter",this.onItemMouseEnter.bind(this)),n.Event.bind(this.layout.item,"mouseleave",this.onItemMouseLeave.bind(this)))),this.layout}},{key:"getContainer",value:function(){return this.getLayout().item}},{key:"getTextContainer",value:function(){return this.getLayout().text}},{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e){n.Type.isString(e)&&(this.text=e,this.getTextContainer().innerHTML=e)}},{key:"hasSubMenu",value:function(){return null!==this.subMenuWindow||this._items.length}},{key:"showSubMenu",value:function(){if(this.addSubMenu(this._items),this.subMenuWindow){n.Dom.addClass(this.layout.item,"menu-popup-item-open"),this.closeSiblings(),this.closeChildren();var e=this.subMenuWindow.getPopupWindow();e.isShown()||(this.emit("SubMenu:onShow"),e.show()),this.adjustSubMenu()}}},{key:"addSubMenu",value:function(e){if(null===this.subMenuWindow&&n.Type.isArray(e)&&e.length){var t=(this.getMenuWindow().getRootMenuWindow()||this.getMenuWindow()).params;return t.autoHide=!1,t.menuShowDelay=this.menuShowDelay,t.cacheable=this.isCacheable(),t.zIndexAbsolute=this.getMenuWindow().getPopupWindow().getZindex()+2,t.bindOptions={forceTop:!0,forceLeft:!0,forceBindPosition:!0},delete t.zIndex,delete t.events,delete t.angle,delete t.overlay,this.subMenuWindow=new I("popup-submenu-"+this.id,this.layout.item,e,t),this.subMenuWindow.setParentMenuWindow(this.getMenuWindow()),this.subMenuWindow.setParentMenuItem(this),this.subMenuWindow.getPopupWindow().subscribe("onDestroy",this.handleSubMenuDestroy.bind(this)),n.Dom.addClass(this.layout.item,"menu-popup-item-submenu"),this.subMenuWindow}}},{key:"closeSubMenu",value:function(){(this.clearSubMenuTimeout(),this.subMenuWindow)&&(n.Dom.removeClass(this.layout.item,"menu-popup-item-open"),this.closeChildren(),this.subMenuWindow.getPopupWindow().isShown()&&this.emit("SubMenu:onClose"),this.subMenuWindow.close())}},{key:"closeSiblings",value:function(){for(var e=this.menuWindow.getMenuItems(),t=0;t<e.length;t++)e[t]!==this&&e[t].closeSubMenu()}},{key:"closeChildren",value:function(){if(this.subMenuWindow)for(var e=this.subMenuWindow.getMenuItems(),t=0;t<e.length;t++)e[t].closeSubMenu()}},{key:"destroySubMenu",value:function(){this.subMenuWindow&&(n.Dom.removeClass(this.layout.item,"menu-popup-item-open menu-popup-item-submenu"),this.destroyChildren(),this.subMenuWindow.destroy(),this.subMenuWindow=null,this._items=[])}},{key:"destroyChildren",value:function(){if(this.subMenuWindow)for(var e=this.subMenuWindow.getMenuItems(),t=0;t<e.length;t++)e[t].destroySubMenu()}},{key:"adjustSubMenu",value:function(){if(this.subMenuWindow&&this.layout.item){var e=this.subMenuWindow.getPopupWindow(),t=this.layout.item.getBoundingClientRect(),n=t.width+this.subMenuOffsetX,i=t.height+this.getPopupPadding(),s=t.height/2-this.getPopupPadding(),o="left",a=e.getPopupContainer().offsetWidth,l=e.getPopupContainer().offsetHeight,u=t.top+l,r=document.documentElement.clientWidth,h=u-document.documentElement.clientHeight;if(h>0){var p=Math.ceil(h/t.height)*t.height;p>t.top&&(p-=Math.ceil((p-t.top)/t.height)*t.height),t.bottom>u-p&&(p-=t.bottom-(u-p)+this.getPopupPadding()),i+=p,s+=p}if(t.left+n+a>r)t.left-a-this.subMenuOffsetX>0&&(n=-a-this.subMenuOffsetX,o="right");e.setBindElement(this.layout.item),e.setOffset({offsetLeft:n,offsetTop:-i}),e.setAngle({position:o,offset:s}),e.adjustPosition()}}},{key:"getPopupPadding",value:function(){if(!n.Type.isNumber(this.popupPadding))if(this.subMenuWindow){var e=this.subMenuWindow.layout.menuContainer;this.popupPadding=parseInt(n.Dom.style(e,"paddingTop"),10)}else this.popupPadding=0;return this.popupPadding}},{key:"getSubMenu",value:function(){return this.subMenuWindow}},{key:"getId",value:function(){return this.id}},{key:"setMenuWindow",value:function(e){this.menuWindow=e}},{key:"getMenuWindow",value:function(){return this.menuWindow}},{key:"getMenuShowDelay",value:function(){return this.menuShowDelay}},{key:"enable",value:function(){this.disabled=!1,this.getContainer().classList.remove("menu-popup-item-disabled")}},{key:"disable",value:function(){this.disabled=!0,this.closeSubMenu(),this.getContainer().classList.add("menu-popup-item-disabled")}},{key:"isDisabled",value:function(){return this.disabled}},{key:"setCacheable",value:function(e){this.cacheable=!1!==e}},{key:"isCacheable",value:function(){return this.cacheable}},{key:"onItemClick",value:function(e){this.onclick.call(this.menuWindow,e,this)}},{key:"onItemMouseEnter",value:function(e){this.isDisabled()||(t.EventEmitter.emit(this,"onMouseEnter",void 0,{thisArg:this}),this.clearSubMenuTimeout(),this.hasSubMenu()?this.subMenuTimeout=setTimeout(function(){this.showSubMenu()}.bind(this),this.menuShowDelay):this.subMenuTimeout=setTimeout(function(){this.closeSiblings()}.bind(this),this.menuShowDelay))}},{key:"onItemMouseLeave",value:function(e){this.isDisabled()||(t.EventEmitter.emit(this,"onMouseLeave",void 0,{thisArg:this}),this.clearSubMenuTimeout())}},{key:"clearSubMenuTimeout",value:function(){this.subMenuTimeout&&clearTimeout(this.subMenuTimeout),this.subMenuTimeout=null}},{key:"handleSubMenuDestroy",value:function(){this.subMenuWindow=null}}]),i}(t.EventEmitter);function k(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="menu-popup">',"</div>\n\t\t"]);return k=function(){return e},e}function T(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="menu-popup-items">',"</div>\n\t\t"]);return T=function(){return e},e}var I=function(){function e(t){babelHelpers.classCallCheck(this,e);var i=Array.prototype.slice.call(arguments),s=i[0],o=i[1],a=i[2],l=i[3];if(!n.Type.isPlainObject(t)||o||a||l||((l=t).compatibleMode=!1,s=t.id,o=t.bindElement,a=t.items,n.Type.isStringFilled(s)||(s="menu-popup-"+n.Text.getRandom())),this.id=s,this.bindElement=o,this.menuItems=[],this.itemsContainer=null,this.params=l&&"object"===babelHelpers.typeof(l)?l:{},this.parentMenuWindow=null,this.parentMenuItem=null,a&&n.Type.isArray(a))for(var u=0;u<a.length;u++)this.addMenuItemInternal(a[u],null);this.layout={menuContainer:null,itemsContainer:null},this.popupWindow=this.__createPopup()}return babelHelpers.createClass(e,[{key:"__createPopup",value:function(){for(var e=[],t=0;t<this.menuItems.length;t++){var i=this.menuItems[t].getLayout();e.push(i.item)}var s=Object.assign({closeByEsc:!1,angle:!1,autoHide:!0,offsetTop:1,offsetLeft:0,animation:"fading"},this.params);s.noAllPaddings=!0,s.darkMode=!1,s.autoHideHandler=this.handleAutoHide.bind(this),this.layout.itemsContainer=n.Tag.render(T(),e),this.layout.menuContainer=n.Tag.render(k(),this.layout.itemsContainer),this.itemsContainer=this.layout.itemsContainer,s.content=this.layout.menuContainer,s.events={onClose:this.handlePopupClose.bind(this),onDestroy:this.handlePopupDestroy.bind(this)};var o=!1===s.compatibleMode?this.getId():"menu-popup-"+this.getId(),a=new c(o,this.bindElement,s);return this.params&&this.params.events&&a.subscribeFromOptions(this.params.events),a}},{key:"getPopupWindow",value:function(){return this.popupWindow}},{key:"show",value:function(){this.getPopupWindow().show()}},{key:"close",value:function(){this.getPopupWindow().close()}},{key:"destroy",value:function(){this.getPopupWindow().destroy()}},{key:"toggle",value:function(){this.getPopupWindow().isShown()?this.close():this.show()}},{key:"getId",value:function(){return this.id}},{key:"handlePopupClose",value:function(){for(var e=0;e<this.menuItems.length;e++){this.menuItems[e].closeSubMenu()}}},{key:"handlePopupDestroy",value:function(){for(var e=0;e<this.menuItems.length;e++){this.menuItems[e].destroySubMenu()}}},{key:"handleAutoHide",value:function(e){return!this.containsTarget(e.target)}},{key:"containsTarget",value:function(e){var t=this.getPopupWindow().getPopupContainer();return!(!this.getPopupWindow().isShown()||e!==t&&!t.contains(e))||this.getMenuItems().some((function(t){return t.getSubMenu()&&t.getSubMenu().containsTarget(e)}))}},{key:"setParentMenuWindow",value:function(t){t instanceof e&&(this.parentMenuWindow=t)}},{key:"getParentMenuWindow",value:function(){return this.parentMenuWindow}},{key:"getRootMenuWindow",value:function(){for(var e=null,t=this.getParentMenuWindow();null!==t;)e=t,t=t.getParentMenuWindow();return e}},{key:"setParentMenuItem",value:function(e){e instanceof P&&(this.parentMenuItem=e)}},{key:"getParentMenuItem",value:function(){return this.parentMenuItem}},{key:"addMenuItem",value:function(e,t){var n=this.addMenuItemInternal(e,t);if(!n)return null;var i=n.getLayout(),s=this.getMenuItem(t);if(null!==s){var o=s.getLayout();this.itemsContainer.insertBefore(i.item,o.item)}else this.itemsContainer.appendChild(i.item);return n}},{key:"addMenuItemInternal",value:function(e,t){if(!e||!e.delimiter&&!n.Type.isStringFilled(e.text)&&!n.Type.isStringFilled(e.html)||e.id&&null!==this.getMenuItem(e.id))return null;n.Type.isNumber(this.params.menuShowDelay)&&(e.menuShowDelay=this.params.menuShowDelay);var i=new P(e);i.setMenuWindow(this);var s=this.getMenuItemPosition(t);return s>=0?this.menuItems.splice(s,0,i):this.menuItems.push(i),i}},{key:"removeMenuItem",value:function(e){var t=this.getMenuItem(e);if(t){for(var n=0;n<this.menuItems.length;n++)if(this.menuItems[n]===t){t.destroySubMenu(),this.menuItems.splice(n,1);break}if(!this.menuItems.length){var i=t.getMenuWindow();if(i){var s=i.getParentMenuItem();s?s.destroySubMenu():i.destroy()}}t.layout.item.parentNode.removeChild(t.layout.item),t.layout={item:null,text:null}}}},{key:"getMenuItem",value:function(e){for(var t=0;t<this.menuItems.length;t++)if(this.menuItems[t].id&&this.menuItems[t].id===e)return this.menuItems[t];return null}},{key:"getMenuItems",value:function(){return this.menuItems}},{key:"getMenuItemPosition",value:function(e){if(e)for(var t=0;t<this.menuItems.length;t++)if(this.menuItems[t].id&&this.menuItems[t].id===e)return t;return-1}},{key:"getMenuContainer",value:function(){return this.getPopupWindow().getPopupContainer()}}]),e}(),H=function(){function e(){throw babelHelpers.classCallCheck(this,e),new Error("You cannot make an instance of MenuManager.")}return babelHelpers.createClass(e,null,[{key:"show",value:function(){null!==this.currentItem&&this.currentItem.popupWindow.close();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.currentItem=this.create.apply(this,t),this.currentItem.popupWindow.show()}},{key:"create",value:function(t){var i=null,s=arguments[1],o=arguments[2],a=arguments[3];if(!n.Type.isPlainObject(t)||s||o||a)i=t;else if(i=t.id,!n.Type.isStringFilled(i))throw new Error('BX.Main.Menu.create: "id" parameter is required.');if(!this.Data[i]){var l=new I(t,s,o,a);l.getPopupWindow().subscribe("onDestroy",(function(){e.destroy(i)})),this.Data[i]=l}return this.Data[i]}},{key:"getCurrentMenu",value:function(){return this.currentItem}},{key:"getMenuById",value:function(e){return this.Data[e]?this.Data[e]:null}},{key:"onPopupDestroy",value:function(e){this.destroy(e.id)}},{key:"destroy",value:function(e){var t=this.getMenuById(e);t&&(this.currentItem===t&&(this.currentItem=null),delete this.Data[e],t.getPopupWindow().destroy())}}]),e}();babelHelpers.defineProperty(H,"Data",{}),babelHelpers.defineProperty(H,"currentItem",null);var E=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(c),S=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(i),N=function(e){function t(e){var i;return babelHelpers.classCallCheck(this,t),(i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))).buttonNode=n.Dom.create("span",{props:{className:"popup-window-button popup-window-button-link"+(i.className.length>0?" "+i.className:""),id:i.id},text:i.text,events:i.contextEvents}),i}return babelHelpers.inherits(t,e),t}(i),x=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(N),B=function(e){function t(e){var i;return babelHelpers.classCallCheck(this,t),(i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))).buttonNode=n.Dom.create("span",{props:{className:i.className.length>0?i.className:"",id:i.id},events:i.contextEvents,text:i.text}),i}return babelHelpers.inherits(t,e),t}(i),D=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(B),O=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(I),W=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),t}(P),z=function(){function e(t){babelHelpers.classCallCheck(this,e),this.id=t.id||"bx-inp-popup-"+Math.round(1e6*Math.random()),this.handler=t.handler||!1,this.values=t.values||!1,this.pInput=t.input,this.bValues=!!this.values,this.defaultValue=t.defaultValue||"",this.openTitle=t.openTitle||"",this.className=t.className||"",this.noMRclassName=t.noMRclassName||"ec-no-rm",this.emptyClassName=t.noMRclassName||"ec-label";var n=this;this.curInd=!1,this.bValues?(this.pInput.onfocus=this.pInput.onclick=function(e){return this.value==n.defaultValue&&(this.value="",this.className=n.className),n.ShowPopup(),e.preventDefault()},this.pInput.onblur=function(){n.bShowed&&setTimeout((function(){n.ClosePopup(!0)}),200),n.OnChange()}):(this.pInput.className=this.noMRclassName,this.pInput.onblur=this.OnChange.bind(this))}return babelHelpers.createClass(e,[{key:"ShowPopup",value:function(){if(!this.bShowed){var e=this;if(!this.oPopup){for(var i=n.Dom.create("DIV",{props:{className:"bxecpl-loc-popup "+this.className}}),s=0,o=this.values.length;s<o;s++){var a=i.appendChild(n.Dom.create("DIV",{props:{id:"bxecmr_"+s},text:this.values[s].NAME,events:{mouseover:function(){n.Dom.addClass(this,"bxecplloc-over")},mouseout:function(){n.Dom.removeClass(this,"bxecplloc-over")},click:function(){var t=this.id.substr("bxecmr_".length);e.pInput.value=e.values[t].NAME,e.curInd=t,e.OnChange(),e.ClosePopup(!0)}}}));this.values[s].DESCRIPTION&&(a.title=this.values[s].DESCRIPTION),this.values[s].CLASS_NAME&&n.Dom.addClass(a,this.values[s].CLASS_NAME),this.values[s].URL&&a.appendChild(n.Dom.create("a",{props:{href:this.values[s].URL,className:"bxecplloc-view",target:"_blank",title:this.openTitle}}))}this.oPopup=new c(this.id,this.pInput,{autoHide:!0,offsetTop:1,offsetLeft:0,lightShadow:!0,closeByEsc:!0,content:i,events:{onClose:this.ClosePopup.bind(this)}})}this.oPopup.show(),this.pInput.select(),this.bShowed=!0,t.EventEmitter.emit(this,"onInputPopupShow",new t.BaseEvent({compatData:[this]}))}}},{key:"ClosePopup",value:function(e){this.bShowed=!1,""===this.pInput.value&&this.OnChange(),t.EventEmitter.emit(this,"onInputPopupClose",new t.BaseEvent({compatData:[this]})),!0===e&&this.oPopup.close()}},{key:"OnChange",value:function(){var e=this.pInput.value;this.bValues&&(""==this.pInput.value||this.pInput.value==this.defaultValue?(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName,e=""):this.pInput.className=""),isNaN(parseInt(this.curInd))||!1!==this.curInd&&e!=this.values[this.curInd].NAME?this.curInd=!1:this.curInd=parseInt(this.curInd),t.EventEmitter.emit(this,"onInputPopupChanged",new t.BaseEvent({compatData:[this,this.curInd,e]})),this.handler&&"function"==typeof this.handler&&this.handler({ind:this.curInd,value:e})}},{key:"Set",value:function(e,t,n){this.curInd=e,!1!==this.curInd?this.pInput.value=this.values[this.curInd].NAME:this.pInput.value=t,!1!==n&&this.OnChange()}},{key:"Get",value:function(e){var t=!1;return void 0===e&&(e=this.curInd),!1!==e&&this.values[e]&&(t=this.values[e].ID),t}},{key:"GetIndex",value:function(e){for(var t=0,n=this.values.length;t<n;t++)if(this.values[t].ID==e)return t;return!1}},{key:"Deactivate",value:function(e){""!=this.pInput.value&&this.pInput.value!=this.defaultValue||(e?(this.pInput.value="",this.pInput.className=this.noMRclassName):this.oEC.bUseMR&&(this.pInput.value=this.defaultValue,this.pInput.className=this.emptyClassName)),this.pInput.disabled=e}}]),e}(),A=n.Reflection.namespace("BX");A.PopupWindow=c,A.PopupWindowManager=b,A.PopupMenuWindow=I,A.PopupMenu=H,A.PopupMenuItem=P,A.PopupWindowButton=i,A.PopupWindowButtonLink=N,A.PopupWindowCustomButton=B,window.BXInputPopup=z,e.Popup=c,e.Menu=I,e.MenuItem=P,e.PopupManager=b,e.MenuManager=H,e.PopupWindow=E,e.PopupMenuWindow=O,e.PopupMenuItem=W,e.PopupWindowManager=b,e.PopupMenu=H,e.PopupWindowButton=S,e.PopupWindowButtonLink=x,e.PopupWindowCustomButton=D}(this.BX.Main=this.BX.Main||{},BX.Event,BX);