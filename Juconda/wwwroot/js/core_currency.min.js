window,BX.namespace("BX.Currency"),BX.Currency.defaultFormat||BX.mergeEx(BX.Currency,{currencyList:[],defaultFormat:{FORMAT_STRING:"#",DEC_POINT:".",THOUSANDS_SEP:" ",DECIMALS:2,HIDE_ZERO:"N"},setCurrencyFormat:function(r,t,e){var n,c=this.getCurrencyIndex(r),i=BX.clone(this.defaultFormat,!0);if(e=!!e,!(c>-1)||e){for(n in-1===c&&(c=this.currencyList.length),i)i.hasOwnProperty(n)&&void 0!==t[n]&&(i[n]=t[n]);this.currencyList[c]={currency:r,format:BX.clone(i,!0)}}},setCurrencies:function(r,t){var e;if(r&&BX.type.isArray(r))for(e=0;e<r.length;e++)r[e].CURRENCY&&r[e].FORMAT&&this.setCurrencyFormat(r[e].CURRENCY,r[e].FORMAT,t)},getCurrencyFormat:function(r){var t=this.getCurrencyIndex(r);return t>-1&&this.currencyList[t].format},getCurrencyIndex:function(r){var t,e=-1;if(0===this.currencyList.length)return e;for(t=0;t<this.currencyList.length;t++)if(this.currencyList[t].currency===r){e=t;break}return e},clearCurrency:function(r){var t=this.getCurrencyIndex(r);t>-1&&(this.currencyList=BX.util.deleteFromArray(this.currencyList,t))},clean:function(){this.currencyList=[]},currencyFormat:function(r,t,e){var n,c="";return e=!!e,(n=this.getCurrencyFormat(t))&&"object"==typeof n&&(n.CURRENT_DECIMALS=n.DECIMALS,"Y"===n.HIDE_ZERO&&r==parseInt(r,10)&&(n.CURRENT_DECIMALS=0),c=BX.util.number_format(r,n.CURRENT_DECIMALS,n.DEC_POINT,n.THOUSANDS_SEP),e&&(c=n.FORMAT_STRING.replace(/(^|[^&])#/,"$1"+c))),c},loadCurrencyFormat:function(r){return new Promise(function(t,e){var n=this.getCurrencyIndex(r);n>-1?t(this.currencyList[n].format):BX.ajax.runAction("currency.format.get",{data:{currencyId:r}}).then(function(e){var n=e.data;this.setCurrencyFormat(r,n),t(n)}.bind(this)).catch((function(r){e(r.errors)}))}.bind(this))}});